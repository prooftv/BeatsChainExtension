<!DOCTYPE html>
<html>
<head>
    <title>Audio Preview Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #333; color: white; }
        .test-container { max-width: 400px; margin: 0 auto; }
        .audio-preview-player { background: rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 15px; margin-top: 15px; }
        .audio-controls { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .control-btn { background: rgba(255, 255, 255, 0.2); border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 16px; cursor: pointer; }
        .control-btn:hover { background: rgba(255, 255, 255, 0.3); transform: scale(1.1); }
        .time-display { color: white; font-size: 12px; min-width: 80px; }
        .seek-bar, .volume-bar { flex: 1; height: 4px; background: rgba(255, 255, 255, 0.2); border-radius: 2px; outline: none; cursor: pointer; }
        .volume-control { display: flex; align-items: center; gap: 5px; min-width: 80px; }
        .waveform-placeholder { height: 60px; background: rgba(0, 0, 0, 0.2); border-radius: 8px; overflow: hidden; }
        .waveform-bars { display: flex; align-items: end; height: 100%; padding: 5px; gap: 1px; }
        .waveform-bars .bar { flex: 1; background: linear-gradient(to top, #4CAF50, #45a049); min-height: 2px; border-radius: 1px; opacity: 0.7; }
        .upload-area { border: 2px dashed rgba(255, 255, 255, 0.3); border-radius: 12px; padding: 30px; text-align: center; cursor: pointer; margin-bottom: 20px; }
        .upload-area:hover { border-color: rgba(255, 255, 255, 0.5); }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üéµ Audio Preview Test</h1>
        
        <div class="upload-area" onclick="document.getElementById('test-file').click()">
            <input type="file" id="test-file" accept="audio/*" style="display: none;">
            <p>Click to upload audio file for testing</p>
        </div>
        
        <div id="preview-container"></div>
        
        <div id="test-results">
            <h3>Test Results:</h3>
            <ul id="results-list"></ul>
        </div>
    </div>

    <script>
        class AudioPreviewPlayer {
            constructor() {
                this.audio = null;
                this.isPlaying = false;
            }

            createPlayer(file) {
                return `
                    <div class="audio-preview-player">
                        <div class="audio-controls">
                            <button id="play-pause-btn" class="control-btn">‚ñ∂Ô∏è</button>
                            <div class="time-display">
                                <span id="current-time">0:00</span> / <span id="total-time">0:00</span>
                            </div>
                            <input type="range" id="seek-bar" class="seek-bar" min="0" max="100" value="0">
                            <div class="volume-control">
                                <span>üîä</span>
                                <input type="range" id="volume-bar" class="volume-bar" min="0" max="100" value="70">
                            </div>
                        </div>
                        <div class="waveform-placeholder">
                            <div class="waveform-bars">
                                ${Array.from({length: 50}, () => `<div class="bar" style="height: ${Math.random() * 100}%"></div>`).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }

            initializePlayer(file) {
                this.audio = new Audio();
                this.audio.src = URL.createObjectURL(file);
                
                const playPauseBtn = document.getElementById('play-pause-btn');
                const seekBar = document.getElementById('seek-bar');
                const volumeBar = document.getElementById('volume-bar');
                const currentTimeSpan = document.getElementById('current-time');
                const totalTimeSpan = document.getElementById('total-time');
                
                if (!playPauseBtn) {
                    this.logResult('‚ùå Play/Pause button not found');
                    return;
                }
                
                this.logResult('‚úÖ Audio element created successfully');
                this.audio.volume = 0.7;
                
                playPauseBtn.addEventListener('click', () => {
                    if (this.isPlaying) {
                        this.audio.pause();
                        playPauseBtn.textContent = '‚ñ∂Ô∏è';
                        this.isPlaying = false;
                        this.logResult('‚è∏Ô∏è Audio paused');
                    } else {
                        this.audio.play().then(() => {
                            playPauseBtn.textContent = '‚è∏Ô∏è';
                            this.isPlaying = true;
                            this.logResult('‚ñ∂Ô∏è Audio playing');
                        }).catch(err => {
                            this.logResult('‚ùå Play failed: ' + err.message);
                        });
                    }
                });
                
                this.audio.addEventListener('timeupdate', () => {
                    if (this.audio.duration) {
                        const progress = (this.audio.currentTime / this.audio.duration) * 100;
                        if (seekBar) seekBar.value = progress;
                        if (currentTimeSpan) currentTimeSpan.textContent = this.formatTime(this.audio.currentTime);
                    }
                });
                
                this.audio.addEventListener('loadedmetadata', () => {
                    if (totalTimeSpan) totalTimeSpan.textContent = this.formatTime(this.audio.duration);
                    if (seekBar) seekBar.max = this.audio.duration;
                    this.logResult('‚úÖ Audio metadata loaded: ' + this.formatTime(this.audio.duration));
                });
                
                if (seekBar) {
                    seekBar.addEventListener('input', () => {
                        const seekTime = (seekBar.value / 100) * this.audio.duration;
                        this.audio.currentTime = seekTime;
                    });
                }
                
                if (volumeBar) {
                    volumeBar.addEventListener('input', () => {
                        this.audio.volume = volumeBar.value / 100;
                    });
                }
                
                this.audio.addEventListener('ended', () => {
                    playPauseBtn.textContent = '‚ñ∂Ô∏è';
                    this.isPlaying = false;
                    if (seekBar) seekBar.value = 0;
                    this.logResult('üîö Audio playback ended');
                });
                
                this.logResult('‚úÖ Audio player initialized successfully');
            }

            formatTime(seconds) {
                if (!seconds || isNaN(seconds)) return '0:00';
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            logResult(message) {
                const resultsList = document.getElementById('results-list');
                const li = document.createElement('li');
                li.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
                resultsList.appendChild(li);
            }

            destroy() {
                if (this.audio) {
                    this.audio.pause();
                    URL.revokeObjectURL(this.audio.src);
                    this.audio = null;
                    this.logResult('üóëÔ∏è Audio player destroyed');
                }
            }
        }

        const player = new AudioPreviewPlayer();

        document.getElementById('test-file').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                player.logResult('üìÅ File selected: ' + file.name + ' (' + file.type + ')');
                
                const container = document.getElementById('preview-container');
                container.innerHTML = player.createPlayer(file);
                
                setTimeout(() => {
                    player.initializePlayer(file);
                }, 100);
            }
        });
    </script>
</body>
</html>