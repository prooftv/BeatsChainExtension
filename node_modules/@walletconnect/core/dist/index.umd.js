(function($,ut){typeof exports=="object"&&typeof module<"u"?ut(exports):typeof define=="function"&&define.amd?define(["exports"],ut):($=typeof globalThis<"u"?globalThis:$||self,ut($["@walletconnect/core"]={}))})(this,function($){"use strict";var ut=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ua(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}),r}var Ge={exports:{}},br=typeof Reflect=="object"?Reflect:null,la=br&&typeof br.apply=="function"?br.apply:function(e,r,n){return Function.prototype.apply.call(e,r,n)},Un;br&&typeof br.ownKeys=="function"?Un=br.ownKeys:Object.getOwnPropertySymbols?Un=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Un=function(e){return Object.getOwnPropertyNames(e)};function Pd(t){console&&console.warn&&console.warn(t)}var fa=Number.isNaN||function(e){return e!==e};function te(){te.init.call(this)}Ge.exports=te,Ge.exports.once=jd,te.EventEmitter=te,te.prototype._events=void 0,te.prototype._eventsCount=0,te.prototype._maxListeners=void 0;var ha=10;function Fn(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(te,"defaultMaxListeners",{enumerable:!0,get:function(){return ha},set:function(t){if(typeof t!="number"||t<0||fa(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");ha=t}}),te.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},te.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||fa(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function da(t){return t._maxListeners===void 0?te.defaultMaxListeners:t._maxListeners}te.prototype.getMaxListeners=function(){return da(this)},te.prototype.emit=function(e){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(r.length>0&&(o=r[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")la(c,this,r);else for(var u=c.length,l=wa(c,u),n=0;n<u;++n)la(l[n],this,r);return!0};function ga(t,e,r,n){var i,s,o;if(Fn(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),o===void 0)o=s[e]=r,++t._eventsCount;else if(typeof o=="function"?o=s[e]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),i=da(t),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,Pd(a)}return t}te.prototype.addListener=function(e,r){return ga(this,e,r,!1)},te.prototype.on=te.prototype.addListener,te.prototype.prependListener=function(e,r){return ga(this,e,r,!0)};function Ld(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function pa(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=Ld.bind(n);return i.listener=r,n.wrapFn=i,i}te.prototype.once=function(e,r){return Fn(r),this.on(e,pa(this,e,r)),this},te.prototype.prependOnceListener=function(e,r){return Fn(r),this.prependListener(e,pa(this,e,r)),this},te.prototype.removeListener=function(e,r){var n,i,s,o,a;if(Fn(r),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===r||n.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||r));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===r||n[o].listener===r){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():Ud(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||r)}return this},te.prototype.off=te.prototype.removeListener,te.prototype.removeAllListeners=function(e){var r,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=n[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(i=r.length-1;i>=0;i--)this.removeListener(e,r[i]);return this};function ya(t,e,r){var n=t._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?r?[i.listener||i]:[i]:r?Fd(i):wa(i,i.length)}te.prototype.listeners=function(e){return ya(this,e,!0)},te.prototype.rawListeners=function(e){return ya(this,e,!1)},te.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):ba.call(t,e)},te.prototype.listenerCount=ba;function ba(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}te.prototype.eventNames=function(){return this._eventsCount>0?Un(this._events):[]};function wa(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function Ud(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Fd(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function jd(t,e){return new Promise(function(r,n){function i(o){t.removeListener(e,s),n(o)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),r([].slice.call(arguments))}ma(t,e,s,{once:!0}),e!=="error"&&kd(t,i,{once:!0})})}function kd(t,e,r){typeof t.on=="function"&&ma(t,"error",e,r)}function ma(t,e,r,n){if(typeof t.on=="function")n.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){n.once&&t.removeEventListener(e,i),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var G={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Hi=function(t,e){return Hi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},Hi(t,e)};function Md(t,e){Hi(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var qi=function(){return qi=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},qi.apply(this,arguments)};function zd(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function Vd(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function Kd(t,e){return function(r,n){e(r,n,t)}}function Hd(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function qd(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function Gd(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Wd(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function Yd(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Gi(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ea(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function Zd(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Ea(arguments[e]));return t}function Xd(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function Wr(t){return this instanceof Wr?(this.v=t,this):new Wr(t)}function Jd(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){n[f]&&(i[f]=function(d){return new Promise(function(g,y){s.push([f,d,g,y])>1||a(f,d)})})}function a(f,d){try{c(n[f](d))}catch(g){h(s[0][3],g)}}function c(f){f.value instanceof Wr?Promise.resolve(f.value.v).then(u,l):h(s[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function h(f,d){f(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Qd(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:Wr(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function eg(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Gi=="function"?Gi(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function tg(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function rg(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function ng(t){return t&&t.__esModule?t:{default:t}}function ig(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function sg(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var og=Object.freeze({__proto__:null,__extends:Md,get __assign(){return qi},__rest:zd,__decorate:Vd,__param:Kd,__metadata:Hd,__awaiter:qd,__generator:Gd,__createBinding:Wd,__exportStar:Yd,__values:Gi,__read:Ea,__spread:Zd,__spreadArrays:Xd,__await:Wr,__asyncGenerator:Jd,__asyncDelegator:Qd,__asyncValues:eg,__makeTemplateObject:tg,__importStar:rg,__importDefault:ng,__classPrivateFieldGet:ig,__classPrivateFieldSet:sg}),jn=ua(og),Wi={},Yr={},va;function ag(){if(va)return Yr;va=1,Object.defineProperty(Yr,"__esModule",{value:!0}),Yr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Yr.delay=t,Yr}var Jt={},Yi={},Qt={},_a;function cg(){return _a||(_a=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.ONE_THOUSAND=Qt.ONE_HUNDRED=void 0,Qt.ONE_HUNDRED=100,Qt.ONE_THOUSAND=1e3),Qt}var Zi={},xa;function ug(){return xa||(xa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Zi)),Zi}var Da;function Ia(){return Da||(Da=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=jn;e.__exportStar(cg(),t),e.__exportStar(ug(),t)}(Yi)),Yi}var Sa;function lg(){if(Sa)return Jt;Sa=1,Object.defineProperty(Jt,"__esModule",{value:!0}),Jt.fromMiliseconds=Jt.toMiliseconds=void 0;const t=Ia();function e(n){return n*t.ONE_THOUSAND}Jt.toMiliseconds=e;function r(n){return Math.floor(n/t.ONE_THOUSAND)}return Jt.fromMiliseconds=r,Jt}var Oa;function fg(){return Oa||(Oa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=jn;e.__exportStar(ag(),t),e.__exportStar(lg(),t)}(Wi)),Wi}var wr={},Aa;function hg(){if(Aa)return wr;Aa=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const n=this.get(r);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const i=Date.now()-n.started;this.timestamps.set(r,{started:n.started,elapsed:i})}get(r){const n=this.timestamps.get(r);if(typeof n>"u")throw new Error(`No timestamp found for label: ${r}`);return n}elapsed(r){const n=this.get(r);return n.elapsed||Date.now()-n.started}}return wr.Watch=t,wr.default=t,wr}var Xi={},Zr={},Ta;function dg(){if(Ta)return Zr;Ta=1,Object.defineProperty(Zr,"__esModule",{value:!0}),Zr.IWatch=void 0;class t{}return Zr.IWatch=t,Zr}var Ba;function gg(){return Ba||(Ba=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),jn.__exportStar(dg(),t)}(Xi)),Xi}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=jn;e.__exportStar(fg(),t),e.__exportStar(hg(),t),e.__exportStar(gg(),t),e.__exportStar(Ia(),t)})(G);class er{}class pg extends er{constructor(e){super()}}const Ra=G.FIVE_SECONDS,tr={pulse:"heartbeat_pulse"};class Ji extends pg{constructor(e){super(e),this.events=new Ge.exports.EventEmitter,this.interval=Ra,this.interval=e?.interval||Ra}static async init(e){const r=new Ji(e);return await r.init(),r}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),G.toMiliseconds(this.interval))}pulse(){this.events.emit(tr.pulse)}}const yg=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,bg=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,wg=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function mg(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Eg(t);return}return e}function Eg(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function kn(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const r=t.trim();if(r.length<=9)switch(r.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!wg.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(yg.test(t)||bg.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,mg)}return JSON.parse(t)}catch(n){if(e.strict)throw n;return t}}function vg(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function fe(t,...e){try{return vg(t(...e))}catch(r){return Promise.reject(r)}}function _g(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function xg(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Mn(t){if(_g(t))return String(t);if(xg(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Mn(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Qi="base64:";function Dg(t){return typeof t=="string"?t:Qi+Og(t)}function Ig(t){return typeof t!="string"||!t.startsWith(Qi)?t:Sg(t.slice(Qi.length))}function Sg(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function Og(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ae(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function Ag(...t){return Ae(t.join(":"))}function zn(t){return t=Ae(t),t?t+":":""}function Tg(t,e){if(e===void 0)return!0;let r=0,n=t.indexOf(":");for(;n>-1;)r++,n=t.indexOf(":",n+1);return r<=e}function Bg(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}function z8(t){return t}const Rg="memory",Cg=()=>{const t=new Map;return{name:Rg,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function Ng(t={}){const e={mounts:{"":t.driver||Cg()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=u=>{for(const l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},n=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),i=(u,l)=>{if(e.watching){l=Ae(l);for(const h of e.watchListeners)h(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const u in e.mounts)e.unwatch[u]=await Ca(e.mounts[u],i,u)}},o=async()=>{if(e.watching){for(const u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{const f=new Map,d=g=>{let y=f.get(g.base);return y||(y={driver:g.driver,base:g.base,items:[]},f.set(g.base,y)),y};for(const g of u){const y=typeof g=="string",E=Ae(y?g:g.key),T=y?void 0:g.value,C=y||!g.options?l:{...l,...g.options},x=r(E);d(x).items.push({key:E,value:T,relativeKey:x.relativeKey,options:C})}return Promise.all([...f.values()].map(g=>h(g))).then(g=>g.flat())},c={hasItem(u,l={}){u=Ae(u);const{relativeKey:h,driver:f}=r(u);return fe(f.hasItem,h,l)},getItem(u,l={}){u=Ae(u);const{relativeKey:h,driver:f}=r(u);return fe(f.getItem,h,l).then(d=>kn(d))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?fe(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),l).then(f=>f.map(d=>({key:Ag(h.base,d.key),value:kn(d.value)}))):Promise.all(h.items.map(f=>fe(h.driver.getItem,f.relativeKey,f.options).then(d=>({key:f.key,value:kn(d)})))))},getItemRaw(u,l={}){u=Ae(u);const{relativeKey:h,driver:f}=r(u);return f.getItemRaw?fe(f.getItemRaw,h,l):fe(f.getItem,h,l).then(d=>Ig(d))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=Ae(u);const{relativeKey:f,driver:d}=r(u);d.setItem&&(await fe(d.setItem,f,Mn(l),h),d.watch||i("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return fe(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:Mn(f.value),options:f.options})),l);h.driver.setItem&&await Promise.all(h.items.map(f=>fe(h.driver.setItem,f.relativeKey,Mn(f.value),f.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=Ae(u);const{relativeKey:f,driver:d}=r(u);if(d.setItemRaw)await fe(d.setItemRaw,f,l,h);else if(d.setItem)await fe(d.setItem,f,Dg(l),h);else return;d.watch||i("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=Ae(u);const{relativeKey:h,driver:f}=r(u);f.removeItem&&(await fe(f.removeItem,h,l),(l.removeMeta||l.removeMata)&&await fe(f.removeItem,h+"$",l),f.watch||i("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=Ae(u);const{relativeKey:h,driver:f}=r(u),d=Object.create(null);if(f.getMeta&&Object.assign(d,await fe(f.getMeta,h,l)),!l.nativeOnly){const g=await fe(f.getItem,h+"$",l).then(y=>kn(y));g&&typeof g=="object"&&(typeof g.atime=="string"&&(g.atime=new Date(g.atime)),typeof g.mtime=="string"&&(g.mtime=new Date(g.mtime)),Object.assign(d,g))}return d},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){u=zn(u);const h=n(u,!0);let f=[];const d=[];let g=!0;for(const E of h){E.driver.flags?.maxDepth||(g=!1);const T=await fe(E.driver.getKeys,E.relativeBase,l);for(const C of T){const x=E.mountpoint+Ae(C);f.some(R=>x.startsWith(R))||d.push(x)}f=[E.mountpoint,...f.filter(C=>!C.startsWith(E.mountpoint))]}const y=l.maxDepth!==void 0&&!g;return d.filter(E=>(!y||Tg(E,l.maxDepth))&&Bg(E,u))},async clear(u,l={}){u=zn(u),await Promise.all(n(u,!1).map(async h=>{if(h.driver.clear)return fe(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(f.map(d=>h.driver.removeItem(d,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>Na(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=zn(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(Ca(l,i,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){u=zn(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),l&&await Na(e.mounts[u]),e.mountpoints=e.mountpoints.filter(h=>h!==u),delete e.mounts[u])},getMount(u=""){u=Ae(u)+":";const l=r(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=Ae(u),n(u,l.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function Ca(t,e,r){return t.watch?t.watch((n,i)=>e(n,r+i)):()=>{}}async function Na(t){typeof t.dispose=="function"&&await fe(t.dispose)}function rr(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function $a(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const n=rr(r);return(i,s)=>n.then(o=>s(o.transaction(e,i).objectStore(e)))}let es;function Xr(){return es||(es=$a("keyval-store","keyval")),es}function Pa(t,e=Xr()){return e("readonly",r=>rr(r.get(t)))}function $g(t,e,r=Xr()){return r("readwrite",n=>(n.put(e,t),rr(n.transaction)))}function Pg(t,e=Xr()){return e("readwrite",r=>(r.delete(t),rr(r.transaction)))}function Lg(t=Xr()){return t("readwrite",e=>(e.clear(),rr(e.transaction)))}function Ug(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},rr(t.transaction)}function Fg(t=Xr()){return t("readonly",e=>{if(e.getAllKeys)return rr(e.getAllKeys());const r=[];return Ug(e,n=>r.push(n.key)).then(()=>r)})}const jg=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),kg=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(n,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function mr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return kg(t)}catch{return t}}function nr(t){return typeof t=="string"?t:jg(t)||""}const Mg="idb-keyval";var zg=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=i=>e+i;let n;return t.dbName&&t.storeName&&(n=$a(t.dbName,t.storeName)),{name:Mg,options:t,async hasItem(i){return!(typeof await Pa(r(i),n)>"u")},async getItem(i){return await Pa(r(i),n)??null},setItem(i,s){return $g(r(i),s,n)},removeItem(i){return Pg(r(i),n)},getKeys(){return Fg(n)},clear(){return Lg(n)}}};const Vg="WALLET_CONNECT_V2_INDEXED_DB",Kg="keyvaluestorage";class Hg{constructor(){this.indexedDb=Ng({driver:zg({dbName:Vg,storeName:Kg})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,nr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}}var ts=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Vn={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,n){this[r]=String(n)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(n){r[n]=void 0,delete r[n]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof ts<"u"&&ts.localStorage?Vn.exports=ts.localStorage:typeof window<"u"&&window.localStorage?Vn.exports=window.localStorage:Vn.exports=new e})();function qg(t){var e;return[t[0],mr((e=t[1])!=null?e:"")]}class Gg{constructor(){this.localStorage=Vn.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(qg)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return mr(r)}async setItem(e,r){this.localStorage.setItem(e,nr(r))}async removeItem(e){this.localStorage.removeItem(e)}}const Wg="wc_storage_version",La=1,Yg=async(t,e,r)=>{const n=Wg,i=await e.getItem(n);if(i&&i>=La){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const u=await t.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(n,La),r(e),Zg(t,o)},Zg=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};class Xg{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new Gg;this.storage=e;try{const r=new Hg;Yg(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}}function Jg(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var Qg=ep;function ep(t,e,r){var n=r&&r.stringify||Jg,i=1;if(typeof t=="object"&&t!==null){var s=e.length+i;if(s===1)return t;var o=new Array(s);o[0]=n(t);for(var a=1;a<s;a++)o[a]=n(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var u="",l=1-i,h=-1,f=t&&t.length||0,d=0;d<f;){if(t.charCodeAt(d)===37&&d+1<f){switch(h=h>-1?h:0,t.charCodeAt(d+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<d&&(u+=t.slice(h,d)),u+=Number(e[l]),h=d+2,d++;break;case 105:if(l>=c||e[l]==null)break;h<d&&(u+=t.slice(h,d)),u+=Math.floor(Number(e[l])),h=d+2,d++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<d&&(u+=t.slice(h,d));var g=typeof e[l];if(g==="string"){u+="'"+e[l]+"'",h=d+2,d++;break}if(g==="function"){u+=e[l].name||"<anonymous>",h=d+2,d++;break}u+=n(e[l]),h=d+2,d++;break;case 115:if(l>=c)break;h<d&&(u+=t.slice(h,d)),u+=String(e[l]),h=d+2,d++;break;case 37:h<d&&(u+=t.slice(h,d)),u+="%",h=d+2,d++,l--;break}++l}++d}return h===-1?t:(h<f&&(u+=t.slice(h)),u)}const Ua=Qg;var Ct=lt;const Jr=lp().console||{},tp={mapHttpRequest:Hn,mapHttpResponse:Hn,wrapRequestSerializer:ns,wrapResponseSerializer:ns,wrapErrorSerializer:ns,req:Hn,res:Hn,err:op};function rp(t,e){return Array.isArray(t)?t.filter(function(n){return n!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function lt(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const r=t.browser.write||Jr;t.browser.write&&(t.browser.asObject=!0);const n=t.serializers||{},i=rp(t.browser.serialize,n);let s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);const o=["error","fatal","warn","info","debug","trace"];typeof r=="function"&&(r.error=r.fatal=r.warn=r.info=r.debug=r.trace=r),t.enabled===!1&&(t.level="silent");const a=t.level||"info",c=Object.create(r);c.log||(c.log=Qr),Object.defineProperty(c,"levelVal",{get:l}),Object.defineProperty(c,"level",{get:h,set:f});const u={transmit:e,serialize:i,asObject:t.browser.asObject,levels:o,timestamp:ap(t)};c.levels=lt.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=Qr,c.serializers=n,c._serialize=i,c._stdErrSerialize=s,c.child=d,e&&(c._logEvent=rs());function l(){return this.level==="silent"?1/0:this.levels.values[this.level]}function h(){return this._level}function f(g){if(g!=="silent"&&!this.levels.values[g])throw Error("unknown level "+g);this._level=g,Er(u,c,"error","log"),Er(u,c,"fatal","error"),Er(u,c,"warn","error"),Er(u,c,"info","log"),Er(u,c,"debug","log"),Er(u,c,"trace","log")}function d(g,y){if(!g)throw new Error("missing bindings for child Pino");y=y||{},i&&g.serializers&&(y.serializers=g.serializers);const E=y.serializers;if(i&&E){var T=Object.assign({},n,E),C=t.browser.serialize===!0?Object.keys(T):i;delete g.serializers,Kn([g],C,T,this._stdErrSerialize)}function x(R){this._childLevel=(R._childLevel|0)+1,this.error=vr(R,g,"error"),this.fatal=vr(R,g,"fatal"),this.warn=vr(R,g,"warn"),this.info=vr(R,g,"info"),this.debug=vr(R,g,"debug"),this.trace=vr(R,g,"trace"),T&&(this.serializers=T,this._serialize=C),e&&(this._logEvent=rs([].concat(R._logEvent.bindings,g)))}return x.prototype=this,new x(this)}return c}lt.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},lt.stdSerializers=tp,lt.stdTimeFunctions=Object.assign({},{nullTime:Fa,epochTime:ja,unixTime:cp,isoTime:up});function Er(t,e,r,n){const i=Object.getPrototypeOf(e);e[r]=e.levelVal>e.levels.values[r]?Qr:i[r]?i[r]:Jr[r]||Jr[n]||Qr,np(t,e,r)}function np(t,e,r){!t.transmit&&e[r]===Qr||(e[r]=function(n){return function(){const s=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Jr?Jr:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&Kn(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?n.call(a,ip(this,r,o,s)):n.apply(a,o),t.transmit){const u=t.transmit.level||e.level,l=lt.levels.values[u],h=lt.levels.values[r];if(h<l)return;sp(this,{ts:s,methodLevel:r,methodValue:h,transmitLevel:u,transmitValue:lt.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[r]))}function ip(t,e,r,n){t._serialize&&Kn(r,t._serialize,t.serializers,t._stdErrSerialize);const i=r.slice();let s=i[0];const o={};n&&(o.time=n),o.level=lt.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),s!==null&&typeof s=="object"){for(;a--&&typeof i[0]=="object";)Object.assign(o,i.shift());s=i.length?Ua(i.shift(),i):void 0}else typeof s=="string"&&(s=Ua(i.shift(),i));return s!==void 0&&(o.msg=s),o}function Kn(t,e,r,n){for(const i in t)if(n&&t[i]instanceof Error)t[i]=lt.stdSerializers.err(t[i]);else if(typeof t[i]=="object"&&!Array.isArray(t[i]))for(const s in t[i])e&&e.indexOf(s)>-1&&s in r&&(t[i][s]=r[s](t[i][s]))}function vr(t,e,r){return function(){const n=new Array(1+arguments.length);n[0]=e;for(var i=1;i<n.length;i++)n[i]=arguments[i-1];return t[r].apply(this,n)}}function sp(t,e,r){const n=e.send,i=e.ts,s=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;Kn(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=i,t._logEvent.messages=r.filter(function(u){return c.indexOf(u)===-1}),t._logEvent.level.label=s,t._logEvent.level.value=o,n(s,t._logEvent,a),t._logEvent=rs(c)}function rs(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function op(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const r in t)e[r]===void 0&&(e[r]=t[r]);return e}function ap(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Fa:ja}function Hn(){return{}}function ns(t){return t}function Qr(){}function Fa(){return!1}function ja(){return Date.now()}function cp(){return Math.round(Date.now()/1e3)}function up(){return new Date(Date.now()).toISOString()}function lp(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const fp={level:"info"},en="custom_context",is=1e3*1024;class hp{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}}class ka{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const r=new hp(e);if(r.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${r.size}`);for(;this.size+r.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=r),this.tail=r):(this.head=r,this.tail=r),this.lengthInNodes++,this.sizeInBytes+=r.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let r=this.head;for(;r!==null;)e.push(r.value),r=r.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const r=e.value;return e=e.next,{done:!1,value:r}}}}}class Ma{constructor(e,r=is){this.level=e??"error",this.levelValue=Ct.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=r,this.logs=new ka(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,r){r===Ct.levels.values.error?console.error(e):r===Ct.levels.values.warn?console.warn(e):r===Ct.levels.values.debug?console.debug(e):r===Ct.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(nr({timestamp:new Date().toISOString(),log:e}));const r=typeof e=="string"?JSON.parse(e).level:e.level;r>=this.levelValue&&this.forwardToConsole(e,r)}getLogs(){return this.logs}clearLogs(){this.logs=new ka(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const r=this.getLogArray();return r.push(nr({extraMetadata:e})),new Blob(r,{type:"application/json"})}}class dp{constructor(e,r=is){this.baseChunkLogger=new Ma(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const r=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=r,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}}class gp{constructor(e,r=is){this.baseChunkLogger=new Ma(e,r)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}}var pp=Object.defineProperty,yp=Object.defineProperties,bp=Object.getOwnPropertyDescriptors,za=Object.getOwnPropertySymbols,wp=Object.prototype.hasOwnProperty,mp=Object.prototype.propertyIsEnumerable,Va=(t,e,r)=>e in t?pp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qn=(t,e)=>{for(var r in e||(e={}))wp.call(e,r)&&Va(t,r,e[r]);if(za)for(var r of za(e))mp.call(e,r)&&Va(t,r,e[r]);return t},Gn=(t,e)=>yp(t,bp(e));function Ka(t){return Gn(qn({},t),{level:t?.level||fp.level})}function Ep(t,e=en){return t[e]||""}function vp(t,e,r=en){return t[r]=e,t}function Fe(t,e=en){let r="";return typeof t.bindings>"u"?r=Ep(t,e):r=t.bindings().context||"",r}function _p(t,e,r=en){const n=Fe(t,r);return n.trim()?`${n}/${e}`:e}function Te(t,e,r=en){const n=_p(t,e,r),i=t.child({context:n});return vp(i,n,r)}function xp(t){var e,r;const n=new dp((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Ct(Gn(qn({},t.opts),{level:"trace",browser:Gn(qn({},(r=t.opts)==null?void 0:r.browser),{write:i=>n.write(i)})})),chunkLoggerController:n}}function Dp(t){var e;const r=new gp((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Ct(Gn(qn({},t.opts),{level:"trace"})),chunkLoggerController:r}}function Ip(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?xp(t):Dp(t)}var Sp=Object.defineProperty,Op=(t,e,r)=>e in t?Sp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ha=(t,e,r)=>Op(t,typeof e!="symbol"?e+"":e,r);class Ap extends er{constructor(e){super(),this.opts=e,Ha(this,"protocol","wc"),Ha(this,"version",2)}}var Tp=Object.defineProperty,Bp=(t,e,r)=>e in t?Tp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Rp=(t,e,r)=>Bp(t,typeof e!="symbol"?e+"":e,r);class Cp extends er{constructor(e,r){super(),this.core=e,this.logger=r,Rp(this,"records",new Map)}}class Np{constructor(e,r){this.logger=e,this.core=r}}class $p extends er{constructor(e,r){super(),this.relayer=e,this.logger=r}}class Pp extends er{constructor(e){super()}}class Lp{constructor(e,r,n,i){this.core=e,this.logger=r,this.name=n}}class Up extends er{constructor(e,r){super(),this.relayer=e,this.logger=r}}class Fp extends er{constructor(e,r){super(),this.core=e,this.logger=r}}class jp{constructor(e,r,n){this.core=e,this.logger=r,this.store=n}}class kp{constructor(e,r){this.projectId=e,this.logger=r}}class Mp{constructor(e,r,n){this.core=e,this.logger=r,this.telemetryEnabled=n}}const ss="wc",os=2,tn="core",et=`${ss}@2:${tn}:`,qa={name:tn,logger:"error"},Ga={database:":memory:"},Wa="crypto",as="client_ed25519_seed",Ya=G.ONE_DAY,Za="keychain",Xa="0.3",Ja="messages",Qa="0.3",ec=G.SIX_HOURS,tc="publisher",rc="irn",nc="error",cs="wss://relay.walletconnect.org",ic="relayer",oe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},sc="_subscription",je={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},oc=.1,zp={database:":memory:"},Wn="2.21.9",Vp=1e4,ir={link_mode:"link_mode",relay:"relay"},rn={inbound:"inbound",outbound:"outbound"},ac="0.3",cc="WALLETCONNECT_CLIENT_ID",us="WALLETCONNECT_LINK_MODE_APPS",Be={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Kp=G.THIRTY_DAYS,uc="subscription",lc="0.3",Hp=G.FIVE_SECONDS*1e3,fc="pairing",hc="0.3",qp=G.THIRTY_DAYS,_r={wc_pairingDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:G.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:G.ONE_DAY,prompt:!1,tag:0},res:{ttl:G.ONE_DAY,prompt:!1,tag:0}}},xr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},We={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},dc="history",gc="0.3",pc="expirer",Ye={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},yc="0.3",Gp=G.ONE_DAY,bc="verify-api",Wp="https://verify.walletconnect.com",wc="https://verify.walletconnect.org",nn=wc,mc=`${nn}/v3`,Ec=[Wp,wc],vc="echo",_c="https://echo.walletconnect.com",Yp="event-client",ft={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},bt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Zp={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Xp={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},Jp={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},Qp={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},xc=.1,Dc="event-client",Ic=86400,Sc="https://pulse.walletconnect.org/batch";function e0(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Oc(t,...e){if(!e0(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ac(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function t0(t,e){Oc(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}const Dr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ls=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function r0(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Tc(t){return typeof t=="string"&&(t=r0(t)),Oc(t),t}class n0{clone(){return this._cloneInto()}}function i0(t){const e=n=>t().update(Tc(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Bc(t=32){if(Dr&&typeof Dr.getRandomValues=="function")return Dr.getRandomValues(new Uint8Array(t));if(Dr&&typeof Dr.randomBytes=="function")return Dr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function s0(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}class o0 extends n0{constructor(e,r,n,i){super(),this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ls(this.buffer)}update(e){Ac(this);const{view:r,buffer:n,blockLen:i}=this;e=Tc(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=ls(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ac(this),t0(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;s0(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=ls(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%r&&e.buffer.set(n),e}}const Yn=BigInt(2**32-1),fs=BigInt(32);function Rc(t,e=!1){return e?{h:Number(t&Yn),l:Number(t>>fs&Yn)}:{h:Number(t>>fs&Yn)|0,l:Number(t&Yn)|0}}function a0(t,e=!1){let r=new Uint32Array(t.length),n=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=Rc(t[i],e);[r[i],n[i]]=[s,o]}return[r,n]}const c0=(t,e)=>BigInt(t>>>0)<<fs|BigInt(e>>>0),u0=(t,e,r)=>t>>>r,l0=(t,e,r)=>t<<32-r|e>>>r,f0=(t,e,r)=>t>>>r|e<<32-r,h0=(t,e,r)=>t<<32-r|e>>>r,d0=(t,e,r)=>t<<64-r|e>>>r-32,g0=(t,e,r)=>t>>>r-32|e<<64-r,p0=(t,e)=>e,y0=(t,e)=>t,b0=(t,e,r)=>t<<r|e>>>32-r,w0=(t,e,r)=>e<<r|t>>>32-r,m0=(t,e,r)=>e<<r-32|t>>>64-r,E0=(t,e,r)=>t<<r-32|e>>>64-r;function v0(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const _0=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),x0=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,D0=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),I0=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,S0=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),O0=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,Z={fromBig:Rc,split:a0,toBig:c0,shrSH:u0,shrSL:l0,rotrSH:f0,rotrSL:h0,rotrBH:d0,rotrBL:g0,rotr32H:p0,rotr32L:y0,rotlSH:b0,rotlSL:w0,rotlBH:m0,rotlBL:E0,add:v0,add3L:_0,add3H:x0,add4L:D0,add4H:I0,add5H:O0,add5L:S0},[A0,T0]=Z.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Nt=new Uint32Array(80),$t=new Uint32Array(80);class B0 extends o0{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:d,Gl:g,Hh:y,Hl:E}=this;return[e,r,n,i,s,o,a,c,u,l,h,f,d,g,y,E]}set(e,r,n,i,s,o,a,c,u,l,h,f,d,g,y,E){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=g|0,this.Hh=y|0,this.Hl=E|0}process(e,r){for(let x=0;x<16;x++,r+=4)Nt[x]=e.getUint32(r),$t[x]=e.getUint32(r+=4);for(let x=16;x<80;x++){const R=Nt[x-15]|0,F=$t[x-15]|0,j=Z.rotrSH(R,F,1)^Z.rotrSH(R,F,8)^Z.shrSH(R,F,7),M=Z.rotrSL(R,F,1)^Z.rotrSL(R,F,8)^Z.shrSL(R,F,7),P=Nt[x-2]|0,O=$t[x-2]|0,H=Z.rotrSH(P,O,19)^Z.rotrBH(P,O,61)^Z.shrSH(P,O,6),q=Z.rotrSL(P,O,19)^Z.rotrBL(P,O,61)^Z.shrSL(P,O,6),B=Z.add4L(M,q,$t[x-7],$t[x-16]),m=Z.add4H(B,j,H,Nt[x-7],Nt[x-16]);Nt[x]=m|0,$t[x]=B|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:d,Fl:g,Gh:y,Gl:E,Hh:T,Hl:C}=this;for(let x=0;x<80;x++){const R=Z.rotrSH(h,f,14)^Z.rotrSH(h,f,18)^Z.rotrBH(h,f,41),F=Z.rotrSL(h,f,14)^Z.rotrSL(h,f,18)^Z.rotrBL(h,f,41),j=h&d^~h&y,M=f&g^~f&E,P=Z.add5L(C,F,M,T0[x],$t[x]),O=Z.add5H(P,T,R,j,A0[x],Nt[x]),H=P|0,q=Z.rotrSH(n,i,28)^Z.rotrBH(n,i,34)^Z.rotrBH(n,i,39),B=Z.rotrSL(n,i,28)^Z.rotrBL(n,i,34)^Z.rotrBL(n,i,39),m=n&s^n&a^s&a,w=i&o^i&c^o&c;T=y|0,C=E|0,y=d|0,E=g|0,d=h|0,g=f|0,{h,l:f}=Z.add(u|0,l|0,O|0,H|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const p=Z.add3L(H,B,w);n=Z.add3H(p,O,q,m),i=p|0}({h:n,l:i}=Z.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=Z.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Z.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=Z.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=Z.add(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:g}=Z.add(this.Fh|0,this.Fl|0,d|0,g|0),{h:y,l:E}=Z.add(this.Gh|0,this.Gl|0,y|0,E|0),{h:T,l:C}=Z.add(this.Hh|0,this.Hl|0,T|0,C|0),this.set(n,i,s,o,a,c,u,l,h,f,d,g,y,E,T,C)}roundClean(){Nt.fill(0),$t.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const R0=i0(()=>new B0);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const hs=BigInt(0),Cc=BigInt(1),C0=BigInt(2);function ds(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function gs(t){if(!ds(t))throw new Error("Uint8Array expected")}function ps(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const N0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ys(t){gs(t);let e="";for(let r=0;r<t.length;r++)e+=N0[t[r]];return e}function Nc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?hs:BigInt("0x"+t)}const wt={_0:48,_9:57,A:65,F:70,a:97,f:102};function $c(t){if(t>=wt._0&&t<=wt._9)return t-wt._0;if(t>=wt.A&&t<=wt.F)return t-(wt.A-10);if(t>=wt.a&&t<=wt.f)return t-(wt.a-10)}function Pc(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=$c(t.charCodeAt(s)),a=$c(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function $0(t){return Nc(ys(t))}function Zn(t){return gs(t),Nc(ys(Uint8Array.from(t).reverse()))}function Lc(t,e){return Pc(t.toString(16).padStart(e*2,"0"))}function bs(t,e){return Lc(t,e).reverse()}function mt(t,e,r){let n;if(typeof e=="string")try{n=Pc(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(ds(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}function Uc(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];gs(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}const ws=t=>typeof t=="bigint"&&hs<=t;function P0(t,e,r){return ws(t)&&ws(e)&&ws(r)&&e<=t&&t<r}function sn(t,e,r,n){if(!P0(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function L0(t){let e;for(e=0;t>hs;t>>=Cc,e+=1);return e}const U0=t=>(C0<<BigInt(t-1))-Cc,F0={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||ds(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function ms(t,e,r={}){const n=(i,s,o)=>{const a=F0[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(r))n(i,s,!0);return t}function Fc(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const he=BigInt(0),se=BigInt(1),sr=BigInt(2),j0=BigInt(3),Es=BigInt(4),jc=BigInt(5),kc=BigInt(8);function ue(t,e){const r=t%e;return r>=he?r:e+r}function k0(t,e,r){if(e<he)throw new Error("invalid exponent, negatives unsupported");if(r<=he)throw new Error("invalid modulus");if(r===se)return he;let n=se;for(;e>he;)e&se&&(n=n*t%r),t=t*t%r,e>>=se;return n}function ht(t,e,r){let n=t;for(;e-- >he;)n*=n,n%=r;return n}function Mc(t,e){if(t===he)throw new Error("invert: expected non-zero number");if(e<=he)throw new Error("invert: expected positive modulus, got "+e);let r=ue(t,e),n=e,i=he,s=se;for(;r!==he;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==se)throw new Error("invert: does not exist");return ue(i,e)}function M0(t){const e=(t-se)/sr;let r,n,i;for(r=t-se,n=0;r%sr===he;r/=sr,n++);for(i=sr;i<t&&k0(i,e,t)!==t-se;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(t+se)/Es;return function(a,c){const u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}const s=(r+se)/sr;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,u=o.pow(o.mul(o.ONE,i),r),l=o.pow(a,s),h=o.pow(a,r);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let g=o.sqr(h);f<c&&!o.eql(g,o.ONE);f++)g=o.sqr(g);const d=o.pow(u,se<<BigInt(c-f-1));u=o.sqr(d),l=o.mul(l,d),h=o.mul(h,u),c=f}return l}}function z0(t){if(t%Es===j0){const e=(t+se)/Es;return function(r,n){const i=r.pow(n,e);if(!r.eql(r.sqr(i),n))throw new Error("Cannot find square root");return i}}if(t%kc===jc){const e=(t-jc)/kc;return function(r,n){const i=r.mul(n,sr),s=r.pow(i,e),o=r.mul(n,s),a=r.mul(r.mul(o,sr),s),c=r.mul(o,r.sub(a,r.ONE));if(!r.eql(r.sqr(c),n))throw new Error("Cannot find square root");return c}}return M0(t)}const V0=(t,e)=>(ue(t,e)&se)===se,K0=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function H0(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=K0.reduce((n,i)=>(n[i]="function",n),e);return ms(t,r)}function q0(t,e,r){if(r<he)throw new Error("invalid exponent, negatives unsupported");if(r===he)return t.ONE;if(r===se)return e;let n=t.ONE,i=e;for(;r>he;)r&se&&(n=t.mul(n,i)),i=t.sqr(i),r>>=se;return n}function G0(t,e){const r=new Array(e.length),n=e.reduce((s,o,a)=>t.is0(o)?s:(r[a]=s,t.mul(s,o)),t.ONE),i=t.inv(n);return e.reduceRight((s,o,a)=>t.is0(o)?s:(r[a]=t.mul(s,r[a]),t.mul(s,o)),i),r}function zc(t,e){const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Vc(t,e,r=!1,n={}){if(t<=he)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=zc(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:U0(i),ZERO:he,ONE:se,create:c=>ue(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return he<=c&&c<t},is0:c=>c===he,isOdd:c=>(c&se)===se,neg:c=>ue(-c,t),eql:(c,u)=>c===u,sqr:c=>ue(c*c,t),add:(c,u)=>ue(c+u,t),sub:(c,u)=>ue(c-u,t),mul:(c,u)=>ue(c*u,t),pow:(c,u)=>q0(a,c,u),div:(c,u)=>ue(c*Mc(u,t),t),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Mc(c,t),sqrt:n.sqrt||(c=>(o||(o=z0(t)),o(a,c))),invertBatch:c=>G0(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>r?bs(c,s):Lc(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return r?Zn(c):$0(c)}});return Object.freeze(a)}const Kc=BigInt(0),Xn=BigInt(1);function vs(t,e){const r=e.negate();return t?r:e}function Hc(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function _s(t,e){Hc(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1);return{windows:r,windowSize:n}}function W0(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function Y0(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const xs=new WeakMap,qc=new WeakMap;function Ds(t){return qc.get(t)||1}function Z0(t,e){return{constTimeNegate:vs,hasPrecomputes(r){return Ds(r)!==1},unsafeLadder(r,n,i=t.ZERO){let s=r;for(;n>Kc;)n&Xn&&(i=i.add(s)),s=s.double(),n>>=Xn;return i},precomputeWindow(r,n){const{windows:i,windowSize:s}=_s(n,e),o=[];let a=r,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(r,n,i){const{windows:s,windowSize:o}=_s(r,e);let a=t.ZERO,c=t.BASE;const u=BigInt(2**r-1),l=2**r,h=BigInt(r);for(let f=0;f<s;f++){const d=f*o;let g=Number(i&u);i>>=h,g>o&&(g-=l,i+=Xn);const y=d,E=d+Math.abs(g)-1,T=f%2!==0,C=g<0;g===0?c=c.add(vs(T,n[y])):a=a.add(vs(C,n[E]))}return{p:a,f:c}},wNAFUnsafe(r,n,i,s=t.ZERO){const{windows:o,windowSize:a}=_s(r,e),c=BigInt(2**r-1),u=2**r,l=BigInt(r);for(let h=0;h<o;h++){const f=h*a;if(i===Kc)break;let d=Number(i&c);if(i>>=l,d>a&&(d-=u,i+=Xn),d===0)continue;let g=n[f+Math.abs(d)-1];d<0&&(g=g.negate()),s=s.add(g)}return s},getPrecomputes(r,n,i){let s=xs.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&xs.set(n,i(s))),s},wNAFCached(r,n,i){const s=Ds(r);return this.wNAF(s,this.getPrecomputes(s,r,i),n)},wNAFCachedUnsafe(r,n,i,s){const o=Ds(r);return o===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,r,i),n,s)},setWindowSize(r,n){Hc(n,e),qc.set(r,n),xs.delete(r)}}}function X0(t,e,r,n){if(W0(r,t),Y0(n,e),r.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=L0(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let l=i;for(let h=u;h>=0;h-=o){c.fill(i);for(let d=0;d<n.length;d++){const g=n[d],y=Number(g>>BigInt(h)&BigInt(a));c[y]=c[y].add(r[d])}let f=i;for(let d=c.length-1,g=i;d>0;d--)g=g.add(c[d]),f=f.add(g);if(l=l.add(f),h!==0)for(let d=0;d<o;d++)l=l.double()}return l}function J0(t){return H0(t.Fp),ms(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...zc(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const tt=BigInt(0),Re=BigInt(1),Jn=BigInt(2),Q0=BigInt(8),ey={zip215:!0};function ty(t){const e=J0(t);return ms(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function ry(t){const e=ty(t),{Fp:r,n,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=Jn<<BigInt(a*8)-Re,l=r.create,h=Vc(e.n,e.nBitLength),f=e.uvRatio||((p,b)=>{try{return{isValid:!0,value:r.sqrt(p*r.inv(b))}}catch{return{isValid:!1,value:tt}}}),d=e.adjustScalarBytes||(p=>p),g=e.domain||((p,b,v)=>{if(ps("phflag",v),b.length||v)throw new Error("Contexts/pre-hash are not supported");return p});function y(p,b){sn("coordinate "+p,b,tt,u)}function E(p){if(!(p instanceof x))throw new Error("ExtendedPoint expected")}const T=Fc((p,b)=>{const{ex:v,ey:D,ez:_}=p,I=p.is0();b==null&&(b=I?Q0:r.inv(_));const S=l(v*b),A=l(D*b),U=l(_*b);if(I)return{x:tt,y:Re};if(U!==Re)throw new Error("invZ was invalid");return{x:S,y:A}}),C=Fc(p=>{const{a:b,d:v}=e;if(p.is0())throw new Error("bad point: ZERO");const{ex:D,ey:_,ez:I,et:S}=p,A=l(D*D),U=l(_*_),L=l(I*I),N=l(L*L),z=l(A*b),K=l(L*l(z+U)),W=l(N+l(v*l(A*U)));if(K!==W)throw new Error("bad point: equation left != right (1)");const V=l(D*_),Y=l(I*S);if(V!==Y)throw new Error("bad point: equation left != right (2)");return!0});class x{constructor(b,v,D,_){this.ex=b,this.ey=v,this.ez=D,this.et=_,y("x",b),y("y",v),y("z",D),y("t",_),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(b){if(b instanceof x)throw new Error("extended point not allowed");const{x:v,y:D}=b||{};return y("x",v),y("y",D),new x(v,D,Re,l(v*D))}static normalizeZ(b){const v=r.invertBatch(b.map(D=>D.ez));return b.map((D,_)=>D.toAffine(v[_])).map(x.fromAffine)}static msm(b,v){return X0(x,h,b,v)}_setWindowSize(b){j.setWindowSize(this,b)}assertValidity(){C(this)}equals(b){E(b);const{ex:v,ey:D,ez:_}=this,{ex:I,ey:S,ez:A}=b,U=l(v*A),L=l(I*_),N=l(D*A),z=l(S*_);return U===L&&N===z}is0(){return this.equals(x.ZERO)}negate(){return new x(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:b}=e,{ex:v,ey:D,ez:_}=this,I=l(v*v),S=l(D*D),A=l(Jn*l(_*_)),U=l(b*I),L=v+D,N=l(l(L*L)-I-S),z=U+S,K=z-A,W=U-S,V=l(N*K),Y=l(z*W),ce=l(N*W),qe=l(K*z);return new x(V,Y,qe,ce)}add(b){E(b);const{a:v,d:D}=e,{ex:_,ey:I,ez:S,et:A}=this,{ex:U,ey:L,ez:N,et:z}=b;if(v===BigInt(-1)){const Ad=l((I-_)*(L+U)),Td=l((I+_)*(L-U)),ca=l(Td-Ad);if(ca===tt)return this.double();const Bd=l(S*Jn*z),Rd=l(A*Jn*N),Cd=Rd+Bd,Nd=Td+Ad,$d=Rd-Bd,F8=l(Cd*ca),j8=l(Nd*$d),k8=l(Cd*$d),M8=l(ca*Nd);return new x(F8,j8,M8,k8)}const K=l(_*U),W=l(I*L),V=l(A*D*z),Y=l(S*N),ce=l((_+I)*(U+L)-K-W),qe=Y-V,ct=Y+V,Ln=l(W-v*K),$8=l(ce*qe),P8=l(ct*Ln),L8=l(ce*Ln),U8=l(qe*ct);return new x($8,P8,U8,L8)}subtract(b){return this.add(b.negate())}wNAF(b){return j.wNAFCached(this,b,x.normalizeZ)}multiply(b){const v=b;sn("scalar",v,Re,n);const{p:D,f:_}=this.wNAF(v);return x.normalizeZ([D,_])[0]}multiplyUnsafe(b,v=x.ZERO){const D=b;return sn("scalar",D,tt,n),D===tt?F:this.is0()||D===Re?this:j.wNAFCachedUnsafe(this,D,x.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return j.unsafeLadder(this,n).is0()}toAffine(b){return T(this,b)}clearCofactor(){const{h:b}=e;return b===Re?this:this.multiplyUnsafe(b)}static fromHex(b,v=!1){const{d:D,a:_}=e,I=r.BYTES;b=mt("pointHex",b,I),ps("zip215",v);const S=b.slice(),A=b[I-1];S[I-1]=A&-129;const U=Zn(S),L=v?u:r.ORDER;sn("pointHex.y",U,tt,L);const N=l(U*U),z=l(N-Re),K=l(D*N-_);let{isValid:W,value:V}=f(z,K);if(!W)throw new Error("Point.fromHex: invalid y coordinate");const Y=(V&Re)===Re,ce=(A&128)!==0;if(!v&&V===tt&&ce)throw new Error("Point.fromHex: x=0 and x_0=1");return ce!==Y&&(V=l(-V)),x.fromAffine({x:V,y:U})}static fromPrivateKey(b){return O(b).point}toRawBytes(){const{x:b,y:v}=this.toAffine(),D=bs(v,r.BYTES);return D[D.length-1]|=b&Re?128:0,D}toHex(){return ys(this.toRawBytes())}}x.BASE=new x(e.Gx,e.Gy,Re,l(e.Gx*e.Gy)),x.ZERO=new x(tt,Re,Re,tt);const{BASE:R,ZERO:F}=x,j=Z0(x,a*8);function M(p){return ue(p,n)}function P(p){return M(Zn(p))}function O(p){const b=r.BYTES;p=mt("private key",p,b);const v=mt("hashed private key",s(p),2*b),D=d(v.slice(0,b)),_=v.slice(b,2*b),I=P(D),S=R.multiply(I),A=S.toRawBytes();return{head:D,prefix:_,scalar:I,point:S,pointBytes:A}}function H(p){return O(p).pointBytes}function q(p=new Uint8Array,...b){const v=Uc(...b);return P(s(g(v,mt("context",p),!!i)))}function B(p,b,v={}){p=mt("message",p),i&&(p=i(p));const{prefix:D,scalar:_,pointBytes:I}=O(b),S=q(v.context,D,p),A=R.multiply(S).toRawBytes(),U=q(v.context,A,I,p),L=M(S+U*_);sn("signature.s",L,tt,n);const N=Uc(A,bs(L,r.BYTES));return mt("result",N,r.BYTES*2)}const m=ey;function w(p,b,v,D=m){const{context:_,zip215:I}=D,S=r.BYTES;p=mt("signature",p,2*S),b=mt("message",b),v=mt("publicKey",v,S),I!==void 0&&ps("zip215",I),i&&(b=i(b));const A=Zn(p.slice(S,2*S));let U,L,N;try{U=x.fromHex(v,I),L=x.fromHex(p.slice(0,S),I),N=R.multiplyUnsafe(A)}catch{return!1}if(!I&&U.isSmallOrder())return!1;const z=q(_,L.toRawBytes(),U.toRawBytes(),b);return L.add(U.multiplyUnsafe(z)).subtract(N).clearCofactor().equals(x.ZERO)}return R._setWindowSize(8),{CURVE:e,getPublicKey:H,sign:B,verify:w,ExtendedPoint:x,utils:{getExtendedPublicKey:O,randomPrivateKey:()=>o(r.BYTES),precompute(p=8,b=x.BASE){return b._setWindowSize(p),b.multiply(BigInt(3)),b}}}}BigInt(0),BigInt(1);const Is=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Gc=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const ny=BigInt(1),Wc=BigInt(2);BigInt(3);const iy=BigInt(5),sy=BigInt(8);function oy(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=Is,o=t*t%s*t%s,a=ht(o,Wc,s)*o%s,c=ht(a,ny,s)*t%s,u=ht(c,iy,s)*c%s,l=ht(u,e,s)*u%s,h=ht(l,r,s)*l%s,f=ht(h,n,s)*h%s,d=ht(f,i,s)*f%s,g=ht(d,i,s)*f%s,y=ht(g,e,s)*u%s;return{pow_p_5_8:ht(y,Wc,s)*t%s,b2:o}}function ay(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function cy(t,e){const r=Is,n=ue(e*e*e,r),i=ue(n*n*e,r),s=oy(t*i).pow_p_5_8;let o=ue(t*n*s,r);const a=ue(e*o*o,r),c=o,u=ue(o*Gc,r),l=a===t,h=a===ue(-t,r),f=a===ue(-t*Gc,r);return l&&(o=c),(h||f)&&(o=u),V0(o,r)&&(o=ue(-o,r)),{isValid:l||h,value:o}}const uy=Vc(Is,void 0,!0),ly={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:uy,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:sy,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:R0,randomBytes:Bc,adjustScalarBytes:ay,uvRatio:cy},Yc=ry(ly),fy="EdDSA",hy="JWT",Qn=".",ei="base64url",Zc="utf8",Xc="utf8",dy=":",gy="did",py="key",Jc="base58btc",yy="z",by="K36",wy=32;function Ss(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Qc(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ss(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function eu(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=Qc(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return Ss(r)}function my(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var y=0,E=0,T=0,C=g.length;T!==C&&g[T]===0;)T++,y++;for(var x=(C-T)*l+1>>>0,R=new Uint8Array(x);T!==C;){for(var F=g[T],j=0,M=x-1;(F!==0||j<E)&&M!==-1;M--,j++)F+=256*R[M]>>>0,R[M]=F%a>>>0,F=F/a>>>0;if(F!==0)throw new Error("Non-zero carry");E=j,T++}for(var P=x-E;P!==x&&R[P]===0;)P++;for(var O=c.repeat(y);P<x;++P)O+=t.charAt(R[P]);return O}function f(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var y=0;if(g[y]!==" "){for(var E=0,T=0;g[y]===c;)E++,y++;for(var C=(g.length-y)*u+1>>>0,x=new Uint8Array(C);g[y];){var R=r[g.charCodeAt(y)];if(R===255)return;for(var F=0,j=C-1;(R!==0||F<T)&&j!==-1;j--,F++)R+=a*x[j]>>>0,x[j]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");T=F,y++}if(g[y]!==" "){for(var M=C-T;M!==C&&x[M]===0;)M++;for(var P=new Uint8Array(E+(C-M)),O=E;M!==C;)P[O++]=x[M++];return P}}}function d(g){var y=f(g);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var Ey=my,vy=Ey;const tu=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},_y=t=>new TextEncoder().encode(t),xy=t=>new TextDecoder().decode(t);class Dy{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Iy{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ru(this,e)}}class Sy{constructor(e){this.decoders=e}or(e){return ru(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ru=(t,e)=>new Sy({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Oy{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new Dy(e,r,n),this.decoder=new Iy(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ti=({name:t,prefix:e,encode:r,decode:n})=>new Oy(t,e,r,n),on=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=vy(r,e);return ti({prefix:t,name:e,encode:n,decode:s=>tu(i(s))})},Ay=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Ty=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},ge=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>ti({prefix:e,name:t,encode(i){return Ty(i,n,r)},decode(i){return Ay(i,n,r,t)}}),By=ti({prefix:"\0",name:"identity",encode:t=>xy(t),decode:t=>_y(t)});var Ry=Object.freeze({__proto__:null,identity:By});const Cy=ge({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Ny=Object.freeze({__proto__:null,base2:Cy});const $y=ge({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Py=Object.freeze({__proto__:null,base8:$y});const Ly=on({prefix:"9",name:"base10",alphabet:"0123456789"});var Uy=Object.freeze({__proto__:null,base10:Ly});const Fy=ge({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),jy=ge({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ky=Object.freeze({__proto__:null,base16:Fy,base16upper:jy});const My=ge({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),zy=ge({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Vy=ge({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ky=ge({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Hy=ge({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),qy=ge({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Gy=ge({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Wy=ge({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Yy=ge({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Zy=Object.freeze({__proto__:null,base32:My,base32upper:zy,base32pad:Vy,base32padupper:Ky,base32hex:Hy,base32hexupper:qy,base32hexpad:Gy,base32hexpadupper:Wy,base32z:Yy});const Xy=on({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Jy=on({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Qy=Object.freeze({__proto__:null,base36:Xy,base36upper:Jy});const eb=on({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),tb=on({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var rb=Object.freeze({__proto__:null,base58btc:eb,base58flickr:tb});const nb=ge({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ib=ge({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),sb=ge({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ob=ge({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var ab=Object.freeze({__proto__:null,base64:nb,base64pad:ib,base64url:sb,base64urlpad:ob});const nu=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),cb=nu.reduce((t,e,r)=>(t[r]=e,t),[]),ub=nu.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function lb(t){return t.reduce((e,r)=>(e+=cb[r],e),"")}function fb(t){const e=[];for(const r of t){const n=ub[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const hb=ti({prefix:"\u{1F680}",name:"base256emoji",encode:lb,decode:fb});var db=Object.freeze({__proto__:null,base256emoji:hb}),gb=su,iu=128,pb=127,yb=~pb,bb=Math.pow(2,31);function su(t,e,r){e=e||[],r=r||0;for(var n=r;t>=bb;)e[r++]=t&255|iu,t/=128;for(;t&yb;)e[r++]=t&255|iu,t>>>=7;return e[r]=t|0,su.bytes=r-n+1,e}var wb=Os,mb=128,ou=127;function Os(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw Os.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&ou)<<i:(o&ou)*Math.pow(2,i),i+=7}while(o>=mb);return Os.bytes=s-n,r}var Eb=Math.pow(2,7),vb=Math.pow(2,14),_b=Math.pow(2,21),xb=Math.pow(2,28),Db=Math.pow(2,35),Ib=Math.pow(2,42),Sb=Math.pow(2,49),Ob=Math.pow(2,56),Ab=Math.pow(2,63),Tb=function(t){return t<Eb?1:t<vb?2:t<_b?3:t<xb?4:t<Db?5:t<Ib?6:t<Sb?7:t<Ob?8:t<Ab?9:10},Bb={encode:gb,decode:wb,encodingLength:Tb},au=Bb;const cu=(t,e,r=0)=>(au.encode(t,e,r),e),uu=t=>au.encodingLength(t),As=(t,e)=>{const r=e.byteLength,n=uu(t),i=n+uu(r),s=new Uint8Array(i+r);return cu(t,s,0),cu(r,s,n),s.set(e,i),new Rb(t,r,e,s)};class Rb{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}}const lu=({name:t,code:e,encode:r})=>new Cb(t,e,r);class Cb{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?As(this.code,r):r.then(n=>As(this.code,n))}else throw Error("Unknown type, must be binary type")}}const fu=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Nb=lu({name:"sha2-256",code:18,encode:fu("SHA-256")}),$b=lu({name:"sha2-512",code:19,encode:fu("SHA-512")});var Pb=Object.freeze({__proto__:null,sha256:Nb,sha512:$b});const hu=0,Lb="identity",du=tu;var Ub=Object.freeze({__proto__:null,identity:{code:hu,name:Lb,encode:du,digest:t=>As(hu,du(t))}});new TextEncoder,new TextDecoder;const gu={...Ry,...Ny,...Py,...Uy,...ky,...Zy,...Qy,...rb,...ab,...db};({...Pb,...Ub});function pu(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const yu=pu("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ts=pu("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Qc(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),bu={utf8:yu,"utf-8":yu,hex:gu.base16,latin1:Ts,ascii:Ts,binary:Ts,...gu};function ri(t,e="utf8"){const r=bu[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function Ir(t,e="utf8"){const r=bu[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ss(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function wu(t){return mr(ri(Ir(t,ei),Zc))}function ni(t){return ri(Ir(nr(t),Zc),ei)}function mu(t){const e=Ir(by,Jc),r=yy+ri(eu([e,t]),Jc);return[gy,py,r].join(dy)}function Fb(t){return ri(t,ei)}function jb(t){return Ir(t,ei)}function kb(t){return Ir([ni(t.header),ni(t.payload)].join(Qn),Xc)}function Mb(t){return[ni(t.header),ni(t.payload),Fb(t.signature)].join(Qn)}function Bs(t){const e=t.split(Qn),r=wu(e[0]),n=wu(e[1]),i=jb(e[2]),s=Ir(e.slice(0,2).join(Qn),Xc);return{header:r,payload:n,signature:i,data:s}}function Eu(t=Bc(wy)){const e=Yc.getPublicKey(t);return{secretKey:eu([t,e]),publicKey:e}}async function zb(t,e,r,n,i=G.fromMiliseconds(Date.now())){const s={alg:fy,typ:hy},o=mu(n.publicKey),a=i+r,c={iss:o,sub:t,aud:e,iat:i,exp:a},u=kb({header:s,payload:c}),l=Yc.sign(u,n.secretKey.slice(0,32));return Mb({header:s,payload:c,signature:l})}function Vb(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(r[o]!==255)throw new TypeError(s+" is ambiguous");r[o]=i}var a=t.length,c=t.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var y=0,E=0,T=0,C=g.length;T!==C&&g[T]===0;)T++,y++;for(var x=(C-T)*l+1>>>0,R=new Uint8Array(x);T!==C;){for(var F=g[T],j=0,M=x-1;(F!==0||j<E)&&M!==-1;M--,j++)F+=256*R[M]>>>0,R[M]=F%a>>>0,F=F/a>>>0;if(F!==0)throw new Error("Non-zero carry");E=j,T++}for(var P=x-E;P!==x&&R[P]===0;)P++;for(var O=c.repeat(y);P<x;++P)O+=t.charAt(R[P]);return O}function f(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var y=0;if(g[y]!==" "){for(var E=0,T=0;g[y]===c;)E++,y++;for(var C=(g.length-y)*u+1>>>0,x=new Uint8Array(C);g[y];){var R=r[g.charCodeAt(y)];if(R===255)return;for(var F=0,j=C-1;(R!==0||F<T)&&j!==-1;j--,F++)R+=a*x[j]>>>0,x[j]=R%256>>>0,R=R/256>>>0;if(R!==0)throw new Error("Non-zero carry");T=F,y++}if(g[y]!==" "){for(var M=C-T;M!==C&&x[M]===0;)M++;for(var P=new Uint8Array(E+(C-M)),O=E;M!==C;)P[O++]=x[M++];return P}}}function d(g){var y=f(g);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var Kb=Vb,Hb=Kb;const vu=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},qb=t=>new TextEncoder().encode(t),Gb=t=>new TextDecoder().decode(t);class Wb{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Yb{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return _u(this,e)}}class Zb{constructor(e){this.decoders=e}or(e){return _u(this,e)}decode(e){const r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const _u=(t,e)=>new Zb({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Xb{constructor(e,r,n,i){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=i,this.encoder=new Wb(e,r,n),this.decoder=new Yb(e,r,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ii=({name:t,prefix:e,encode:r,decode:n})=>new Xb(t,e,r,n),an=({prefix:t,name:e,alphabet:r})=>{const{encode:n,decode:i}=Hb(r,e);return ii({prefix:t,name:e,encode:n,decode:s=>vu(i(s))})},Jb=(t,e,r,n)=>{const i={};for(let l=0;l<e.length;++l)i[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*r/8|0);let a=0,c=0,u=0;for(let l=0;l<s;++l){const h=i[t[l]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Qb=(t,e,r)=>{const n=e[e.length-1]==="=",i=(1<<r)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>r;)o-=r,s+=e[i&a>>o];if(o&&(s+=e[i&a<<r-o]),n)for(;s.length*r&7;)s+="=";return s},pe=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>ii({prefix:e,name:t,encode(i){return Qb(i,n,r)},decode(i){return Jb(i,n,r,t)}}),ew=ii({prefix:"\0",name:"identity",encode:t=>Gb(t),decode:t=>qb(t)});var tw=Object.freeze({__proto__:null,identity:ew});const rw=pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var nw=Object.freeze({__proto__:null,base2:rw});const iw=pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var sw=Object.freeze({__proto__:null,base8:iw});const ow=an({prefix:"9",name:"base10",alphabet:"0123456789"});var aw=Object.freeze({__proto__:null,base10:ow});const cw=pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),uw=pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var lw=Object.freeze({__proto__:null,base16:cw,base16upper:uw});const fw=pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),hw=pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),dw=pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gw=pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),pw=pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),yw=pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),bw=pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ww=pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),mw=pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Ew=Object.freeze({__proto__:null,base32:fw,base32upper:hw,base32pad:dw,base32padupper:gw,base32hex:pw,base32hexupper:yw,base32hexpad:bw,base32hexpadupper:ww,base32z:mw});const vw=an({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_w=an({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var xw=Object.freeze({__proto__:null,base36:vw,base36upper:_w});const Dw=an({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Iw=an({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Sw=Object.freeze({__proto__:null,base58btc:Dw,base58flickr:Iw});const Ow=pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Aw=pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Tw=pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Bw=pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Rw=Object.freeze({__proto__:null,base64:Ow,base64pad:Aw,base64url:Tw,base64urlpad:Bw});const xu=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Cw=xu.reduce((t,e,r)=>(t[r]=e,t),[]),Nw=xu.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function $w(t){return t.reduce((e,r)=>(e+=Cw[r],e),"")}function Pw(t){const e=[];for(const r of t){const n=Nw[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}const Lw=ii({prefix:"\u{1F680}",name:"base256emoji",encode:$w,decode:Pw});var Uw=Object.freeze({__proto__:null,base256emoji:Lw}),Fw=Iu,Du=128,jw=127,kw=~jw,Mw=Math.pow(2,31);function Iu(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Mw;)e[r++]=t&255|Du,t/=128;for(;t&kw;)e[r++]=t&255|Du,t>>>=7;return e[r]=t|0,Iu.bytes=r-n+1,e}var zw=Rs,Vw=128,Su=127;function Rs(t,n){var r=0,n=n||0,i=0,s=n,o,a=t.length;do{if(s>=a)throw Rs.bytes=0,new RangeError("Could not decode varint");o=t[s++],r+=i<28?(o&Su)<<i:(o&Su)*Math.pow(2,i),i+=7}while(o>=Vw);return Rs.bytes=s-n,r}var Kw=Math.pow(2,7),Hw=Math.pow(2,14),qw=Math.pow(2,21),Gw=Math.pow(2,28),Ww=Math.pow(2,35),Yw=Math.pow(2,42),Zw=Math.pow(2,49),Xw=Math.pow(2,56),Jw=Math.pow(2,63),Qw=function(t){return t<Kw?1:t<Hw?2:t<qw?3:t<Gw?4:t<Ww?5:t<Yw?6:t<Zw?7:t<Xw?8:t<Jw?9:10},e1={encode:Fw,decode:zw,encodingLength:Qw},Ou=e1;const Au=(t,e,r=0)=>(Ou.encode(t,e,r),e),Tu=t=>Ou.encodingLength(t),Cs=(t,e)=>{const r=e.byteLength,n=Tu(t),i=n+Tu(r),s=new Uint8Array(i+r);return Au(t,s,0),Au(r,s,n),s.set(e,i),new t1(t,r,e,s)};class t1{constructor(e,r,n,i){this.code=e,this.size=r,this.digest=n,this.bytes=i}}const Bu=({name:t,code:e,encode:r})=>new r1(t,e,r);class r1{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Cs(this.code,r):r.then(n=>Cs(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Ru=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),n1=Bu({name:"sha2-256",code:18,encode:Ru("SHA-256")}),i1=Bu({name:"sha2-512",code:19,encode:Ru("SHA-512")});var s1=Object.freeze({__proto__:null,sha256:n1,sha512:i1});const Cu=0,o1="identity",Nu=vu;var a1=Object.freeze({__proto__:null,identity:{code:Cu,name:o1,encode:Nu,digest:t=>Cs(Cu,Nu(t))}});new TextEncoder,new TextDecoder;const $u={...tw,...nw,...sw,...aw,...lw,...Ew,...xw,...Sw,...Rw,...Uw};({...s1,...a1});function Ns(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Pu(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ns(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Lu(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}const Uu=Lu("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),$s=Lu("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Pu(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Fu={utf8:Uu,"utf-8":Uu,hex:$u.base16,latin1:$s,ascii:$s,binary:$s,...$u};function ke(t,e="utf8"){const r=Fu[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ns(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}var ju=function(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))},c1=function(){function t(e,r,n){this.name=e,this.version=r,this.os=n,this.type="browser"}return t}(),u1=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),l1=function(){function t(e,r,n,i){this.name=e,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return t}(),f1=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),h1=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),d1=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,g1=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,ku=3,p1=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",d1]],Mu=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function y1(t){return t?zu(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new h1:typeof navigator<"u"?zu(navigator.userAgent):m1()}function b1(t){return t!==""&&p1.reduce(function(e,r){var n=r[0],i=r[1];if(e)return e;var s=i.exec(t);return!!s&&[n,s]},!1)}function zu(t){var e=b1(t);if(!e)return null;var r=e[0],n=e[1];if(r==="searchbot")return new f1;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<ku&&(i=ju(ju([],i,!0),E1(ku-i.length),!0)):i=[];var s=i.join("."),o=w1(t),a=g1.exec(t);return a&&a[1]?new l1(r,s,o,a[1]):new c1(r,s,o)}function w1(t){for(var e=0,r=Mu.length;e<r;e++){var n=Mu[e],i=n[0],s=n[1],o=s.exec(t);if(o)return i}return null}function m1(){var t=typeof process<"u"&&process.version;return t?new u1(process.version.slice(1)):null}function E1(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var ne={};Object.defineProperty(ne,"__esModule",{value:!0}),ne.getLocalStorage=ne.getLocalStorageOrThrow=ne.getCrypto=ne.getCryptoOrThrow=Vu=ne.getLocation=ne.getLocationOrThrow=Ps=ne.getNavigator=ne.getNavigatorOrThrow=Or=ne.getDocument=ne.getDocumentOrThrow=ne.getFromWindowOrThrow=ne.getFromWindow=void 0;function or(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}ne.getFromWindow=or;function Sr(t){const e=or(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}ne.getFromWindowOrThrow=Sr;function v1(){return Sr("document")}ne.getDocumentOrThrow=v1;function _1(){return or("document")}var Or=ne.getDocument=_1;function x1(){return Sr("navigator")}ne.getNavigatorOrThrow=x1;function D1(){return or("navigator")}var Ps=ne.getNavigator=D1;function I1(){return Sr("location")}ne.getLocationOrThrow=I1;function S1(){return or("location")}var Vu=ne.getLocation=S1;function O1(){return Sr("crypto")}ne.getCryptoOrThrow=O1;function A1(){return or("crypto")}ne.getCrypto=A1;function T1(){return Sr("localStorage")}ne.getLocalStorageOrThrow=T1;function B1(){return or("localStorage")}ne.getLocalStorage=B1;var Ls={};Object.defineProperty(Ls,"__esModule",{value:!0});var Ku=Ls.getWindowMetadata=void 0;const Hu=ne;function R1(){let t,e;try{t=Hu.getDocumentOrThrow(),e=Hu.getLocationOrThrow()}catch{return null}function r(){const h=t.getElementsByTagName("link"),f=[];for(let d=0;d<h.length;d++){const g=h[d],y=g.getAttribute("rel");if(y&&y.toLowerCase().indexOf("icon")>-1){const E=g.getAttribute("href");if(E)if(E.toLowerCase().indexOf("https:")===-1&&E.toLowerCase().indexOf("http:")===-1&&E.indexOf("//")!==0){let T=e.protocol+"//"+e.host;if(E.indexOf("/")===0)T+=E;else{const C=e.pathname.split("/");C.pop();const x=C.join("/");T+=x+"/"+E}f.push(T)}else if(E.indexOf("//")===0){const T=e.protocol+E;f.push(T)}else f.push(E)}}return f}function n(...h){const f=t.getElementsByTagName("meta");for(let d=0;d<f.length;d++){const g=f[d],y=["itemprop","property","name"].map(E=>g.getAttribute(E)).filter(E=>E?h.includes(E):!1);if(y.length&&y){const E=g.getAttribute("content");if(E)return E}}return""}function i(){let h=n("name","og:site_name","og:title","twitter:title");return h||(h=t.title),h}function s(){return n("description","og:description","twitter:description","keywords")}const o=i(),a=s(),c=e.origin,u=r();return{description:a,url:c,icons:u,name:o}}Ku=Ls.getWindowMetadata=R1;const qu="2.36.0";let Us={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:r})=>e?`${t??"https://viem.sh"}${e}${r?`#${r}`:""}`:void 0,version:`viem@${qu}`};class cn extends Error{constructor(e,r={}){const n=r.cause instanceof cn?r.cause.details:r.cause?.message?r.cause.message:r.details,i=r.cause instanceof cn&&r.cause.docsPath||r.docsPath,s=Us.getDocsUrl?.({...r,docsPath:i}),o=[e||"An error occurred.","",...r.metaMessages?[...r.metaMessages,""]:[],...s?[`Docs: ${s}`]:[],...n?[`Details: ${n}`]:[],...Us.version?[`Version: ${Us.version}`]:[]].join(`
`);super(o,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=n,this.docsPath=i,this.metaMessages=r.metaMessages,this.name=r.name??this.name,this.shortMessage=e,this.version=qu}walk(e){return Gu(this,e)}}function Gu(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?Gu(t.cause,e):e?null:t}class Wu extends cn{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${r}).`,{name:"SizeExceedsPaddingSizeError"})}}function C1(t,{dir:e,size:r=32}={}){return typeof t=="string"?N1(t,{dir:e,size:r}):$1(t,{dir:e,size:r})}function N1(t,{dir:e,size:r=32}={}){if(r===null)return t;const n=t.replace("0x","");if(n.length>r*2)throw new Wu({size:Math.ceil(n.length/2),targetSize:r,type:"hex"});return`0x${n[e==="right"?"padEnd":"padStart"](r*2,"0")}`}function $1(t,{dir:e,size:r=32}={}){if(r===null)return t;if(t.length>r)throw new Wu({size:t.length,targetSize:r,type:"bytes"});const n=new Uint8Array(r);for(let i=0;i<r;i++){const s=e==="right";n[s?i:r-i-1]=t[s?i:t.length-i-1]}return n}class P1 extends cn{constructor({max:e,min:r,signed:n,size:i,value:s}){super(`Number "${s}" is not in safe ${i?`${i*8}-bit ${n?"signed":"unsigned"} `:""}integer range ${e?`(${r} to ${e})`:`(above ${r})`}`,{name:"IntegerOutOfRangeError"})}}function L1(t,e={}){const{signed:r,size:n}=e,i=BigInt(t);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<o){const c=typeof t=="bigint"?"n":"";throw new P1({max:s?`${s}${c}`:void 0,min:`${o}${c}`,signed:r,size:n,value:`${t}${c}`})}const a=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?C1(a,{size:n}):a}const si=BigInt(2**32-1),Yu=BigInt(32);function U1(t,e=!1){return e?{h:Number(t&si),l:Number(t>>Yu&si)}:{h:Number(t>>Yu&si)|0,l:Number(t&si)|0}}function F1(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=U1(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const j1=(t,e,r)=>t<<r|e>>>32-r,k1=(t,e,r)=>e<<r|t>>>32-r,M1=(t,e,r)=>e<<r-32|t>>>64-r,z1=(t,e,r)=>t<<r-32|e>>>64-r,Ar=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function oi(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function un(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Et(t,...e){if(!oi(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Zu(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");un(t.outputLen),un(t.blockLen)}function Tr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Xu(t,e){Et(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function V1(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Br(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Fs(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function dt(t,e){return t<<32-e|t>>>e}const K1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function H1(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function q1(t){for(let e=0;e<t.length;e++)t[e]=H1(t[e]);return t}const Ju=K1?t=>t:q1,Qu=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",G1=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Rr(t){if(Et(t),Qu)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=G1[t[r]];return e}const vt={_0:48,_9:57,A:65,F:70,a:97,f:102};function el(t){if(t>=vt._0&&t<=vt._9)return t-vt._0;if(t>=vt.A&&t<=vt.F)return t-(vt.A-10);if(t>=vt.a&&t<=vt.f)return t-(vt.a-10)}function ai(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Qu)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=el(t.charCodeAt(s)),a=el(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function tl(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ci(t){return typeof t=="string"&&(t=tl(t)),Et(t),t}function Pt(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Et(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class js{}function rl(t){const e=n=>t().update(ci(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function nl(t=32){if(Ar&&typeof Ar.getRandomValues=="function")return Ar.getRandomValues(new Uint8Array(t));if(Ar&&typeof Ar.randomBytes=="function")return Uint8Array.from(Ar.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const W1=BigInt(0),ln=BigInt(1),Y1=BigInt(2),Z1=BigInt(7),X1=BigInt(256),J1=BigInt(113),il=[],sl=[],ol=[];for(let t=0,e=ln,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],il.push(2*(5*n+r)),sl.push((t+1)*(t+2)/2%64);let i=W1;for(let s=0;s<7;s++)e=(e<<ln^(e>>Z1)*J1)%X1,e&Y1&&(i^=ln<<(ln<<BigInt(s))-ln);ol.push(i)}const al=F1(ol,!0),Q1=al[0],em=al[1],cl=(t,e,r)=>r>32?M1(t,e,r):j1(t,e,r),ul=(t,e,r)=>r>32?z1(t,e,r):k1(t,e,r);function tm(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=cl(u,l,1)^r[a],f=ul(u,l,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=h,t[o+d+1]^=f}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=sl[o],c=cl(i,s,a),u=ul(i,s,a),l=il[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=Q1[n],t[1]^=em[n]}Br(r)}class ks extends js{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,un(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=V1(this.state)}clone(){return this._cloneInto()}keccak(){Ju(this.state32),tm(this.state32,this.rounds),Ju(this.state32),this.posOut=0,this.pos=0}update(e){Tr(this),e=ci(e),Et(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Tr(this,!1),Et(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return un(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Xu(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Br(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new ks(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const rm=(t,e,r)=>rl(()=>new ks(e,t,r)),nm=rm(1,136,256/8);class im extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}function sm(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function om(t,e,r){return t&e^~t&r}function am(t,e,r){return t&e^t&r^e&r}class cm extends js{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Fs(this.buffer)}update(e){Tr(this),e=ci(e),Et(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Fs(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Tr(this),Xu(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,Br(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;sm(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Fs(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const Lt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),um=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ut=new Uint32Array(64);class lm extends cm{constructor(e=32){super(64,e,8,!1),this.A=Lt[0]|0,this.B=Lt[1]|0,this.C=Lt[2]|0,this.D=Lt[3]|0,this.E=Lt[4]|0,this.F=Lt[5]|0,this.G=Lt[6]|0,this.H=Lt[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)Ut[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=Ut[h-15],d=Ut[h-2],g=dt(f,7)^dt(f,18)^f>>>3,y=dt(d,17)^dt(d,19)^d>>>10;Ut[h]=y+Ut[h-7]+g+Ut[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const f=dt(a,6)^dt(a,11)^dt(a,25),d=l+f+om(a,c,u)+um[h]+Ut[h]|0,y=(dt(n,2)^dt(n,13)^dt(n,22))+am(n,i,s)|0;l=u,u=c,c=a,a=o+d|0,o=s,s=i,i=n,n=d+y|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){Br(Ut)}destroy(){this.set(0,0,0,0,0,0,0,0),Br(this.buffer)}}const fm=rl(()=>new lm),Ms=BigInt(0),zs=BigInt(1);function ui(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function ar(t,e,r=""){const n=oi(t),i=t?.length,s=e!==void 0;if(!n||s&&i!==e){const o=r&&`"${r}" `,a=s?` of length ${e}`:"",c=n?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function li(t){const e=t.toString(16);return e.length&1?"0"+e:e}function ll(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Ms:BigInt("0x"+t)}function fi(t){return ll(Rr(t))}function fl(t){return Et(t),ll(Rr(Uint8Array.from(t).reverse()))}function Vs(t,e){return ai(t.toString(16).padStart(e*2,"0"))}function hl(t,e){return Vs(t,e).reverse()}function Ce(t,e,r){let n;if(typeof e=="string")try{n=ai(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(oi(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}const Ks=t=>typeof t=="bigint"&&Ms<=t;function hm(t,e,r){return Ks(t)&&Ks(e)&&Ks(r)&&e<=t&&t<r}function dm(t,e,r,n){if(!hm(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function dl(t){let e;for(e=0;t>Ms;t>>=zs,e+=1);return e}const fn=t=>(zs<<BigInt(t))-zs;function gm(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=d=>new Uint8Array(d),i=d=>Uint8Array.of(d);let s=n(t),o=n(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...d)=>r(o,s,...d),l=(d=n(0))=>{o=u(i(0),d),s=u(),d.length!==0&&(o=u(i(1),d),s=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const g=[];for(;d<e;){s=u();const y=s.slice();g.push(y),d+=s.length}return Pt(...g)};return(d,g)=>{c(),l(d);let y;for(;!(y=g(h()));)l();return c(),y}}function Hs(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(r).forEach(([i,s])=>n(i,s,!0))}function gl(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const pm="0.1.1";function ym(){return pm}class De extends Error{constructor(e,r={}){const n=(()=>{if(r.cause instanceof De){if(r.cause.details)return r.cause.details;if(r.cause.shortMessage)return r.cause.shortMessage}return r.cause&&"details"in r.cause&&typeof r.cause.details=="string"?r.cause.details:r.cause?.message?r.cause.message:r.details})(),i=r.cause instanceof De&&r.cause.docsPath||r.docsPath,o=`https://oxlib.sh${i??""}`,a=[e||"An error occurred.",...r.metaMessages?["",...r.metaMessages]:[],...n||i?["",n?`Details: ${n}`:void 0,i?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,r.cause?{cause:r.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${ym()}`}),this.cause=r.cause,this.details=n,this.docs=o,this.docsPath=i,this.shortMessage=e}walk(e){return pl(this,e)}}function pl(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?pl(t.cause,e):e?null:t}function bm(t,e){if(wl(t)>e)throw new Im({givenSize:wl(t),maxSize:e})}const _t={zero:48,nine:57,A:65,F:70,a:97,f:102};function yl(t){if(t>=_t.zero&&t<=_t.nine)return t-_t.zero;if(t>=_t.A&&t<=_t.F)return t-(_t.A-10);if(t>=_t.a&&t<=_t.f)return t-(_t.a-10)}function wm(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;if(t.length>n)throw new Sm({size:t.length,targetSize:n,type:"Bytes"});const i=new Uint8Array(n);for(let s=0;s<n;s++){const o=r==="right";i[o?s:n-s-1]=t[o?s:t.length-s-1]}return i}function qs(t,e){if(Ws(t)>e)throw new Nm({givenSize:Ws(t),maxSize:e})}function bl(t,e={}){const{dir:r,size:n=32}=e;if(n===0)return t;const i=t.replace("0x","");if(i.length>n*2)throw new $m({size:Math.ceil(i.length/2),targetSize:n,type:"Hex"});return`0x${i[r==="right"?"padEnd":"padStart"](n*2,"0")}`}const mm=new TextEncoder;function Em(t){return t instanceof Uint8Array?t:typeof t=="string"?_m(t):vm(t)}function vm(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function _m(t,e={}){const{size:r}=e;let n=t;r&&(qs(t,r),n=Gs(t,r));let i=n.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const u=yl(i.charCodeAt(c++)),l=yl(i.charCodeAt(c++));if(u===void 0||l===void 0)throw new De(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=u*16+l}return o}function xm(t,e={}){const{size:r}=e,n=mm.encode(t);return typeof r=="number"?(bm(n,r),Dm(n,r)):n}function Dm(t,e){return wm(t,{dir:"right",size:e})}function wl(t){return t.length}class Im extends De{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class Sm extends De{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}const Om=new TextEncoder,Am=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ml(...t){return`0x${t.reduce((e,r)=>e+r.replace("0x",""),"")}`}function Tm(t,e={}){const r=`0x${Number(t)}`;return typeof e.size=="number"?(qs(r,e.size),hi(r,e.size)):r}function El(t,e={}){let r="";for(let i=0;i<t.length;i++)r+=Am[t[i]];const n=`0x${r}`;return typeof e.size=="number"?(qs(n,e.size),Gs(n,e.size)):n}function Bm(t,e={}){const{signed:r,size:n}=e,i=BigInt(t);let s;n?r?s=(1n<<BigInt(n)*8n-1n)-1n:s=2n**(BigInt(n)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&r?-s-1n:0;if(s&&i>s||i<o){const u=typeof t=="bigint"?"n":"";throw new Cm({max:s?`${s}${u}`:void 0,min:`${o}${u}`,signed:r,size:n,value:`${t}${u}`})}const c=`0x${(r&&i<0?(1n<<BigInt(n*8))+BigInt(i):i).toString(16)}`;return n?hi(c,n):c}function Rm(t,e={}){return El(Om.encode(t),e)}function hi(t,e){return bl(t,{dir:"left",size:e})}function Gs(t,e){return bl(t,{dir:"right",size:e})}function Ws(t){return Math.ceil((t.length-2)/2)}class Cm extends De{constructor({max:e,min:r,signed:n,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${n?" signed":" unsigned"} integer range ${e?`(\`${r}\` to \`${e}\`)`:`(above \`${r}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class Nm extends De{constructor({givenSize:e,maxSize:r}){super(`Size cannot exceed \`${r}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}}class $m extends De{constructor({size:e,targetSize:r,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}}new im(128),L1(0,{size:32});function Pm(t,e={}){const{as:r=typeof t=="string"?"Hex":"Bytes"}=e,n=nm(Em(t));return r==="Bytes"?n:El(n)}class Lm extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const r=super.get(e);return super.has(e)&&r!==void 0&&(this.delete(e),super.set(e,r)),r}set(e,r){if(super.set(e,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const Ys={checksum:new Lm(8192)}.checksum,Um=/^0x[a-fA-F0-9]{40}$/;function vl(t,e={}){const{strict:r=!0}=e;if(!Um.test(t))throw new _l({address:t,cause:new jm});if(r){if(t.toLowerCase()===t)return;if(Fm(t)!==t)throw new _l({address:t,cause:new km})}}function Fm(t){if(Ys.has(t))return Ys.get(t);vl(t,{strict:!1});const e=t.substring(2).toLowerCase(),r=Pm(xm(e),{as:"Bytes"}),n=e.split("");for(let s=0;s<40;s+=2)r[s>>1]>>4>=8&&n[s]&&(n[s]=n[s].toUpperCase()),(r[s>>1]&15)>=8&&n[s+1]&&(n[s+1]=n[s+1].toUpperCase());const i=`0x${n.join("")}`;return Ys.set(t,i),i}class _l extends De{constructor({address:e,cause:r}){super(`Address "${e}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class jm extends De{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class km extends De{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}const Mm=/^(.*)\[([0-9]*)\]$/,zm=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,Vm=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function Zs(t,e){if(t.length!==e.length)throw new Hm({expectedLength:t.length,givenLength:e.length});const r=[];for(let n=0;n<t.length;n++){const i=t[n],s=e[n];r.push(Zs.encode(i,s))}return ml(...r)}(function(t){function e(r,n,i=!1){if(r==="address"){const c=n;return vl(c),hi(c.toLowerCase(),i?32:0)}if(r==="string")return Rm(n);if(r==="bytes")return n;if(r==="bool")return hi(Tm(n),i?32:1);const s=r.match(Vm);if(s){const[c,u,l="256"]=s,h=Number.parseInt(l,10)/8;return Bm(n,{size:i?32:h,signed:u==="int"})}const o=r.match(zm);if(o){const[c,u]=o;if(Number.parseInt(u,10)!==(n.length-2)/2)throw new Km({expectedSize:Number.parseInt(u,10),value:n});return Gs(n,i?32:0)}const a=r.match(Mm);if(a&&Array.isArray(n)){const[c,u]=a,l=[];for(let h=0;h<n.length;h++)l.push(e(u,n[h],!0));return l.length===0?"0x":ml(...l)}throw new qm(r)}t.encode=e})(Zs||(Zs={}));class Km extends De{constructor({expectedSize:e,value:r}){super(`Size of bytes "${r}" (bytes${Ws(r)}) does not match expected size (bytes${e}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}}class Hm extends De{constructor({expectedLength:e,givenLength:r}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${e}`,`Given length (values): ${r}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class qm extends De{constructor(e){super(`Type \`${e}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}class xl extends js{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Zu(e);const n=ci(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Br(s)}update(e){return Tr(this),this.iHash.update(e),this}digestInto(e){Tr(this),Et(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Dl=(t,e,r)=>new xl(t,e).update(r).digest();Dl.create=(t,e)=>new xl(t,e);const Ne=BigInt(0),Ie=BigInt(1),cr=BigInt(2),Il=BigInt(3),Sl=BigInt(4),Ol=BigInt(5),Gm=BigInt(7),Al=BigInt(8),Wm=BigInt(9),Tl=BigInt(16);function rt(t,e){const r=t%e;return r>=Ne?r:e+r}function Ze(t,e,r){let n=t;for(;e-- >Ne;)n*=n,n%=r;return n}function Bl(t,e){if(t===Ne)throw new Error("invert: expected non-zero number");if(e<=Ne)throw new Error("invert: expected positive modulus, got "+e);let r=rt(t,e),n=e,i=Ne,s=Ie;for(;r!==Ne;){const a=n/r,c=n%r,u=i-s*a;n=r,r=c,i=s,s=u}if(n!==Ie)throw new Error("invert: does not exist");return rt(i,e)}function Xs(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function Rl(t,e){const r=(t.ORDER+Ie)/Sl,n=t.pow(e,r);return Xs(t,n,e),n}function Ym(t,e){const r=(t.ORDER-Ol)/Al,n=t.mul(e,cr),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,cr),i),a=t.mul(s,t.sub(o,t.ONE));return Xs(t,a,e),a}function Zm(t){const e=hn(t),r=Cl(t),n=r(e,e.neg(e.ONE)),i=r(e,n),s=r(e,e.neg(n)),o=(t+Gm)/Tl;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,n);const h=a.mul(u,i),f=a.mul(u,s),d=a.eql(a.sqr(l),c),g=a.eql(a.sqr(h),c);u=a.cmov(u,l,d),l=a.cmov(f,h,g);const y=a.eql(a.sqr(l),c),E=a.cmov(u,l,y);return Xs(a,E,c),E}}function Cl(t){if(t<Il)throw new Error("sqrt is not defined for small field");let e=t-Ie,r=0;for(;e%cr===Ne;)e/=cr,r++;let n=cr;const i=hn(t);for(;$l(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Rl;let s=i.pow(n,e);const o=(e+Ie)/cr;return function(c,u){if(c.is0(u))return u;if($l(c,u)!==1)throw new Error("Cannot find square root");let l=r,h=c.mul(c.ONE,s),f=c.pow(u,e),d=c.pow(u,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let g=1,y=c.sqr(f);for(;!c.eql(y,c.ONE);)if(g++,y=c.sqr(y),g===l)throw new Error("Cannot find square root");const E=Ie<<BigInt(l-g-1),T=c.pow(h,E);l=g,h=c.sqr(T),f=c.mul(f,h),d=c.mul(d,T)}return d}}function Xm(t){return t%Sl===Il?Rl:t%Al===Ol?Ym:t%Tl===Wm?Zm(t):Cl(t)}const Jm=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Qm(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=Jm.reduce((n,i)=>(n[i]="function",n),e);return Hs(t,r),t}function eE(t,e,r){if(r<Ne)throw new Error("invalid exponent, negatives unsupported");if(r===Ne)return t.ONE;if(r===Ie)return e;let n=t.ONE,i=e;for(;r>Ne;)r&Ie&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Ie;return n}function Nl(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function $l(t,e){const r=(t.ORDER-Ie)/cr,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Pl(t,e){e!==void 0&&un(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function hn(t,e,r=!1,n={}){if(t<=Ne)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(i=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);const{nBitLength:c,nByteLength:u}=Pl(t,i);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:u,MASK:fn(c),ZERO:Ne,ONE:Ie,allowedLengths:a,create:f=>rt(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Ne<=f&&f<t},is0:f=>f===Ne,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&Ie)===Ie,neg:f=>rt(-f,t),eql:(f,d)=>f===d,sqr:f=>rt(f*f,t),add:(f,d)=>rt(f+d,t),sub:(f,d)=>rt(f-d,t),mul:(f,d)=>rt(f*d,t),pow:(f,d)=>eE(h,f,d),div:(f,d)=>rt(f*Bl(d,t),t),sqrN:f=>f*f,addN:(f,d)=>f+d,subN:(f,d)=>f-d,mulN:(f,d)=>f*d,inv:f=>Bl(f,t),sqrt:s||(f=>(l||(l=Xm(t)),l(h,f))),toBytes:f=>r?hl(f,u):Vs(f,u),fromBytes:(f,d=!0)=>{if(a){if(!a.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const y=new Uint8Array(u);y.set(f,r?0:y.length-f.length),f=y}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let g=r?fl(f):fi(f);if(o&&(g=rt(g,t)),!d&&!h.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:f=>Nl(h,f),cmov:(f,d,g)=>g?d:f});return Object.freeze(h)}function Ll(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Ul(t){const e=Ll(t);return e+Math.ceil(e/2)}function tE(t,e,r=!1){const n=t.length,i=Ll(e),s=Ul(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?fl(t):fi(t),a=rt(o,e-Ie)+Ie;return r?hl(a,i):Vs(a,i)}const Cr=BigInt(0),ur=BigInt(1);function di(t,e){const r=e.negate();return t?r:e}function Js(t,e){const r=Nl(t.Fp,e.map(n=>n.Z));return e.map((n,i)=>t.fromAffine(n.toAffine(r[i])))}function Fl(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Qs(t,e){Fl(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=fn(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function jl(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=ur);const u=e*n,l=u+Math.abs(a)-1,h=a===0,f=a<0,d=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:d,offsetF:u}}function rE(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function nE(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const eo=new WeakMap,kl=new WeakMap;function to(t){return kl.get(t)||1}function Ml(t){if(t!==Cr)throw new Error("invalid wNAF")}class iE{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let i=e;for(;r>Cr;)r&ur&&(n=n.add(i)),i=i.double(),r>>=ur;return n}precomputeWindow(e,r){const{windows:n,windowSize:i}=Qs(r,this.bits),s=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,s.push(a);for(let u=1;u<i;u++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=Qs(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:f,offsetF:d}=jl(n,a,o);n=c,l?s=s.add(di(f,r[d])):i=i.add(di(h,r[u]))}return Ml(n),{p:i,f:s}}wNAFUnsafe(e,r,n,i=this.ZERO){const s=Qs(e,this.bits);for(let o=0;o<s.windows&&n!==Cr;o++){const{nextN:a,offset:c,isZero:u,isNeg:l}=jl(n,o,s);if(n=a,!u){const h=r[c];i=i.add(l?h.negate():h)}}return Ml(n),i}getPrecomputes(e,r,n){let i=eo.get(r);return i||(i=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(i=n(i)),eo.set(r,i))),i}cached(e,r,n){const i=to(e);return this.wNAF(i,this.getPrecomputes(i,e,n),r)}unsafe(e,r,n,i){const s=to(e);return s===1?this._unsafeLadder(e,r,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,i)}createCache(e,r){Fl(r,this.bits),kl.set(e,r),eo.delete(e)}hasCache(e){return to(e)!==1}}function sE(t,e,r,n){let i=e,s=t.ZERO,o=t.ZERO;for(;r>Cr||n>Cr;)r&ur&&(s=s.add(i)),n&ur&&(o=o.add(i)),i=i.double(),r>>=ur,n>>=ur;return{p1:s,p2:o}}function oE(t,e,r,n){rE(r,t),nE(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=dl(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=fn(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let d=h;d>=0;d-=c){l.fill(o);for(let y=0;y<s;y++){const E=n[y],T=Number(E>>BigInt(d)&u);l[T]=l[T].add(r[y])}let g=o;for(let y=l.length-1,E=o;y>0;y--)E=E.add(l[y]),g=g.add(E);if(f=f.add(g),d!==0)for(let y=0;y<c;y++)f=f.double()}return f}function zl(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Qm(e),e}else return hn(t,{isLE:r})}function aE(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const c of["p","n","h"]){const u=e[c];if(!(typeof u=="bigint"&&u>Cr))throw new Error(`CURVE.${c} must be positive bigint`)}const i=zl(e.p,r.Fp,n),s=zl(e.n,r.Fn,n),a=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(const c of a)if(!i.isValid(e[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}const Vl=(t,e)=>(t+(t>=0?e:-e)/Kl)/e;function cE(t,e,r){const[[n,i],[s,o]]=e,a=Vl(o*t,r),c=Vl(-i*t,r);let u=t-a*n-c*s,l=-a*i-c*o;const h=u<Dt,f=l<Dt;h&&(u=-u),f&&(l=-l);const d=fn(Math.ceil(dl(r)/2))+Nr;if(u<Dt||u>=d||l<Dt||l>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}function ro(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function no(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return ui(r.lowS,"lowS"),ui(r.prehash,"prehash"),r.format!==void 0&&ro(r.format),r}class uE extends Error{constructor(e=""){super(e)}}const xt={Err:uE,_tlv:{encode:(t,e)=>{const{Err:r}=xt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=li(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?li(i.length/2|128):"";return li(t)+s+i+e},decode(t,e){const{Err:r}=xt;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=xt;if(t<Dt)throw new e("integer: negative integers are not allowed");let r=li(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=xt;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return fi(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=xt,i=Ce("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=xt,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},Dt=BigInt(0),Nr=BigInt(1),Kl=BigInt(2),gi=BigInt(3),lE=BigInt(4);function $r(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let i=Ce("private key",e);try{n=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function fE(t,e={}){const r=aE("weierstrass",t,e),{Fp:n,Fn:i}=r;let s=r.CURVE;const{h:o,n:a}=s;Hs(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=ql(n,i);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(B,m,w){const{x:p,y:b}=m.toAffine(),v=n.toBytes(p);if(ui(w,"isCompressed"),w){l();const D=!n.isOdd(b);return Pt(Hl(D),v)}else return Pt(Uint8Array.of(4),v,n.toBytes(b))}function f(B){ar(B,void 0,"Point");const{publicKey:m,publicKeyUncompressed:w}=u,p=B.length,b=B[0],v=B.subarray(1);if(p===m&&(b===2||b===3)){const D=n.fromBytes(v);if(!n.isValid(D))throw new Error("bad point: is not on curve, wrong x");const _=y(D);let I;try{I=n.sqrt(_)}catch(U){const L=U instanceof Error?": "+U.message:"";throw new Error("bad point: is not on curve, sqrt error"+L)}l();const S=n.isOdd(I);return(b&1)===1!==S&&(I=n.neg(I)),{x:D,y:I}}else if(p===w&&b===4){const D=n.BYTES,_=n.fromBytes(v.subarray(0,D)),I=n.fromBytes(v.subarray(D,D*2));if(!E(_,I))throw new Error("bad point: is not on curve");return{x:_,y:I}}else throw new Error(`bad point: got length ${p}, expected compressed=${m} or uncompressed=${w}`)}const d=e.toBytes||h,g=e.fromBytes||f;function y(B){const m=n.sqr(B),w=n.mul(m,B);return n.add(n.add(w,n.mul(B,s.a)),s.b)}function E(B,m){const w=n.sqr(m),p=y(B);return n.eql(w,p)}if(!E(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const T=n.mul(n.pow(s.a,gi),lE),C=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(T,C)))throw new Error("bad curve params: a or b");function x(B,m,w=!1){if(!n.isValid(m)||w&&n.is0(m))throw new Error(`bad point coordinate ${B}`);return m}function R(B){if(!(B instanceof O))throw new Error("ProjectivePoint expected")}function F(B){if(!c||!c.basises)throw new Error("no endo");return cE(B,c.basises,i.ORDER)}const j=gl((B,m)=>{const{X:w,Y:p,Z:b}=B;if(n.eql(b,n.ONE))return{x:w,y:p};const v=B.is0();m==null&&(m=v?n.ONE:n.inv(b));const D=n.mul(w,m),_=n.mul(p,m),I=n.mul(b,m);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(I,n.ONE))throw new Error("invZ was invalid");return{x:D,y:_}}),M=gl(B=>{if(B.is0()){if(e.allowInfinityPoint&&!n.is0(B.Y))return;throw new Error("bad point: ZERO")}const{x:m,y:w}=B.toAffine();if(!n.isValid(m)||!n.isValid(w))throw new Error("bad point: x or y not field elements");if(!E(m,w))throw new Error("bad point: equation left != right");if(!B.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function P(B,m,w,p,b){return w=new O(n.mul(w.X,B),w.Y,w.Z),m=di(p,m),w=di(b,w),m.add(w)}class O{constructor(m,w,p){this.X=x("x",m),this.Y=x("y",w,!0),this.Z=x("z",p),Object.freeze(this)}static CURVE(){return s}static fromAffine(m){const{x:w,y:p}=m||{};if(!m||!n.isValid(w)||!n.isValid(p))throw new Error("invalid affine point");if(m instanceof O)throw new Error("projective point not allowed");return n.is0(w)&&n.is0(p)?O.ZERO:new O(w,p,n.ONE)}static fromBytes(m){const w=O.fromAffine(g(ar(m,void 0,"point")));return w.assertValidity(),w}static fromHex(m){return O.fromBytes(Ce("pointHex",m))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,w=!0){return q.createCache(this,m),w||this.multiply(gi),this}assertValidity(){M(this)}hasEvenY(){const{y:m}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(m)}equals(m){R(m);const{X:w,Y:p,Z:b}=this,{X:v,Y:D,Z:_}=m,I=n.eql(n.mul(w,_),n.mul(v,b)),S=n.eql(n.mul(p,_),n.mul(D,b));return I&&S}negate(){return new O(this.X,n.neg(this.Y),this.Z)}double(){const{a:m,b:w}=s,p=n.mul(w,gi),{X:b,Y:v,Z:D}=this;let _=n.ZERO,I=n.ZERO,S=n.ZERO,A=n.mul(b,b),U=n.mul(v,v),L=n.mul(D,D),N=n.mul(b,v);return N=n.add(N,N),S=n.mul(b,D),S=n.add(S,S),_=n.mul(m,S),I=n.mul(p,L),I=n.add(_,I),_=n.sub(U,I),I=n.add(U,I),I=n.mul(_,I),_=n.mul(N,_),S=n.mul(p,S),L=n.mul(m,L),N=n.sub(A,L),N=n.mul(m,N),N=n.add(N,S),S=n.add(A,A),A=n.add(S,A),A=n.add(A,L),A=n.mul(A,N),I=n.add(I,A),L=n.mul(v,D),L=n.add(L,L),A=n.mul(L,N),_=n.sub(_,A),S=n.mul(L,U),S=n.add(S,S),S=n.add(S,S),new O(_,I,S)}add(m){R(m);const{X:w,Y:p,Z:b}=this,{X:v,Y:D,Z:_}=m;let I=n.ZERO,S=n.ZERO,A=n.ZERO;const U=s.a,L=n.mul(s.b,gi);let N=n.mul(w,v),z=n.mul(p,D),K=n.mul(b,_),W=n.add(w,p),V=n.add(v,D);W=n.mul(W,V),V=n.add(N,z),W=n.sub(W,V),V=n.add(w,b);let Y=n.add(v,_);return V=n.mul(V,Y),Y=n.add(N,K),V=n.sub(V,Y),Y=n.add(p,b),I=n.add(D,_),Y=n.mul(Y,I),I=n.add(z,K),Y=n.sub(Y,I),A=n.mul(U,V),I=n.mul(L,K),A=n.add(I,A),I=n.sub(z,A),A=n.add(z,A),S=n.mul(I,A),z=n.add(N,N),z=n.add(z,N),K=n.mul(U,K),V=n.mul(L,V),z=n.add(z,K),K=n.sub(N,K),K=n.mul(U,K),V=n.add(V,K),N=n.mul(z,V),S=n.add(S,N),N=n.mul(Y,V),I=n.mul(W,I),I=n.sub(I,N),N=n.mul(W,z),A=n.mul(Y,A),A=n.add(A,N),new O(I,S,A)}subtract(m){return this.add(m.negate())}is0(){return this.equals(O.ZERO)}multiply(m){const{endo:w}=e;if(!i.isValidNot0(m))throw new Error("invalid scalar: out of range");let p,b;const v=D=>q.cached(this,D,_=>Js(O,_));if(w){const{k1neg:D,k1:_,k2neg:I,k2:S}=F(m),{p:A,f:U}=v(_),{p:L,f:N}=v(S);b=U.add(N),p=P(w.beta,A,L,D,I)}else{const{p:D,f:_}=v(m);p=D,b=_}return Js(O,[p,b])[0]}multiplyUnsafe(m){const{endo:w}=e,p=this;if(!i.isValid(m))throw new Error("invalid scalar: out of range");if(m===Dt||p.is0())return O.ZERO;if(m===Nr)return p;if(q.hasCache(this))return this.multiply(m);if(w){const{k1neg:b,k1:v,k2neg:D,k2:_}=F(m),{p1:I,p2:S}=sE(O,p,v,_);return P(w.beta,I,S,b,D)}else return q.unsafe(p,m)}multiplyAndAddUnsafe(m,w,p){const b=this.multiplyUnsafe(w).add(m.multiplyUnsafe(p));return b.is0()?void 0:b}toAffine(m){return j(this,m)}isTorsionFree(){const{isTorsionFree:m}=e;return o===Nr?!0:m?m(O,this):q.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:m}=e;return o===Nr?this:m?m(O,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(m=!0){return ui(m,"isCompressed"),this.assertValidity(),d(O,this,m)}toHex(m=!0){return Rr(this.toBytes(m))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(m=!0){return this.toBytes(m)}_setWindowSize(m){this.precompute(m)}static normalizeZ(m){return Js(O,m)}static msm(m,w){return oE(O,i,m,w)}static fromPrivateKey(m){return O.BASE.multiply($r(i,m))}}O.BASE=new O(s.Gx,s.Gy,n.ONE),O.ZERO=new O(n.ZERO,n.ONE,n.ZERO),O.Fp=n,O.Fn=i;const H=i.BITS,q=new iE(O,e.endo?Math.ceil(H/2):H);return O.BASE.precompute(8),O}function Hl(t){return Uint8Array.of(t?2:3)}function ql(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function hE(t,e={}){const{Fn:r}=t,n=e.randomBytes||nl,i=Object.assign(ql(t.Fp,r),{seed:Ul(r.ORDER)});function s(d){try{return!!$r(r,d)}catch{return!1}}function o(d,g){const{publicKey:y,publicKeyUncompressed:E}=i;try{const T=d.length;return g===!0&&T!==y||g===!1&&T!==E?!1:!!t.fromBytes(d)}catch{return!1}}function a(d=n(i.seed)){return tE(ar(d,i.seed,"seed"),r.ORDER)}function c(d,g=!0){return t.BASE.multiply($r(r,d)).toBytes(g)}function u(d){const g=a(d);return{secretKey:g,publicKey:c(g)}}function l(d){if(typeof d=="bigint")return!1;if(d instanceof t)return!0;const{secretKey:g,publicKey:y,publicKeyUncompressed:E}=i;if(r.allowedLengths||g===y)return;const T=Ce("key",d).length;return T===y||T===E}function h(d,g,y=!0){if(l(d)===!0)throw new Error("first arg must be private key");if(l(g)===!1)throw new Error("second arg must be public key");const E=$r(r,d);return t.fromHex(g).multiply(E).toBytes(y)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:u,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:d=>$r(r,d),precompute(d=8,g=t.BASE){return g.precompute(d,!1)}},lengths:i})}function dE(t,e,r={}){Zu(e),Hs(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||nl,i=r.hmac||((w,...p)=>Dl(e,w,Pt(...p))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:h,utils:f,lengths:d}=hE(t,r),g={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},y="compact";function E(w){const p=a>>Nr;return w>p}function T(w,p){if(!o.isValidNot0(p))throw new Error(`invalid signature ${w}: out of range 1..Point.Fn.ORDER`);return p}function C(w,p){ro(p);const b=d.signature,v=p==="compact"?b:p==="recovered"?b+1:void 0;return ar(w,v,`${p} signature`)}class x{constructor(p,b,v){this.r=T("r",p),this.s=T("s",b),v!=null&&(this.recovery=v),Object.freeze(this)}static fromBytes(p,b=y){C(p,b);let v;if(b==="der"){const{r:S,s:A}=xt.toSig(ar(p));return new x(S,A)}b==="recovered"&&(v=p[0],b="compact",p=p.subarray(1));const D=o.BYTES,_=p.subarray(0,D),I=p.subarray(D,D*2);return new x(o.fromBytes(_),o.fromBytes(I),v)}static fromHex(p,b){return this.fromBytes(ai(p),b)}addRecoveryBit(p){return new x(this.r,this.s,p)}recoverPublicKey(p){const b=s.ORDER,{r:v,s:D,recovery:_}=this;if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");if(a*Kl<b&&_>1)throw new Error("recovery id is ambiguous for h>1 curve");const S=_===2||_===3?v+a:v;if(!s.isValid(S))throw new Error("recovery id 2 or 3 invalid");const A=s.toBytes(S),U=t.fromBytes(Pt(Hl((_&1)===0),A)),L=o.inv(S),N=F(Ce("msgHash",p)),z=o.create(-N*L),K=o.create(D*L),W=t.BASE.multiplyUnsafe(z).add(U.multiplyUnsafe(K));if(W.is0())throw new Error("point at infinify");return W.assertValidity(),W}hasHighS(){return E(this.s)}toBytes(p=y){if(ro(p),p==="der")return ai(xt.hexFromSig(this));const b=o.toBytes(this.r),v=o.toBytes(this.s);if(p==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Pt(Uint8Array.of(this.recovery),b,v)}return Pt(b,v)}toHex(p){return Rr(this.toBytes(p))}assertValidity(){}static fromCompact(p){return x.fromBytes(Ce("sig",p),"compact")}static fromDER(p){return x.fromBytes(Ce("sig",p),"der")}normalizeS(){return this.hasHighS()?new x(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Rr(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Rr(this.toBytes("compact"))}}const R=r.bits2int||function(p){if(p.length>8192)throw new Error("input is too large");const b=fi(p),v=p.length*8-c;return v>0?b>>BigInt(v):b},F=r.bits2int_modN||function(p){return o.create(R(p))},j=fn(c);function M(w){return dm("num < 2^"+c,w,Dt,j),o.toBytes(w)}function P(w,p){return ar(w,void 0,"message"),p?ar(e(w),void 0,"prehashed message"):w}function O(w,p,b){if(["recovered","canonical"].some(z=>z in b))throw new Error("sign() legacy options not supported");const{lowS:v,prehash:D,extraEntropy:_}=no(b,g);w=P(w,D);const I=F(w),S=$r(o,p),A=[M(S),M(I)];if(_!=null&&_!==!1){const z=_===!0?n(d.secretKey):_;A.push(Ce("extraEntropy",z))}const U=Pt(...A),L=I;function N(z){const K=R(z);if(!o.isValidNot0(K))return;const W=o.inv(K),V=t.BASE.multiply(K).toAffine(),Y=o.create(V.x);if(Y===Dt)return;const ce=o.create(W*o.create(L+Y*S));if(ce===Dt)return;let qe=(V.x===Y?0:2)|Number(V.y&Nr),ct=ce;return v&&E(ce)&&(ct=o.neg(ce),qe^=1),new x(Y,ct,qe)}return{seed:U,k2sig:N}}function H(w,p,b={}){w=Ce("message",w);const{seed:v,k2sig:D}=O(w,p,b);return gm(e.outputLen,o.BYTES,i)(v,D)}function q(w){let p;const b=typeof w=="string"||oi(w),v=!b&&w!==null&&typeof w=="object"&&typeof w.r=="bigint"&&typeof w.s=="bigint";if(!b&&!v)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(v)p=new x(w.r,w.s);else if(b){try{p=x.fromBytes(Ce("sig",w),"der")}catch(D){if(!(D instanceof xt.Err))throw D}if(!p)try{p=x.fromBytes(Ce("sig",w),"compact")}catch{return!1}}return p||!1}function B(w,p,b,v={}){const{lowS:D,prehash:_,format:I}=no(v,g);if(b=Ce("publicKey",b),p=P(Ce("message",p),_),"strict"in v)throw new Error("options.strict was renamed to lowS");const S=I===void 0?q(w):x.fromBytes(Ce("sig",w),I);if(S===!1)return!1;try{const A=t.fromBytes(b);if(D&&S.hasHighS())return!1;const{r:U,s:L}=S,N=F(p),z=o.inv(L),K=o.create(N*z),W=o.create(U*z),V=t.BASE.multiplyUnsafe(K).add(A.multiplyUnsafe(W));return V.is0()?!1:o.create(V.x)===U}catch{return!1}}function m(w,p,b={}){const{prehash:v}=no(b,g);return p=P(p,v),x.fromBytes(w,"recovered").recoverPublicKey(p).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:h,utils:f,lengths:d,Point:t,sign:H,verify:B,recoverPublicKey:m,Signature:x,hash:e})}function gE(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=hn(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function pE(t){const{CURVE:e,curveOpts:r}=gE(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function yE(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,Pl(r.Fn.ORDER,r.Fn.BITS))})}function bE(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:i}=pE(t),s=fE(e,r),o=dE(s,n,i);return yE(t,o)}function wE(t,e){const r=n=>bE({...t,hash:n});return{...r(e),create:r}}tl("HashToScalar-");const io={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},mE={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},Gl=BigInt(2);function EE(t){const e=io.p,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=t*t*t%e,l=u*u*t%e,h=Ze(l,r,e)*l%e,f=Ze(h,r,e)*l%e,d=Ze(f,Gl,e)*u%e,g=Ze(d,i,e)*d%e,y=Ze(g,s,e)*g%e,E=Ze(y,a,e)*y%e,T=Ze(E,c,e)*E%e,C=Ze(T,a,e)*y%e,x=Ze(C,r,e)*l%e,R=Ze(x,o,e)*g%e,F=Ze(R,n,e)*u%e,j=Ze(F,Gl,e);if(!so.eql(so.sqr(j),t))throw new Error("Cannot find square root");return j}const so=hn(io.p,{sqrt:EE});wE({...io,Fp:so,lowS:!0,endo:mE},fm);function vE(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<t.length;u++){const l=t.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}const r=t.length,n=t.charAt(0),i=Math.log(r)/Math.log(256),s=Math.log(256)/Math.log(r);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,f=0;const d=u.length;for(;f!==d&&u[f]===0;)f++,l++;const g=(d-f)*s+1>>>0,y=new Uint8Array(g);for(;f!==d;){let C=u[f],x=0;for(let R=g-1;(C!==0||x<h)&&R!==-1;R--,x++)C+=256*y[R]>>>0,y[R]=C%r>>>0,C=C/r>>>0;if(C!==0)throw new Error("Non-zero carry");h=x,f++}let E=g-h;for(;E!==g&&y[E]===0;)E++;let T=n.repeat(l);for(;E<g;++E)T+=t.charAt(y[E]);return T}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,f=0;for(;u[l]===n;)h++,l++;const d=(u.length-l)*i+1>>>0,g=new Uint8Array(d);for(;l<u.length;){const C=u.charCodeAt(l);if(C>255)return;let x=e[C];if(x===255)return;let R=0;for(let F=d-1;(x!==0||R<f)&&F!==-1;F--,R++)x+=r*g[F]>>>0,g[F]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");f=R,l++}let y=d-f;for(;y!==d&&g[y]===0;)y++;const E=new Uint8Array(h+(d-y));let T=h;for(;y!==d;)E[T++]=g[y++];return E}function c(u){const l=a(u);if(l)return l;throw new Error("Non-base"+r+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var _E="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";vE(_E);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function pi(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function oo(t,...e){if(!pi(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Wl(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(r=>typeof r=="string"):e.every(r=>Number.isSafeInteger(r)):!1}function Yl(t){if(typeof t!="function")throw new Error("function expected");return!0}function Ft(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function dn(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function yi(t){if(!Array.isArray(t))throw new Error("array expected")}function bi(t,e){if(!Wl(!0,e))throw new Error(`${t}: array of strings expected`)}function ao(t,e){if(!Wl(!1,e))throw new Error(`${t}: array of numbers expected`)}function Me(...t){const e=s=>s,r=(s,o)=>a=>s(o(a)),n=t.map(s=>s.encode).reduceRight(r,e),i=t.map(s=>s.decode).reduce(r,e);return{encode:n,decode:i}}function ze(t){const e=typeof t=="string"?t.split(""):t,r=e.length;bi("alphabet",e);const n=new Map(e.map((i,s)=>[i,s]));return{encode:i=>(yi(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=r)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:i=>(yi(i),i.map(s=>{Ft("alphabet.decode",s);const o=n.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function Ve(t=""){return Ft("join",t),{encode:e=>(bi("join.decode",e),e.join(t)),decode:e=>(Ft("join.decode",e),e.split(t))}}function wi(t,e="="){return dn(t),Ft("padding",e),{encode(r){for(bi("padding.encode",r);r.length*t%8;)r.push(e);return r},decode(r){bi("padding.decode",r);let n=r.length;if(n*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&r[n-1]===e;n--)if((n-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return r.slice(0,n)}}}function Zl(t){return Yl(t),{encode:e=>e,decode:e=>t(e)}}function Xl(t,e,r){if(e<2)throw new Error(`convertRadix: invalid from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: invalid to=${r}, base cannot be less than 2`);if(yi(t),!t.length)return[];let n=0;const i=[],s=Array.from(t,a=>{if(dn(a),a<0||a>=e)throw new Error(`invalid integer: ${a}`);return a}),o=s.length;for(;;){let a=0,c=!0;for(let u=n;u<o;u++){const l=s[u],h=e*a,f=h+l;if(!Number.isSafeInteger(f)||h/e!==a||f-l!==h)throw new Error("convertRadix: carry overflow");const d=f/r;a=f%r;const g=Math.floor(d);if(s[u]=g,!Number.isSafeInteger(g)||g*r+a!==f)throw new Error("convertRadix: carry overflow");if(c)g?c=!1:n=u;else continue}if(i.push(a),c)break}for(let a=0;a<t.length-1&&t[a]===0;a++)i.push(0);return i.reverse()}const Jl=(t,e)=>e===0?t:Jl(e,t%e),mi=(t,e)=>t+(e-Jl(t,e)),Ei=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function co(t,e,r,n){if(yi(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(mi(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${mi(e,r)}`);let i=0,s=0;const o=Ei[e],a=Ei[r]-1,c=[];for(const u of t){if(dn(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(i=i<<e|u,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=r;s-=r)c.push((i>>s-r&a)>>>0);const l=Ei[s];if(l===void 0)throw new Error("invalid carry");i&=l-1}if(i=i<<r-s&a,!n&&s>=e)throw new Error("Excess padding");if(!n&&i>0)throw new Error(`Non-zero padding: ${i}`);return n&&s>0&&c.push(i>>>0),c}function xE(t){dn(t);const e=2**8;return{encode:r=>{if(!pi(r))throw new Error("radix.encode input should be Uint8Array");return Xl(Array.from(r),e,t)},decode:r=>(ao("radix.decode",r),Uint8Array.from(Xl(r,t,e)))}}function Xe(t,e=!1){if(dn(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(mi(8,t)>32||mi(t,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!pi(r))throw new Error("radix2.encode input should be Uint8Array");return co(Array.from(r),8,t,!e)},decode:r=>(ao("radix2.decode",r),Uint8Array.from(co(r,t,8,e)))}}function Ql(t){return Yl(t),function(...e){try{return t.apply(null,e)}catch{}}}const ef=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function",tf=(t,e)=>{Ft("base64",t);const r=e?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,n=e?"base64url":"base64";if(t.length>0&&!r.test(t))throw new Error("invalid base64");return Uint8Array.fromBase64(t,{alphabet:n,lastChunkHandling:"strict"})},uo=t=>Me(xE(58),ze(t),Ve("")),lo=Me(ze("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Ve("")),rf=[996825010,642813549,513874426,1027748829,705979059];function gn(t){const e=t>>25;let r=(t&33554431)<<5;for(let n=0;n<rf.length;n++)(e>>n&1)===1&&(r^=rf[n]);return r}function nf(t,e,r=1){const n=t.length;let i=1;for(let s=0;s<n;s++){const o=t.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${t})`);i=gn(i)^o>>5}i=gn(i);for(let s=0;s<n;s++)i=gn(i)^t.charCodeAt(s)&31;for(let s of e)i=gn(i)^s;for(let s=0;s<6;s++)i=gn(i);return i^=r,lo.encode(co([i%Ei[30]],30,5,!1))}function sf(t){const e=t==="bech32"?1:734539939,r=Xe(5),n=r.decode,i=r.encode,s=Ql(n);function o(h,f,d=90){Ft("bech32.encode prefix",h),pi(f)&&(f=Array.from(f)),ao("bech32.encode",f);const g=h.length;if(g===0)throw new TypeError(`Invalid prefix length ${g}`);const y=g+7+f.length;if(d!==!1&&y>d)throw new TypeError(`Length ${y} exceeds limit ${d}`);const E=h.toLowerCase(),T=nf(E,f,e);return`${E}1${lo.encode(f)}${T}`}function a(h,f=90){Ft("bech32.decode input",h);const d=h.length;if(d<8||f!==!1&&d>f)throw new TypeError(`invalid string length: ${d} (${h}). Expected (8..${f})`);const g=h.toLowerCase();if(h!==g&&h!==h.toUpperCase())throw new Error("String must be lowercase or uppercase");const y=g.lastIndexOf("1");if(y===0||y===-1)throw new Error('Letter "1" must be present between prefix and data only');const E=g.slice(0,y),T=g.slice(y+1);if(T.length<6)throw new Error("Data must be at least 6 characters long");const C=lo.decode(T).slice(0,-6),x=nf(E,C,e);if(!T.endsWith(x))throw new Error(`Invalid checksum in ${h}: expected "${x}"`);return{prefix:E,words:C}}const c=Ql(a);function u(h){const{prefix:f,words:d}=a(h,!1);return{prefix:f,words:d,bytes:n(d)}}function l(h,f){return o(h,i(f))}return{encode:o,decode:a,encodeFromBytes:l,decodeToBytes:u,decodeUnsafe:c,fromWords:n,fromWordsUnsafe:s,toWords:i}}const DE=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",IE={encode(t){return oo(t),t.toHex()},decode(t){return Ft("hex",t),Uint8Array.fromHex(t)}};function pn(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const r=Pu(e);let n=0;for(const i of t)r.set(i,n),n+=i.length;return Ns(r)}function $e(t,e="utf8"){const r=Fu[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}const SE={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var OE=Object.defineProperty,AE=Object.defineProperties,TE=Object.getOwnPropertyDescriptors,of=Object.getOwnPropertySymbols,BE=Object.prototype.hasOwnProperty,RE=Object.prototype.propertyIsEnumerable,af=(t,e,r)=>e in t?OE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pr=(t,e)=>{for(var r in e||(e={}))BE.call(e,r)&&af(t,r,e[r]);if(of)for(var r of of(e))RE.call(e,r)&&af(t,r,e[r]);return t},yn=(t,e)=>AE(t,TE(e));const CE="ReactNative",nt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},NE="js";function vi(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function lr(){return!Or()&&!!Ps()&&navigator.product===CE}function $E(){return lr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function PE(){return lr()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function bn(){return!vi()&&!!Ps()&&!!Or()}function _i(){return lr()?nt.reactNative:vi()?nt.node:bn()?nt.browser:nt.unknown}function cf(){var t;try{return lr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function LE(t,e){const r=new URLSearchParams(t);return Object.entries(e).sort(([n],[i])=>n.localeCompare(i)).forEach(([n,i])=>{i!=null&&r.set(n,String(i))}),r.toString()}function UE(){return Ku()||{name:"",description:"",url:"",icons:[""]}}function FE(){if(_i()===nt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:n}=global.Platform;return[r,n].join("-")}const t=y1();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function jE(){var t;const e=_i();return e===nt.browser?[e,((t=Vu())==null?void 0:t.host)||"unknown"].join(":"):e}function uf(t,e,r){const n=FE(),i=jE();return[[t,e].join("-"),[NE,r].join("-"),n,i].join("/")}function kE({protocol:t,version:e,relayUrl:r,sdkVersion:n,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const u=r.split("?"),l=uf(t,e,n),h={auth:i,ua:l,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},f=LE(u[1]||"",h);return u[0]+"?"+f}function fo(t){return Object.fromEntries(t.entries())}function ho(t){return new Map(Object.entries(t))}function ME(t=G.FIVE_MINUTES,e){const r=G.toMiliseconds(t||G.FIVE_MINUTES);let n,i,s,o;return{resolve:a=>{s&&n&&(clearTimeout(s),n(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const u=new Error(e);o=Promise.reject(u),c(u)},r),n=a,i=c})}}function gt(t,e,r){return new Promise(async(n,i)=>{const s=setTimeout(()=>i(new Error(r)),e);try{const o=await t;n(o)}catch(o){i(o)}clearTimeout(s)})}function lf(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function zE(t){return lf("topic",t)}function VE(t){return lf("id",t)}function KE(t){const[e,r]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")n.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))n.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return n}function wn(t,e){return G.fromMiliseconds((e||Date.now())+G.toMiliseconds(t))}function ff(t){return Date.now()>=G.toMiliseconds(t)}function go(t,e){return`${t}${e?`:${e}`:""}`}function hf(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function df(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function gf(t){return Buffer.from(t,"base64").toString("utf-8")}function HE(t){return new Promise(e=>setTimeout(e,t))}const xi=BigInt(2**32-1),pf=BigInt(32);function yf(t,e=!1){return e?{h:Number(t&xi),l:Number(t>>pf&xi)}:{h:Number(t>>pf&xi)|0,l:Number(t&xi)|0}}function bf(t,e=!1){const r=t.length;let n=new Uint32Array(r),i=new Uint32Array(r);for(let s=0;s<r;s++){const{h:o,l:a}=yf(t[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const wf=(t,e,r)=>t>>>r,mf=(t,e,r)=>t<<32-r|e>>>r,jt=(t,e,r)=>t>>>r|e<<32-r,kt=(t,e,r)=>t<<32-r|e>>>r,mn=(t,e,r)=>t<<64-r|e>>>r-32,En=(t,e,r)=>t>>>r-32|e<<64-r,qE=(t,e)=>e,GE=(t,e)=>t,WE=(t,e,r)=>t<<r|e>>>32-r,YE=(t,e,r)=>e<<r|t>>>32-r,ZE=(t,e,r)=>e<<r-32|t>>>64-r,XE=(t,e,r)=>t<<r-32|e>>>64-r;function it(t,e,r,n){const i=(e>>>0)+(n>>>0);return{h:t+r+(i/2**32|0)|0,l:i|0}}const po=(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),yo=(t,e,r,n)=>e+r+n+(t/2**32|0)|0,JE=(t,e,r,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0),QE=(t,e,r,n,i)=>e+r+n+i+(t/2**32|0)|0,ev=(t,e,r,n,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(n>>>0)+(i>>>0),tv=(t,e,r,n,i,s)=>e+r+n+i+s+(t/2**32|0)|0,Lr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Di(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function It(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function st(t,...e){if(!Di(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Ii(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");It(t.outputLen),It(t.blockLen)}function Mt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function bo(t,e){st(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function vn(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Je(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function wo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function pt(t,e){return t<<32-e|t>>>e}const Ef=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function vf(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const St=Ef?t=>t:t=>vf(t);function rv(t){for(let e=0;e<t.length;e++)t[e]=vf(t[e]);return t}const zt=Ef?t=>t:rv,_f=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",nv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ur(t){if(st(t),_f)return t.toHex();let e="";for(let r=0;r<t.length;r++)e+=nv[t[r]];return e}const Ot={_0:48,_9:57,A:65,F:70,a:97,f:102};function xf(t){if(t>=Ot._0&&t<=Ot._9)return t-Ot._0;if(t>=Ot.A&&t<=Ot.F)return t-(Ot.A-10);if(t>=Ot.a&&t<=Ot.f)return t-(Ot.a-10)}function Si(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(_f)return Uint8Array.fromHex(t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let i=0,s=0;i<r;i++,s+=2){const o=xf(t.charCodeAt(s)),a=xf(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function Df(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ot(t){return typeof t=="string"&&(t=Df(t)),st(t),t}function Vt(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];st(i),e+=i.length}const r=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const s=t[n];r.set(s,i),i+=s.length}return r}class Oi{}function _n(t){const e=n=>t().update(ot(n)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function iv(t){const e=(n,i)=>t(i).update(ot(n)).digest(),r=t({});return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}function fr(t=32){if(Lr&&typeof Lr.getRandomValues=="function")return Lr.getRandomValues(new Uint8Array(t));if(Lr&&typeof Lr.randomBytes=="function")return Uint8Array.from(Lr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const sv=BigInt(0),xn=BigInt(1),ov=BigInt(2),av=BigInt(7),cv=BigInt(256),uv=BigInt(113),If=[],Sf=[],Of=[];for(let t=0,e=xn,r=1,n=0;t<24;t++){[r,n]=[n,(2*r+3*n)%5],If.push(2*(5*n+r)),Sf.push((t+1)*(t+2)/2%64);let i=sv;for(let s=0;s<7;s++)e=(e<<xn^(e>>av)*uv)%cv,e&ov&&(i^=xn<<(xn<<BigInt(s))-xn);Of.push(i)}const Af=bf(Of,!0),lv=Af[0],fv=Af[1],Tf=(t,e,r)=>r>32?ZE(t,e,r):WE(t,e,r),Bf=(t,e,r)=>r>32?XE(t,e,r):YE(t,e,r);function hv(t,e=24){const r=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)r[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=r[c],l=r[c+1],h=Tf(u,l,1)^r[a],f=Bf(u,l,1)^r[a+1];for(let d=0;d<50;d+=10)t[o+d]^=h,t[o+d+1]^=f}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=Sf[o],c=Tf(i,s,a),u=Bf(i,s,a),l=If[o];i=t[l],s=t[l+1],t[l]=c,t[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)r[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~r[(a+2)%10]&r[(a+4)%10]}t[0]^=lv[n],t[1]^=fv[n]}Je(r)}class mo extends Oi{constructor(e,r,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=r,this.outputLen=n,this.enableXOF=i,this.rounds=s,It(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=vn(this.state)}clone(){return this._cloneInto()}keccak(){zt(this.state32),hv(this.state32,this.rounds),zt(this.state32),this.posOut=0,this.pos=0}update(e){Mt(this),e=ot(e),st(e);const{blockLen:r,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===r&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:r,pos:n,blockLen:i}=this;e[n]^=r,(r&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Mt(this,!1),st(e),this.finish();const r=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(r.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return It(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(bo(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Je(this.state)}_cloneInto(e){const{blockLen:r,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new mo(r,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}((t,e,r)=>_n(()=>new mo(e,t,r)))(1,136,256/8);function dv(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function gv(t,e,r){return t&e^~t&r}function pv(t,e,r){return t&e^t&r^e&r}class Rf extends Oi{constructor(e,r,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=r,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=wo(this.buffer)}update(e){Mt(this),e=ot(e),st(e);const{view:r,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=wo(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Mt(this),bo(e,this),this.finished=!0;const{buffer:r,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;r[o++]=128,Je(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)r[h]=0;dv(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=wo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:r,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%r&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const Kt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),me=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Ee=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),yv=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ht=new Uint32Array(64);class bv extends Rf{constructor(e=32){super(64,e,8,!1),this.A=Kt[0]|0,this.B=Kt[1]|0,this.C=Kt[2]|0,this.D=Kt[3]|0,this.E=Kt[4]|0,this.F=Kt[5]|0,this.G=Kt[6]|0,this.H=Kt[7]|0}get(){const{A:e,B:r,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,r,n,i,s,o,a,c]}set(e,r,n,i,s,o,a,c){this.A=e|0,this.B=r|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,r){for(let h=0;h<16;h++,r+=4)Ht[h]=e.getUint32(r,!1);for(let h=16;h<64;h++){const f=Ht[h-15],d=Ht[h-2],g=pt(f,7)^pt(f,18)^f>>>3,y=pt(d,17)^pt(d,19)^d>>>10;Ht[h]=y+Ht[h-7]+g+Ht[h-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){const f=pt(a,6)^pt(a,11)^pt(a,25),d=l+f+gv(a,c,u)+yv[h]+Ht[h]|0,g=(pt(n,2)^pt(n,13)^pt(n,22))+pv(n,i,s)|0;l=u,u=c,c=a,a=o+d|0,o=s,s=i,i=n,n=d+g|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){Je(Ht)}destroy(){this.set(0,0,0,0,0,0,0,0),Je(this.buffer)}}const Cf=bf(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),wv=Cf[0],mv=Cf[1],qt=new Uint32Array(80),Gt=new Uint32Array(80);class Eo extends Rf{constructor(e=64){super(128,e,16,!1),this.Ah=Ee[0]|0,this.Al=Ee[1]|0,this.Bh=Ee[2]|0,this.Bl=Ee[3]|0,this.Ch=Ee[4]|0,this.Cl=Ee[5]|0,this.Dh=Ee[6]|0,this.Dl=Ee[7]|0,this.Eh=Ee[8]|0,this.El=Ee[9]|0,this.Fh=Ee[10]|0,this.Fl=Ee[11]|0,this.Gh=Ee[12]|0,this.Gl=Ee[13]|0,this.Hh=Ee[14]|0,this.Hl=Ee[15]|0}get(){const{Ah:e,Al:r,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:f,Gh:d,Gl:g,Hh:y,Hl:E}=this;return[e,r,n,i,s,o,a,c,u,l,h,f,d,g,y,E]}set(e,r,n,i,s,o,a,c,u,l,h,f,d,g,y,E){this.Ah=e|0,this.Al=r|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=g|0,this.Hh=y|0,this.Hl=E|0}process(e,r){for(let x=0;x<16;x++,r+=4)qt[x]=e.getUint32(r),Gt[x]=e.getUint32(r+=4);for(let x=16;x<80;x++){const R=qt[x-15]|0,F=Gt[x-15]|0,j=jt(R,F,1)^jt(R,F,8)^wf(R,F,7),M=kt(R,F,1)^kt(R,F,8)^mf(R,F,7),P=qt[x-2]|0,O=Gt[x-2]|0,H=jt(P,O,19)^mn(P,O,61)^wf(P,O,6),q=kt(P,O,19)^En(P,O,61)^mf(P,O,6),B=JE(M,q,Gt[x-7],Gt[x-16]),m=QE(B,j,H,qt[x-7],qt[x-16]);qt[x]=m|0,Gt[x]=B|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:f,Fh:d,Fl:g,Gh:y,Gl:E,Hh:T,Hl:C}=this;for(let x=0;x<80;x++){const R=jt(h,f,14)^jt(h,f,18)^mn(h,f,41),F=kt(h,f,14)^kt(h,f,18)^En(h,f,41),j=h&d^~h&y,M=f&g^~f&E,P=ev(C,F,M,mv[x],Gt[x]),O=tv(P,T,R,j,wv[x],qt[x]),H=P|0,q=jt(n,i,28)^mn(n,i,34)^mn(n,i,39),B=kt(n,i,28)^En(n,i,34)^En(n,i,39),m=n&s^n&a^s&a,w=i&o^i&c^o&c;T=y|0,C=E|0,y=d|0,E=g|0,d=h|0,g=f|0,{h,l:f}=it(u|0,l|0,O|0,H|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const p=po(H,B,w);n=yo(p,O,q,m),i=p|0}({h:n,l:i}=it(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=it(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=it(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=it(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:f}=it(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:g}=it(this.Fh|0,this.Fl|0,d|0,g|0),{h:y,l:E}=it(this.Gh|0,this.Gl|0,y|0,E|0),{h:T,l:C}=it(this.Hh|0,this.Hl|0,T|0,C|0),this.set(n,i,s,o,a,c,u,l,h,f,d,g,y,E,T,C)}roundClean(){Je(qt,Gt)}destroy(){Je(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Ev extends Eo{constructor(){super(48),this.Ah=me[0]|0,this.Al=me[1]|0,this.Bh=me[2]|0,this.Bl=me[3]|0,this.Ch=me[4]|0,this.Cl=me[5]|0,this.Dh=me[6]|0,this.Dl=me[7]|0,this.Eh=me[8]|0,this.El=me[9]|0,this.Fh=me[10]|0,this.Fl=me[11]|0,this.Gh=me[12]|0,this.Gl=me[13]|0,this.Hh=me[14]|0,this.Hl=me[15]|0}}const ve=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class vv extends Eo{constructor(){super(32),this.Ah=ve[0]|0,this.Al=ve[1]|0,this.Bh=ve[2]|0,this.Bl=ve[3]|0,this.Ch=ve[4]|0,this.Cl=ve[5]|0,this.Dh=ve[6]|0,this.Dl=ve[7]|0,this.Eh=ve[8]|0,this.El=ve[9]|0,this.Fh=ve[10]|0,this.Fl=ve[11]|0,this.Gh=ve[12]|0,this.Gl=ve[13]|0,this.Hh=ve[14]|0,this.Hl=ve[15]|0}}const Nf=_n(()=>new bv),_v=_n(()=>new Eo),xv=_n(()=>new Ev);_n(()=>new vv);const Dv=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),le=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),k=new Uint32Array(32);function Wt(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=k[2*t],u=k[2*t+1],l=k[2*e],h=k[2*e+1],f=k[2*r],d=k[2*r+1],g=k[2*n],y=k[2*n+1],E=po(c,l,o);u=yo(E,u,h,a),c=E|0,{Dh:y,Dl:g}={Dh:y^u,Dl:g^c},{Dh:y,Dl:g}={Dh:qE(y,g),Dl:GE(y)},{h:d,l:f}=it(d,f,y,g),{Bh:h,Bl:l}={Bh:h^d,Bl:l^f},{Bh:h,Bl:l}={Bh:jt(h,l,24),Bl:kt(h,l,24)},k[2*t]=c,k[2*t+1]=u,k[2*e]=l,k[2*e+1]=h,k[2*r]=f,k[2*r+1]=d,k[2*n]=g,k[2*n+1]=y}function Yt(t,e,r,n,i,s){const o=i[s],a=i[s+1];let c=k[2*t],u=k[2*t+1],l=k[2*e],h=k[2*e+1],f=k[2*r],d=k[2*r+1],g=k[2*n],y=k[2*n+1],E=po(c,l,o);u=yo(E,u,h,a),c=E|0,{Dh:y,Dl:g}={Dh:y^u,Dl:g^c},{Dh:y,Dl:g}={Dh:jt(y,g,16),Dl:kt(y,g,16)},{h:d,l:f}=it(d,f,y,g),{Bh:h,Bl:l}={Bh:h^d,Bl:l^f},{Bh:h,Bl:l}={Bh:mn(h,l,63),Bl:En(h,l,63)},k[2*t]=c,k[2*t+1]=u,k[2*e]=l,k[2*e+1]=h,k[2*r]=f,k[2*r+1]=d,k[2*n]=g,k[2*n+1]=y}function Iv(t,e={},r,n,i){if(It(r),t<0||t>r)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>r))throw new Error("key length must be undefined or 1.."+r);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class Sv extends Oi{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,It(e),It(r),this.blockLen=e,this.outputLen=r,this.buffer=new Uint8Array(e),this.buffer32=vn(this.buffer)}update(e){Mt(this),e=ot(e),st(e);const{blockLen:r,buffer:n,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===r&&(zt(i),this.compress(i,0,!1),zt(i),this.pos=0);const u=Math.min(r-this.pos,s-c),l=o+c;if(u===r&&!(l%4)&&c+u<s){const h=new Uint32Array(a,l,Math.floor((s-c)/4));zt(h);for(let f=0;c+r<s;f+=i.length,c+=r)this.length+=r,this.compress(h,f,!1);zt(h);continue}n.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){Mt(this),bo(e,this);const{pos:r,buffer32:n}=this;this.finished=!0,Je(this.buffer.subarray(r)),zt(n),this.compress(n,0,!0),zt(n);const i=vn(e);this.get().forEach((s,o)=>i[o]=St(s))}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}_cloneInto(e){const{buffer:r,length:n,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(r),e.destroyed=s,e.finished=i,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class Ov extends Sv{constructor(e={}){const r=e.dkLen===void 0?64:e.dkLen;super(128,r),this.v0l=le[0]|0,this.v0h=le[1]|0,this.v1l=le[2]|0,this.v1h=le[3]|0,this.v2l=le[4]|0,this.v2h=le[5]|0,this.v3l=le[6]|0,this.v3h=le[7]|0,this.v4l=le[8]|0,this.v4h=le[9]|0,this.v5l=le[10]|0,this.v5h=le[11]|0,this.v6l=le[12]|0,this.v6h=le[13]|0,this.v7l=le[14]|0,this.v7h=le[15]|0,Iv(r,e,64,16,16);let{key:n,personalization:i,salt:s}=e,o=0;if(n!==void 0&&(n=ot(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=ot(s);const a=vn(s);this.v4l^=St(a[0]),this.v4h^=St(a[1]),this.v5l^=St(a[2]),this.v5h^=St(a[3])}if(i!==void 0){i=ot(i);const a=vn(i);this.v6l^=St(a[0]),this.v6h^=St(a[1]),this.v7l^=St(a[2]),this.v7h^=St(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:r,v1l:n,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:h,v5h:f,v6l:d,v6h:g,v7l:y,v7h:E}=this;return[e,r,n,i,s,o,a,c,u,l,h,f,d,g,y,E]}set(e,r,n,i,s,o,a,c,u,l,h,f,d,g,y,E){this.v0l=e|0,this.v0h=r|0,this.v1l=n|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=h|0,this.v5h=f|0,this.v6l=d|0,this.v6h=g|0,this.v7l=y|0,this.v7h=E|0}compress(e,r,n){this.get().forEach((c,u)=>k[u]=c),k.set(le,16);let{h:i,l:s}=yf(BigInt(this.length));k[24]=le[8]^s,k[25]=le[9]^i,n&&(k[28]=~k[28],k[29]=~k[29]);let o=0;const a=Dv;for(let c=0;c<12;c++)Wt(0,4,8,12,e,r+2*a[o++]),Yt(0,4,8,12,e,r+2*a[o++]),Wt(1,5,9,13,e,r+2*a[o++]),Yt(1,5,9,13,e,r+2*a[o++]),Wt(2,6,10,14,e,r+2*a[o++]),Yt(2,6,10,14,e,r+2*a[o++]),Wt(3,7,11,15,e,r+2*a[o++]),Yt(3,7,11,15,e,r+2*a[o++]),Wt(0,5,10,15,e,r+2*a[o++]),Yt(0,5,10,15,e,r+2*a[o++]),Wt(1,6,11,12,e,r+2*a[o++]),Yt(1,6,11,12,e,r+2*a[o++]),Wt(2,7,8,13,e,r+2*a[o++]),Yt(2,7,8,13,e,r+2*a[o++]),Wt(3,4,9,14,e,r+2*a[o++]),Yt(3,4,9,14,e,r+2*a[o++]);this.v0l^=k[0]^k[16],this.v0h^=k[1]^k[17],this.v1l^=k[2]^k[18],this.v1h^=k[3]^k[19],this.v2l^=k[4]^k[20],this.v2h^=k[5]^k[21],this.v3l^=k[6]^k[22],this.v3h^=k[7]^k[23],this.v4l^=k[8]^k[24],this.v4h^=k[9]^k[25],this.v5l^=k[10]^k[26],this.v5h^=k[11]^k[27],this.v6l^=k[12]^k[28],this.v6h^=k[13]^k[29],this.v7l^=k[14]^k[30],this.v7h^=k[15]^k[31],Je(k)}destroy(){this.destroyed=!0,Je(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}iv(t=>new Ov(t));/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function $f(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function vo(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function _o(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Pe(t,...e){if(!$f(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Pf(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Av(t,e){Pe(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Zt(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Fr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Tv(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const Bv=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Rv(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function xo(t){if(typeof t=="string")t=Rv(t);else if($f(t))t=Do(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function Cv(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Nv(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return r===0}const $v=(t,e)=>{function r(n,...i){if(Pe(n),!Bv)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");t.varSizeNonce?Pe(u):Pe(u,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&Pe(i[1]);const o=e(n,...i),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");Pe(l)}};let c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Pe(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(Pe(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(r,t),r};function Lf(t,e,r=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(r&&!Lv(e))throw new Error("invalid output, must be aligned");return e}function Uf(t,e,r,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),c=n?4:0,u=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+u,a,n)}function Pv(t,e,r){vo(r);const n=new Uint8Array(16),i=Tv(n);return Uf(i,0,BigInt(e),r),Uf(i,8,BigInt(t),r),n}function Lv(t){return t.byteOffset%4===0}function Do(t){return Uint8Array.from(t)}const Ff=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),Uv=Ff("expand 16-byte k"),Fv=Ff("expand 32-byte k"),jv=Zt(Uv),kv=Zt(Fv);function J(t,e){return t<<e|t>>>32-e}function Io(t){return t.byteOffset%4===0}const Ai=64,Mv=16,jf=2**32-1,kf=new Uint32Array;function zv(t,e,r,n,i,s,o,a){const c=i.length,u=new Uint8Array(Ai),l=Zt(u),h=Io(i)&&Io(s),f=h?Zt(i):kf,d=h?Zt(s):kf;for(let g=0;g<c;o++){if(t(e,r,n,l,o,a),o>=jf)throw new Error("arx: counter overflow");const y=Math.min(Ai,c-g);if(h&&y===Ai){const E=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let T=0,C;T<Mv;T++)C=E+T,d[C]=f[C]^l[T];g+=Ai;continue}for(let E=0,T;E<y;E++)T=g+E,s[T]=i[T]^u[E];g+=y}}function Vv(t,e){const{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=Cv({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return _o(i),_o(o),vo(s),vo(r),(a,c,u,l,h=0)=>{Pe(a),Pe(c),Pe(u);const f=u.length;if(l===void 0&&(l=new Uint8Array(f)),Pe(l),_o(h),h<0||h>=jf)throw new Error("arx: counter overflow");if(l.length<f)throw new Error(`arx: output (${l.length}) is shorter than data (${f})`);const d=[];let g=a.length,y,E;if(g===32)d.push(y=Do(a)),E=kv;else if(g===16&&r)y=new Uint8Array(32),y.set(a),y.set(a,16),E=jv,d.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Io(c)||d.push(c=Do(c));const T=Zt(y);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(E,T,Zt(c.subarray(0,16)),T),c=c.subarray(16)}const C=16-i;if(C!==c.length)throw new Error(`arx: nonce must be ${C} or 16 bytes`);if(C!==12){const R=new Uint8Array(12);R.set(c,s?0:12-c.length),c=R,d.push(c)}const x=Zt(c);return zv(t,E,T,x,u,l,h,o),Fr(...d),l}}const ye=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class Kv{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=xo(e),Pe(e,32);const r=ye(e,0),n=ye(e,2),i=ye(e,4),s=ye(e,6),o=ye(e,8),a=ye(e,10),c=ye(e,12),u=ye(e,14);this.r[0]=r&8191,this.r[1]=(r>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=ye(e,16+2*l)}process(e,r,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],f=o[5],d=o[6],g=o[7],y=o[8],E=o[9],T=ye(e,r+0),C=ye(e,r+2),x=ye(e,r+4),R=ye(e,r+6),F=ye(e,r+8),j=ye(e,r+10),M=ye(e,r+12),P=ye(e,r+14);let O=s[0]+(T&8191),H=s[1]+((T>>>13|C<<3)&8191),q=s[2]+((C>>>10|x<<6)&8191),B=s[3]+((x>>>7|R<<9)&8191),m=s[4]+((R>>>4|F<<12)&8191),w=s[5]+(F>>>1&8191),p=s[6]+((F>>>14|j<<2)&8191),b=s[7]+((j>>>11|M<<5)&8191),v=s[8]+((M>>>8|P<<8)&8191),D=s[9]+(P>>>5|i),_=0,I=_+O*a+H*(5*E)+q*(5*y)+B*(5*g)+m*(5*d);_=I>>>13,I&=8191,I+=w*(5*f)+p*(5*h)+b*(5*l)+v*(5*u)+D*(5*c),_+=I>>>13,I&=8191;let S=_+O*c+H*a+q*(5*E)+B*(5*y)+m*(5*g);_=S>>>13,S&=8191,S+=w*(5*d)+p*(5*f)+b*(5*h)+v*(5*l)+D*(5*u),_+=S>>>13,S&=8191;let A=_+O*u+H*c+q*a+B*(5*E)+m*(5*y);_=A>>>13,A&=8191,A+=w*(5*g)+p*(5*d)+b*(5*f)+v*(5*h)+D*(5*l),_+=A>>>13,A&=8191;let U=_+O*l+H*u+q*c+B*a+m*(5*E);_=U>>>13,U&=8191,U+=w*(5*y)+p*(5*g)+b*(5*d)+v*(5*f)+D*(5*h),_+=U>>>13,U&=8191;let L=_+O*h+H*l+q*u+B*c+m*a;_=L>>>13,L&=8191,L+=w*(5*E)+p*(5*y)+b*(5*g)+v*(5*d)+D*(5*f),_+=L>>>13,L&=8191;let N=_+O*f+H*h+q*l+B*u+m*c;_=N>>>13,N&=8191,N+=w*a+p*(5*E)+b*(5*y)+v*(5*g)+D*(5*d),_+=N>>>13,N&=8191;let z=_+O*d+H*f+q*h+B*l+m*u;_=z>>>13,z&=8191,z+=w*c+p*a+b*(5*E)+v*(5*y)+D*(5*g),_+=z>>>13,z&=8191;let K=_+O*g+H*d+q*f+B*h+m*l;_=K>>>13,K&=8191,K+=w*u+p*c+b*a+v*(5*E)+D*(5*y),_+=K>>>13,K&=8191;let W=_+O*y+H*g+q*d+B*f+m*h;_=W>>>13,W&=8191,W+=w*l+p*u+b*c+v*a+D*(5*E),_+=W>>>13,W&=8191;let V=_+O*E+H*y+q*g+B*d+m*f;_=V>>>13,V&=8191,V+=w*h+p*l+b*u+v*c+D*a,_+=V>>>13,V&=8191,_=(_<<2)+_|0,_=_+I|0,I=_&8191,_=_>>>13,S+=_,s[0]=I,s[1]=S,s[2]=A,s[3]=U,s[4]=L,s[5]=N,s[6]=z,s[7]=K,s[8]=W,s[9]=V}finalize(){const{h:e,pad:r}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+r[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+r[a]|0)+(o>>>16)|0,e[a]=o&65535;Fr(n)}update(e){Pf(this),e=xo(e),Pe(e);const{buffer:r,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}r.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(r,0,!1),this.pos=0)}return this}destroy(){Fr(this.h,this.r,this.buffer,this.pad)}digestInto(e){Pf(this),Av(e,this),this.finished=!0;const{buffer:r,h:n}=this;let{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:r}=this;this.digestInto(e);const n=e.slice(0,r);return this.destroy(),n}}function Hv(t){const e=(n,i)=>t(i).update(xo(n)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=n=>t(n),e}const qv=Hv(t=>new Kv(t));function Gv(t,e,r,n,i,s=20){let o=t[0],a=t[1],c=t[2],u=t[3],l=e[0],h=e[1],f=e[2],d=e[3],g=e[4],y=e[5],E=e[6],T=e[7],C=i,x=r[0],R=r[1],F=r[2],j=o,M=a,P=c,O=u,H=l,q=h,B=f,m=d,w=g,p=y,b=E,v=T,D=C,_=x,I=R,S=F;for(let U=0;U<s;U+=2)j=j+H|0,D=J(D^j,16),w=w+D|0,H=J(H^w,12),j=j+H|0,D=J(D^j,8),w=w+D|0,H=J(H^w,7),M=M+q|0,_=J(_^M,16),p=p+_|0,q=J(q^p,12),M=M+q|0,_=J(_^M,8),p=p+_|0,q=J(q^p,7),P=P+B|0,I=J(I^P,16),b=b+I|0,B=J(B^b,12),P=P+B|0,I=J(I^P,8),b=b+I|0,B=J(B^b,7),O=O+m|0,S=J(S^O,16),v=v+S|0,m=J(m^v,12),O=O+m|0,S=J(S^O,8),v=v+S|0,m=J(m^v,7),j=j+q|0,S=J(S^j,16),b=b+S|0,q=J(q^b,12),j=j+q|0,S=J(S^j,8),b=b+S|0,q=J(q^b,7),M=M+B|0,D=J(D^M,16),v=v+D|0,B=J(B^v,12),M=M+B|0,D=J(D^M,8),v=v+D|0,B=J(B^v,7),P=P+m|0,_=J(_^P,16),w=w+_|0,m=J(m^w,12),P=P+m|0,_=J(_^P,8),w=w+_|0,m=J(m^w,7),O=O+H|0,I=J(I^O,16),p=p+I|0,H=J(H^p,12),O=O+H|0,I=J(I^O,8),p=p+I|0,H=J(H^p,7);let A=0;n[A++]=o+j|0,n[A++]=a+M|0,n[A++]=c+P|0,n[A++]=u+O|0,n[A++]=l+H|0,n[A++]=h+q|0,n[A++]=f+B|0,n[A++]=d+m|0,n[A++]=g+w|0,n[A++]=y+p|0,n[A++]=E+b|0,n[A++]=T+v|0,n[A++]=C+D|0,n[A++]=x+_|0,n[A++]=R+I|0,n[A++]=F+S|0}const Wv=Vv(Gv,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Yv=new Uint8Array(16),Mf=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(Yv.subarray(r))},Zv=new Uint8Array(32);function zf(t,e,r,n,i){const s=t(e,r,Zv),o=qv.create(s);i&&Mf(o,i),Mf(o,n);const a=Pv(n.length,i?i.length:0,!0);o.update(a);const c=o.digest();return Fr(s,a),c}const Xv=t=>(e,r,n)=>({encrypt(i,s){const o=i.length;s=Lf(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,r,a,a,1);const c=zf(t,e,r,a,n);return s.set(c,o),Fr(c),s},decrypt(i,s){s=Lf(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=zf(t,e,r,o,n);if(!Nv(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,r,s,s,1),Fr(c),s}}),Vf=$v({blockSize:64,nonceLength:12,tagLength:16},Xv(Wv));class Kf extends Oi{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Ii(e);const n=ot(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Je(s)}update(e){return Mt(this),this.iHash.update(e),this}digestInto(e){Mt(this),st(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=r._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Ti=(t,e,r)=>new Kf(t,e).update(r).digest();Ti.create=(t,e)=>new Kf(t,e);function Jv(t,e,r){return Ii(t),r===void 0&&(r=new Uint8Array(t.outputLen)),Ti(t,ot(r),ot(e))}const So=Uint8Array.from([0]),Hf=Uint8Array.of();function Qv(t,e,r,n=32){Ii(t),It(n);const i=t.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);r===void 0&&(r=Hf);const o=new Uint8Array(s*i),a=Ti.create(t,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)So[0]=l+1,c.update(l===0?Hf:u).update(r).update(So).digestInto(u),o.set(u,i*l),a._cloneInto(c);return a.destroy(),c.destroy(),Je(u,So),o.slice(0,n)}const e2=(t,e,r,n,i)=>Qv(t,Jv(t,e,r),n,i),Bi=Nf,Oo=BigInt(0),Ao=BigInt(1);function Ri(t,e=""){if(typeof t!="boolean"){const r=e&&`"${e}"`;throw new Error(r+"expected boolean, got type="+typeof t)}return t}function hr(t,e,r=""){const n=Di(t),i=t?.length,s=e!==void 0;if(!n||s&&i!==e){const o=r&&`"${r}" `,a=s?` of length ${e}`:"",c=n?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function Ci(t){const e=t.toString(16);return e.length&1?"0"+e:e}function qf(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Oo:BigInt("0x"+t)}function Ni(t){return qf(Ur(t))}function $i(t){return st(t),qf(Ur(Uint8Array.from(t).reverse()))}function To(t,e){return Si(t.toString(16).padStart(e*2,"0"))}function Bo(t,e){return To(t,e).reverse()}function _e(t,e,r){let n;if(typeof e=="string")try{n=Si(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Di(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof r=="number"&&i!==r)throw new Error(t+" of length "+r+" expected, got "+i);return n}const Ro=t=>typeof t=="bigint"&&Oo<=t;function t2(t,e,r){return Ro(t)&&Ro(e)&&Ro(r)&&e<=t&&t<r}function Co(t,e,r,n){if(!t2(e,r,n))throw new Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function Gf(t){let e;for(e=0;t>Oo;t>>=Ao,e+=1);return e}const Dn=t=>(Ao<<BigInt(t))-Ao;function r2(t,e,r){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");const n=f=>new Uint8Array(f),i=f=>Uint8Array.of(f);let s=n(t),o=n(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...f)=>r(o,s,...f),l=(f=n(0))=>{o=u(i(0),f),s=u(),f.length!==0&&(o=u(i(1),f),s=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const d=[];for(;f<e;){s=u();const g=s.slice();d.push(g),f+=s.length}return Vt(...d)};return(f,d)=>{c(),l(f);let g;for(;!(g=d(h()));)l();return c(),g}}function Pi(t,e,r={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(r).forEach(([i,s])=>n(i,s,!0))}function Wf(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(i!==void 0)return i;const s=t(r,...n);return e.set(r,s),s}}const Le=BigInt(0),Se=BigInt(1),dr=BigInt(2),Yf=BigInt(3),Zf=BigInt(4),Xf=BigInt(5),n2=BigInt(7),Jf=BigInt(8),i2=BigInt(9),Qf=BigInt(16);function Ke(t,e){const r=t%e;return r>=Le?r:e+r}function at(t,e,r){let n=t;for(;e-- >Le;)n*=n,n%=r;return n}function eh(t,e){if(t===Le)throw new Error("invert: expected non-zero number");if(e<=Le)throw new Error("invert: expected positive modulus, got "+e);let r=Ke(t,e),n=e,i=Le,s=Se;for(;r!==Le;){const o=n/r,a=n%r,c=i-s*o;n=r,r=a,i=s,s=c}if(n!==Se)throw new Error("invert: does not exist");return Ke(i,e)}function No(t,e,r){if(!t.eql(t.sqr(e),r))throw new Error("Cannot find square root")}function th(t,e){const r=(t.ORDER+Se)/Zf,n=t.pow(e,r);return No(t,n,e),n}function s2(t,e){const r=(t.ORDER-Xf)/Jf,n=t.mul(e,dr),i=t.pow(n,r),s=t.mul(e,i),o=t.mul(t.mul(s,dr),i),a=t.mul(s,t.sub(o,t.ONE));return No(t,a,e),a}function o2(t){const e=Xt(t),r=rh(t),n=r(e,e.neg(e.ONE)),i=r(e,n),s=r(e,e.neg(n)),o=(t+n2)/Qf;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,n);const h=a.mul(u,i),f=a.mul(u,s),d=a.eql(a.sqr(l),c),g=a.eql(a.sqr(h),c);u=a.cmov(u,l,d),l=a.cmov(f,h,g);const y=a.eql(a.sqr(l),c),E=a.cmov(u,l,y);return No(a,E,c),E}}function rh(t){if(t<Yf)throw new Error("sqrt is not defined for small field");let e=t-Se,r=0;for(;e%dr===Le;)e/=dr,r++;let n=dr;const i=Xt(t);for(;ih(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return th;let s=i.pow(n,e);const o=(e+Se)/dr;return function(a,c){if(a.is0(c))return c;if(ih(a,c)!==1)throw new Error("Cannot find square root");let u=r,l=a.mul(a.ONE,s),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let d=1,g=a.sqr(h);for(;!a.eql(g,a.ONE);)if(d++,g=a.sqr(g),d===u)throw new Error("Cannot find square root");const y=Se<<BigInt(u-d-1),E=a.pow(l,y);u=d,l=a.sqr(E),h=a.mul(h,l),f=a.mul(f,E)}return f}}function a2(t){return t%Zf===Yf?th:t%Jf===Xf?s2:t%Qf===i2?o2(t):rh(t)}const c2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function u2(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=c2.reduce((n,i)=>(n[i]="function",n),e);return Pi(t,r),t}function l2(t,e,r){if(r<Le)throw new Error("invalid exponent, negatives unsupported");if(r===Le)return t.ONE;if(r===Se)return e;let n=t.ONE,i=e;for(;r>Le;)r&Se&&(n=t.mul(n,i)),i=t.sqr(i),r>>=Se;return n}function nh(t,e,r=!1){const n=new Array(e.length).fill(r?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),s),n}function ih(t,e){const r=(t.ORDER-Se)/dr,n=t.pow(e,r),i=t.eql(n,t.ONE),s=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function sh(t,e){e!==void 0&&It(e);const r=e!==void 0?e:t.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Xt(t,e,r=!1,n={}){if(t<=Le)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(i=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);const{nBitLength:c,nByteLength:u}=sh(t,i);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const h=Object.freeze({ORDER:t,isLE:r,BITS:c,BYTES:u,MASK:Dn(c),ZERO:Le,ONE:Se,allowedLengths:a,create:f=>Ke(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Le<=f&&f<t},is0:f=>f===Le,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&Se)===Se,neg:f=>Ke(-f,t),eql:(f,d)=>f===d,sqr:f=>Ke(f*f,t),add:(f,d)=>Ke(f+d,t),sub:(f,d)=>Ke(f-d,t),mul:(f,d)=>Ke(f*d,t),pow:(f,d)=>l2(h,f,d),div:(f,d)=>Ke(f*eh(d,t),t),sqrN:f=>f*f,addN:(f,d)=>f+d,subN:(f,d)=>f-d,mulN:(f,d)=>f*d,inv:f=>eh(f,t),sqrt:s||(f=>(l||(l=a2(t)),l(h,f))),toBytes:f=>r?Bo(f,u):To(f,u),fromBytes:(f,d=!0)=>{if(a){if(!a.includes(f.length)||f.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const y=new Uint8Array(u);y.set(f,r?0:y.length-f.length),f=y}if(f.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+f.length);let g=r?$i(f):Ni(f);if(o&&(g=Ke(g,t)),!d&&!h.isValid(g))throw new Error("invalid field element: outside of range 0..ORDER");return g},invertBatch:f=>nh(h,f),cmov:(f,d,g)=>g?d:f});return Object.freeze(h)}function oh(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function ah(t){const e=oh(t);return e+Math.ceil(e/2)}function f2(t,e,r=!1){const n=t.length,i=oh(e),s=ah(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=r?$i(t):Ni(t),a=Ke(o,e-Se)+Se;return r?Bo(a,i):To(a,i)}const jr=BigInt(0),gr=BigInt(1);function Li(t,e){const r=e.negate();return t?r:e}function $o(t,e){const r=nh(t.Fp,e.map(n=>n.Z));return e.map((n,i)=>t.fromAffine(n.toAffine(r[i])))}function ch(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Po(t,e){ch(t,e);const r=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,s=Dn(t),o=BigInt(t);return{windows:r,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function uh(t,e,r){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=r;let a=Number(t&i),c=t>>o;a>n&&(a-=s,c+=gr);const u=e*n,l=u+Math.abs(a)-1,h=a===0,f=a<0,d=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:f,isNegF:d,offsetF:u}}function h2(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((r,n)=>{if(!(r instanceof e))throw new Error("invalid point at index "+n)})}function d2(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((r,n)=>{if(!e.isValid(r))throw new Error("invalid scalar at index "+n)})}const Lo=new WeakMap,lh=new WeakMap;function Uo(t){return lh.get(t)||1}function fh(t){if(t!==jr)throw new Error("invalid wNAF")}class g2{constructor(e,r){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=r}_unsafeLadder(e,r,n=this.ZERO){let i=e;for(;r>jr;)r&gr&&(n=n.add(i)),i=i.double(),r>>=gr;return n}precomputeWindow(e,r){const{windows:n,windowSize:i}=Po(r,this.bits),s=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,s.push(a);for(let u=1;u<i;u++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,r,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=Po(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:h,isNegF:f,offsetF:d}=uh(n,a,o);n=c,l?s=s.add(Li(f,r[d])):i=i.add(Li(h,r[u]))}return fh(n),{p:i,f:s}}wNAFUnsafe(e,r,n,i=this.ZERO){const s=Po(e,this.bits);for(let o=0;o<s.windows&&n!==jr;o++){const{nextN:a,offset:c,isZero:u,isNeg:l}=uh(n,o,s);if(n=a,!u){const h=r[c];i=i.add(l?h.negate():h)}}return fh(n),i}getPrecomputes(e,r,n){let i=Lo.get(r);return i||(i=this.precomputeWindow(r,e),e!==1&&(typeof n=="function"&&(i=n(i)),Lo.set(r,i))),i}cached(e,r,n){const i=Uo(e);return this.wNAF(i,this.getPrecomputes(i,e,n),r)}unsafe(e,r,n,i){const s=Uo(e);return s===1?this._unsafeLadder(e,r,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),r,i)}createCache(e,r){ch(r,this.bits),lh.set(e,r),Lo.delete(e)}hasCache(e){return Uo(e)!==1}}function p2(t,e,r,n){let i=e,s=t.ZERO,o=t.ZERO;for(;r>jr||n>jr;)r&gr&&(s=s.add(i)),n&gr&&(o=o.add(i)),i=i.double(),r>>=gr,n>>=gr;return{p1:s,p2:o}}function y2(t,e,r,n){h2(r,t),d2(n,e);const i=r.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Gf(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=Dn(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let d=h;d>=0;d-=c){l.fill(o);for(let y=0;y<s;y++){const E=n[y],T=Number(E>>BigInt(d)&u);l[T]=l[T].add(r[y])}let g=o;for(let y=l.length-1,E=o;y>0;y--)E=E.add(l[y]),g=g.add(E);if(f=f.add(g),d!==0)for(let y=0;y<c;y++)f=f.double()}return f}function hh(t,e,r){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return u2(e),e}else return Xt(t,{isLE:r})}function b2(t,e,r={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>jr))throw new Error(`CURVE.${a} must be positive bigint`)}const i=hh(e.p,r.Fp,n),s=hh(e.n,r.Fn,n),o=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Df("HashToScalar-");const In=BigInt(0),kr=BigInt(1),Ui=BigInt(2);function w2(t){return Pi(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(Pr({},t))}function m2(t){const e=w2(t),{P:r,type:n,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||fr,u=a?255:448,l=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),d=a?Ui**BigInt(254):Ui**BigInt(447),g=a?BigInt(8)*Ui**BigInt(251)-kr:BigInt(4)*Ui**BigInt(445)-kr,y=d+g+kr,E=B=>Ke(B,r),T=C(h);function C(B){return Bo(E(B),l)}function x(B){const m=_e("u coordinate",B,l);return a&&(m[31]&=127),E($i(m))}function R(B){return $i(i(_e("scalar",B,l)))}function F(B,m){const w=P(x(m),R(B));if(w===In)throw new Error("invalid private or public key received");return C(w)}function j(B){return F(B,T)}function M(B,m,w){const p=E(B*(m-w));return m=E(m-p),w=E(w+p),{x_2:m,x_3:w}}function P(B,m){Co("u",B,In,r),Co("scalar",m,d,y);const w=m,p=B;let b=kr,v=In,D=B,_=kr,I=In;for(let A=BigInt(u-1);A>=In;A--){const U=w>>A&kr;I^=U,{x_2:b,x_3:D}=M(I,b,D),{x_2:v,x_3:_}=M(I,v,_),I=U;const L=b+v,N=E(L*L),z=b-v,K=E(z*z),W=N-K,V=D+_,Y=D-_,ce=E(Y*L),qe=E(V*z),ct=ce+qe,Ln=ce-qe;D=E(ct*ct),_=E(p*E(Ln*Ln)),b=E(N*K),v=E(W*(N+E(f*W)))}({x_2:b,x_3:D}=M(I,b,D)),{x_2:v,x_3:_}=M(I,v,_);const S=s(v);return E(b*S)}const O={secretKey:l,publicKey:l,seed:l},H=(B=c(l))=>(st(B,O.seed),B);function q(B){const m=H(B);return{secretKey:m,publicKey:j(m)}}return{keygen:q,getSharedSecret:(B,m)=>F(B,m),getPublicKey:B=>j(B),scalarMult:F,scalarMultBase:j,utils:{randomSecretKey:H,randomPrivateKey:H},GuBytes:T.slice(),lengths:O}}const E2=BigInt(1),dh=BigInt(2),v2=BigInt(3),_2=BigInt(5),x2=BigInt(8),gh=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),D2={p:gh,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:x2,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function I2(t){const e=BigInt(10),r=BigInt(20),n=BigInt(40),i=BigInt(80),s=gh,o=t*t%s*t%s,a=at(o,dh,s)*o%s,c=at(a,E2,s)*t%s,u=at(c,_2,s)*c%s,l=at(u,e,s)*u%s,h=at(l,r,s)*l%s,f=at(h,n,s)*h%s,d=at(f,i,s)*f%s,g=at(d,i,s)*f%s,y=at(g,e,s)*u%s;return{pow_p_5_8:at(y,dh,s)*t%s,b2:o}}function S2(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const O2=Xt(D2.p,{isLE:!0}),Fo=(()=>{const t=O2.ORDER;return m2({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:r,b2:n}=I2(e);return Ke(at(r,v2,t)*n,t)},adjustScalarBytes:S2})})(),ph=(t,e)=>(t+(t>=0?e:-e)/yh)/e;function A2(t,e,r){const[[n,i],[s,o]]=e,a=ph(o*t,r),c=ph(-i*t,r);let u=t-a*n-c*s,l=-a*i-c*o;const h=u<Tt,f=l<Tt;h&&(u=-u),f&&(l=-l);const d=Dn(Math.ceil(Gf(r)/2))+Mr;if(u<Tt||u>=d||l<Tt||l>=d)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:u,k2neg:f,k2:l}}function jo(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function ko(t,e){const r={};for(let n of Object.keys(e))r[n]=t[n]===void 0?e[n]:t[n];return Ri(r.lowS,"lowS"),Ri(r.prehash,"prehash"),r.format!==void 0&&jo(r.format),r}class T2 extends Error{constructor(e=""){super(e)}}const At={Err:T2,_tlv:{encode:(t,e)=>{const{Err:r}=At;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length&1)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=Ci(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?Ci(i.length/2|128):"";return Ci(t)+s+i+e},decode(t,e){const{Err:r}=At;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new r("tlv.decode: length bytes not complete");if(u[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new r("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new r("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=At;if(t<Tt)throw new e("integer: negative integers are not allowed");let r=Ci(t);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=At;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Ni(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=At,i=_e("signature",t),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=At,n=e.encode(2,r.encode(t.r)),i=e.encode(2,r.encode(t.s)),s=n+i;return e.encode(48,s)}},Tt=BigInt(0),Mr=BigInt(1),yh=BigInt(2),Fi=BigInt(3),B2=BigInt(4);function zr(t,e){const{BYTES:r}=t;let n;if(typeof e=="bigint")n=e;else{let i=_e("private key",e);try{n=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function R2(t,e={}){const r=b2("weierstrass",t,e),{Fp:n,Fn:i}=r;let s=r.CURVE;const{h:o,n:a}=s;Pi(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=wh(n,i);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(B,m,w){const{x:p,y:b}=m.toAffine(),v=n.toBytes(p);if(Ri(w,"isCompressed"),w){l();const D=!n.isOdd(b);return Vt(bh(D),v)}else return Vt(Uint8Array.of(4),v,n.toBytes(b))}function f(B){hr(B,void 0,"Point");const{publicKey:m,publicKeyUncompressed:w}=u,p=B.length,b=B[0],v=B.subarray(1);if(p===m&&(b===2||b===3)){const D=n.fromBytes(v);if(!n.isValid(D))throw new Error("bad point: is not on curve, wrong x");const _=y(D);let I;try{I=n.sqrt(_)}catch(A){const U=A instanceof Error?": "+A.message:"";throw new Error("bad point: is not on curve, sqrt error"+U)}l();const S=n.isOdd(I);return(b&1)===1!==S&&(I=n.neg(I)),{x:D,y:I}}else if(p===w&&b===4){const D=n.BYTES,_=n.fromBytes(v.subarray(0,D)),I=n.fromBytes(v.subarray(D,D*2));if(!E(_,I))throw new Error("bad point: is not on curve");return{x:_,y:I}}else throw new Error(`bad point: got length ${p}, expected compressed=${m} or uncompressed=${w}`)}const d=e.toBytes||h,g=e.fromBytes||f;function y(B){const m=n.sqr(B),w=n.mul(m,B);return n.add(n.add(w,n.mul(B,s.a)),s.b)}function E(B,m){const w=n.sqr(m),p=y(B);return n.eql(w,p)}if(!E(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const T=n.mul(n.pow(s.a,Fi),B2),C=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(T,C)))throw new Error("bad curve params: a or b");function x(B,m,w=!1){if(!n.isValid(m)||w&&n.is0(m))throw new Error(`bad point coordinate ${B}`);return m}function R(B){if(!(B instanceof O))throw new Error("ProjectivePoint expected")}function F(B){if(!c||!c.basises)throw new Error("no endo");return A2(B,c.basises,i.ORDER)}const j=Wf((B,m)=>{const{X:w,Y:p,Z:b}=B;if(n.eql(b,n.ONE))return{x:w,y:p};const v=B.is0();m==null&&(m=v?n.ONE:n.inv(b));const D=n.mul(w,m),_=n.mul(p,m),I=n.mul(b,m);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(I,n.ONE))throw new Error("invZ was invalid");return{x:D,y:_}}),M=Wf(B=>{if(B.is0()){if(e.allowInfinityPoint&&!n.is0(B.Y))return;throw new Error("bad point: ZERO")}const{x:m,y:w}=B.toAffine();if(!n.isValid(m)||!n.isValid(w))throw new Error("bad point: x or y not field elements");if(!E(m,w))throw new Error("bad point: equation left != right");if(!B.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function P(B,m,w,p,b){return w=new O(n.mul(w.X,B),w.Y,w.Z),m=Li(p,m),w=Li(b,w),m.add(w)}class O{constructor(m,w,p){this.X=x("x",m),this.Y=x("y",w,!0),this.Z=x("z",p),Object.freeze(this)}static CURVE(){return s}static fromAffine(m){const{x:w,y:p}=m||{};if(!m||!n.isValid(w)||!n.isValid(p))throw new Error("invalid affine point");if(m instanceof O)throw new Error("projective point not allowed");return n.is0(w)&&n.is0(p)?O.ZERO:new O(w,p,n.ONE)}static fromBytes(m){const w=O.fromAffine(g(hr(m,void 0,"point")));return w.assertValidity(),w}static fromHex(m){return O.fromBytes(_e("pointHex",m))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(m=8,w=!0){return q.createCache(this,m),w||this.multiply(Fi),this}assertValidity(){M(this)}hasEvenY(){const{y:m}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(m)}equals(m){R(m);const{X:w,Y:p,Z:b}=this,{X:v,Y:D,Z:_}=m,I=n.eql(n.mul(w,_),n.mul(v,b)),S=n.eql(n.mul(p,_),n.mul(D,b));return I&&S}negate(){return new O(this.X,n.neg(this.Y),this.Z)}double(){const{a:m,b:w}=s,p=n.mul(w,Fi),{X:b,Y:v,Z:D}=this;let _=n.ZERO,I=n.ZERO,S=n.ZERO,A=n.mul(b,b),U=n.mul(v,v),L=n.mul(D,D),N=n.mul(b,v);return N=n.add(N,N),S=n.mul(b,D),S=n.add(S,S),_=n.mul(m,S),I=n.mul(p,L),I=n.add(_,I),_=n.sub(U,I),I=n.add(U,I),I=n.mul(_,I),_=n.mul(N,_),S=n.mul(p,S),L=n.mul(m,L),N=n.sub(A,L),N=n.mul(m,N),N=n.add(N,S),S=n.add(A,A),A=n.add(S,A),A=n.add(A,L),A=n.mul(A,N),I=n.add(I,A),L=n.mul(v,D),L=n.add(L,L),A=n.mul(L,N),_=n.sub(_,A),S=n.mul(L,U),S=n.add(S,S),S=n.add(S,S),new O(_,I,S)}add(m){R(m);const{X:w,Y:p,Z:b}=this,{X:v,Y:D,Z:_}=m;let I=n.ZERO,S=n.ZERO,A=n.ZERO;const U=s.a,L=n.mul(s.b,Fi);let N=n.mul(w,v),z=n.mul(p,D),K=n.mul(b,_),W=n.add(w,p),V=n.add(v,D);W=n.mul(W,V),V=n.add(N,z),W=n.sub(W,V),V=n.add(w,b);let Y=n.add(v,_);return V=n.mul(V,Y),Y=n.add(N,K),V=n.sub(V,Y),Y=n.add(p,b),I=n.add(D,_),Y=n.mul(Y,I),I=n.add(z,K),Y=n.sub(Y,I),A=n.mul(U,V),I=n.mul(L,K),A=n.add(I,A),I=n.sub(z,A),A=n.add(z,A),S=n.mul(I,A),z=n.add(N,N),z=n.add(z,N),K=n.mul(U,K),V=n.mul(L,V),z=n.add(z,K),K=n.sub(N,K),K=n.mul(U,K),V=n.add(V,K),N=n.mul(z,V),S=n.add(S,N),N=n.mul(Y,V),I=n.mul(W,I),I=n.sub(I,N),N=n.mul(W,z),A=n.mul(Y,A),A=n.add(A,N),new O(I,S,A)}subtract(m){return this.add(m.negate())}is0(){return this.equals(O.ZERO)}multiply(m){const{endo:w}=e;if(!i.isValidNot0(m))throw new Error("invalid scalar: out of range");let p,b;const v=D=>q.cached(this,D,_=>$o(O,_));if(w){const{k1neg:D,k1:_,k2neg:I,k2:S}=F(m),{p:A,f:U}=v(_),{p:L,f:N}=v(S);b=U.add(N),p=P(w.beta,A,L,D,I)}else{const{p:D,f:_}=v(m);p=D,b=_}return $o(O,[p,b])[0]}multiplyUnsafe(m){const{endo:w}=e,p=this;if(!i.isValid(m))throw new Error("invalid scalar: out of range");if(m===Tt||p.is0())return O.ZERO;if(m===Mr)return p;if(q.hasCache(this))return this.multiply(m);if(w){const{k1neg:b,k1:v,k2neg:D,k2:_}=F(m),{p1:I,p2:S}=p2(O,p,v,_);return P(w.beta,I,S,b,D)}else return q.unsafe(p,m)}multiplyAndAddUnsafe(m,w,p){const b=this.multiplyUnsafe(w).add(m.multiplyUnsafe(p));return b.is0()?void 0:b}toAffine(m){return j(this,m)}isTorsionFree(){const{isTorsionFree:m}=e;return o===Mr?!0:m?m(O,this):q.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:m}=e;return o===Mr?this:m?m(O,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(m=!0){return Ri(m,"isCompressed"),this.assertValidity(),d(O,this,m)}toHex(m=!0){return Ur(this.toBytes(m))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(m=!0){return this.toBytes(m)}_setWindowSize(m){this.precompute(m)}static normalizeZ(m){return $o(O,m)}static msm(m,w){return y2(O,i,m,w)}static fromPrivateKey(m){return O.BASE.multiply(zr(i,m))}}O.BASE=new O(s.Gx,s.Gy,n.ONE),O.ZERO=new O(n.ZERO,n.ONE,n.ZERO),O.Fp=n,O.Fn=i;const H=i.BITS,q=new g2(O,e.endo?Math.ceil(H/2):H);return O.BASE.precompute(8),O}function bh(t){return Uint8Array.of(t?2:3)}function wh(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function C2(t,e={}){const{Fn:r}=t,n=e.randomBytes||fr,i=Object.assign(wh(t.Fp,r),{seed:ah(r.ORDER)});function s(f){try{return!!zr(r,f)}catch{return!1}}function o(f,d){const{publicKey:g,publicKeyUncompressed:y}=i;try{const E=f.length;return d===!0&&E!==g||d===!1&&E!==y?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=n(i.seed)){return f2(hr(f,i.seed,"seed"),r.ORDER)}function c(f,d=!0){return t.BASE.multiply(zr(r,f)).toBytes(d)}function u(f){const d=a(f);return{secretKey:d,publicKey:c(d)}}function l(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:d,publicKey:g,publicKeyUncompressed:y}=i;if(r.allowedLengths||d===g)return;const E=_e("key",f).length;return E===g||E===y}function h(f,d,g=!0){if(l(f)===!0)throw new Error("first arg must be private key");if(l(d)===!1)throw new Error("second arg must be public key");const y=zr(r,f);return t.fromHex(d).multiply(y).toBytes(g)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:u,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:f=>zr(r,f),precompute(f=8,d=t.BASE){return d.precompute(f,!1)}},lengths:i})}function N2(t,e,r={}){Ii(e),Pi(r,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=r.randomBytes||fr,i=r.hmac||((w,...p)=>Ti(e,w,Vt(...p))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:h,utils:f,lengths:d}=C2(t,r),g={prehash:!1,lowS:typeof r.lowS=="boolean"?r.lowS:!1,format:void 0,extraEntropy:!1},y="compact";function E(w){const p=a>>Mr;return w>p}function T(w,p){if(!o.isValidNot0(p))throw new Error(`invalid signature ${w}: out of range 1..Point.Fn.ORDER`);return p}function C(w,p){jo(p);const b=d.signature,v=p==="compact"?b:p==="recovered"?b+1:void 0;return hr(w,v,`${p} signature`)}class x{constructor(p,b,v){this.r=T("r",p),this.s=T("s",b),v!=null&&(this.recovery=v),Object.freeze(this)}static fromBytes(p,b=y){C(p,b);let v;if(b==="der"){const{r:S,s:A}=At.toSig(hr(p));return new x(S,A)}b==="recovered"&&(v=p[0],b="compact",p=p.subarray(1));const D=o.BYTES,_=p.subarray(0,D),I=p.subarray(D,D*2);return new x(o.fromBytes(_),o.fromBytes(I),v)}static fromHex(p,b){return this.fromBytes(Si(p),b)}addRecoveryBit(p){return new x(this.r,this.s,p)}recoverPublicKey(p){const b=s.ORDER,{r:v,s:D,recovery:_}=this;if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");if(a*yh<b&&_>1)throw new Error("recovery id is ambiguous for h>1 curve");const I=_===2||_===3?v+a:v;if(!s.isValid(I))throw new Error("recovery id 2 or 3 invalid");const S=s.toBytes(I),A=t.fromBytes(Vt(bh((_&1)===0),S)),U=o.inv(I),L=F(_e("msgHash",p)),N=o.create(-L*U),z=o.create(D*U),K=t.BASE.multiplyUnsafe(N).add(A.multiplyUnsafe(z));if(K.is0())throw new Error("point at infinify");return K.assertValidity(),K}hasHighS(){return E(this.s)}toBytes(p=y){if(jo(p),p==="der")return Si(At.hexFromSig(this));const b=o.toBytes(this.r),v=o.toBytes(this.s);if(p==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Vt(Uint8Array.of(this.recovery),b,v)}return Vt(b,v)}toHex(p){return Ur(this.toBytes(p))}assertValidity(){}static fromCompact(p){return x.fromBytes(_e("sig",p),"compact")}static fromDER(p){return x.fromBytes(_e("sig",p),"der")}normalizeS(){return this.hasHighS()?new x(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Ur(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Ur(this.toBytes("compact"))}}const R=r.bits2int||function(w){if(w.length>8192)throw new Error("input is too large");const p=Ni(w),b=w.length*8-c;return b>0?p>>BigInt(b):p},F=r.bits2int_modN||function(w){return o.create(R(w))},j=Dn(c);function M(w){return Co("num < 2^"+c,w,Tt,j),o.toBytes(w)}function P(w,p){return hr(w,void 0,"message"),p?hr(e(w),void 0,"prehashed message"):w}function O(w,p,b){if(["recovered","canonical"].some(z=>z in b))throw new Error("sign() legacy options not supported");const{lowS:v,prehash:D,extraEntropy:_}=ko(b,g);w=P(w,D);const I=F(w),S=zr(o,p),A=[M(S),M(I)];if(_!=null&&_!==!1){const z=_===!0?n(d.secretKey):_;A.push(_e("extraEntropy",z))}const U=Vt(...A),L=I;function N(z){const K=R(z);if(!o.isValidNot0(K))return;const W=o.inv(K),V=t.BASE.multiply(K).toAffine(),Y=o.create(V.x);if(Y===Tt)return;const ce=o.create(W*o.create(L+Y*S));if(ce===Tt)return;let qe=(V.x===Y?0:2)|Number(V.y&Mr),ct=ce;return v&&E(ce)&&(ct=o.neg(ce),qe^=1),new x(Y,ct,qe)}return{seed:U,k2sig:N}}function H(w,p,b={}){w=_e("message",w);const{seed:v,k2sig:D}=O(w,p,b);return r2(e.outputLen,o.BYTES,i)(v,D)}function q(w){let p;const b=typeof w=="string"||Di(w),v=!b&&w!==null&&typeof w=="object"&&typeof w.r=="bigint"&&typeof w.s=="bigint";if(!b&&!v)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(v)p=new x(w.r,w.s);else if(b){try{p=x.fromBytes(_e("sig",w),"der")}catch(D){if(!(D instanceof At.Err))throw D}if(!p)try{p=x.fromBytes(_e("sig",w),"compact")}catch{return!1}}return p||!1}function B(w,p,b,v={}){const{lowS:D,prehash:_,format:I}=ko(v,g);if(b=_e("publicKey",b),p=P(_e("message",p),_),"strict"in v)throw new Error("options.strict was renamed to lowS");const S=I===void 0?q(w):x.fromBytes(_e("sig",w),I);if(S===!1)return!1;try{const A=t.fromBytes(b);if(D&&S.hasHighS())return!1;const{r:U,s:L}=S,N=F(p),z=o.inv(L),K=o.create(N*z),W=o.create(U*z),V=t.BASE.multiplyUnsafe(K).add(A.multiplyUnsafe(W));return V.is0()?!1:o.create(V.x)===U}catch{return!1}}function m(w,p,b={}){const{prehash:v}=ko(b,g);return p=P(p,v),x.fromBytes(w,"recovered").recoverPublicKey(p).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:h,utils:f,lengths:d,Point:t,sign:H,verify:B,recoverPublicKey:m,Signature:x,hash:e})}function $2(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},r=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=Xt(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),s={Fp:r,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function P2(t){const{CURVE:e,curveOpts:r}=$2(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:r,hash:t.hash,ecdsaOpts:n}}function L2(t,e){const r=e.Point;return Object.assign({},e,{ProjectivePoint:r,CURVE:Object.assign({},t,sh(r.Fn.ORDER,r.Fn.BITS))})}function U2(t){const{CURVE:e,curveOpts:r,hash:n,ecdsaOpts:i}=P2(t),s=R2(e,r),o=N2(s,n,i);return L2(t,o)}function Mo(t,e){const r=n=>U2(yn(Pr({},t),{hash:n}));return yn(Pr({},r(e)),{create:r})}const mh={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Eh={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},vh={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},F2=Xt(mh.p),j2=Xt(Eh.p),k2=Xt(vh.p),M2=Mo(yn(Pr({},mh),{Fp:F2,lowS:!1}),Nf);Mo(yn(Pr({},Eh),{Fp:j2,lowS:!1}),xv),Mo(yn(Pr({},vh),{Fp:k2,lowS:!1,allowedPrivateKeyLengths:[130,131,132]}),_v);const z2=M2,_h="base10",Oe="base16",pr="base64pad",zo="base64url",Sn="utf8",xh=0,Vr=1,ji=2,V2=0,Dh=1,On=12,Vo=32;function K2(){const t=Fo.utils.randomPrivateKey(),e=Fo.getPublicKey(t);return{privateKey:$e(t,Oe),publicKey:$e(e,Oe)}}function Ko(){const t=fr(Vo);return $e(t,Oe)}function H2(t,e){const r=Fo.getSharedSecret(ke(t,Oe),ke(e,Oe)),n=e2(Bi,r,void 0,void 0,Vo);return $e(n,Oe)}function q2(t){const e=Bi(ke(t,Oe));return $e(e,Oe)}function ki(t){const e=Bi(ke(t,Sn));return $e(e,Oe)}function Ih(t){return ke(`${t}`,_h)}function yr(t){return Number($e(t,_h))}function Sh(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Oh(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4;return e+"=".repeat(r)}function G2(t){const e=Ih(typeof t.type<"u"?t.type:xh);if(yr(e)===Vr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?ke(t.senderPublicKey,Oe):void 0,n=typeof t.iv<"u"?ke(t.iv,Oe):fr(On),i=ke(t.symKey,Oe),s=Vf(i,n).encrypt(ke(t.message,Sn)),o=Ah({type:e,sealed:s,iv:n,senderPublicKey:r});return t.encoding===zo?Sh(o):o}function W2(t){const e=ke(t.symKey,Oe),{sealed:r,iv:n}=An({encoded:t.encoded,encoding:t.encoding}),i=Vf(e,n).decrypt(r);if(i===null)throw new Error("Failed to decrypt");return $e(i,Sn)}function Y2(t,e){const r=Ih(ji),n=fr(On),i=ke(t,Sn),s=Ah({type:r,sealed:i,iv:n});return e===zo?Sh(s):s}function Z2(t,e){const{sealed:r}=An({encoded:t,encoding:e});return $e(r,Sn)}function Ah(t){if(yr(t.type)===ji)return $e(pn([t.type,t.sealed]),pr);if(yr(t.type)===Vr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return $e(pn([t.type,t.senderPublicKey,t.iv,t.sealed]),pr)}return $e(pn([t.type,t.iv,t.sealed]),pr)}function An(t){const e=(t.encoding||pr)===zo?Oh(t.encoded):t.encoded,r=ke(e,pr),n=r.slice(V2,Dh),i=Dh;if(yr(n)===Vr){const c=i+Vo,u=c+On,l=r.slice(i,c),h=r.slice(c,u),f=r.slice(u);return{type:n,sealed:f,iv:h,senderPublicKey:l}}if(yr(n)===ji){const c=r.slice(i),u=fr(On);return{type:n,sealed:c,iv:u}}const s=i+On,o=r.slice(i,s),a=r.slice(s);return{type:n,sealed:a,iv:o}}function X2(t,e){const r=An({encoded:t,encoding:e?.encoding});return Th({type:yr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?$e(r.senderPublicKey,Oe):void 0,receiverPublicKey:e?.receiverPublicKey})}function Th(t){const e=t?.type||xh;if(e===Vr){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Bh(t){return t.type===Vr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Rh(t){return t.type===ji}function J2(t){const e=Buffer.from(t.x,"base64"),r=Buffer.from(t.y,"base64");return pn([new Uint8Array([4]),e,r])}function Q2(t,e){const[r,n,i]=t.split("."),s=Buffer.from(Oh(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${r}.${n}`,u=Bi(c),l=J2(e);if(!z2.verify(pn([o,a]),u,l))throw new Error("Invalid signature");return Bs(t).payload}const e_="irn";function Mi(t){return t?.relay||{protocol:e_}}function Kr(t){const e=SE[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var t_=Object.defineProperty,r_=Object.defineProperties,n_=Object.getOwnPropertyDescriptors,Ch=Object.getOwnPropertySymbols,i_=Object.prototype.hasOwnProperty,s_=Object.prototype.propertyIsEnumerable,Nh=(t,e,r)=>e in t?t_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ho=(t,e)=>{for(var r in e||(e={}))i_.call(e,r)&&Nh(t,r,e[r]);if(Ch)for(var r of Ch(e))s_.call(e,r)&&Nh(t,r,e[r]);return t},o_=(t,e)=>r_(t,n_(e));function a_(t,e="-"){const r={},n="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(n)){const s=i.replace(n,""),o=t[i];r[s]=o}}),r}function $h(t){if(!t.includes("wc:")){const u=gf(t);u!=null&&u.includes("wc:")&&(t=u)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),i=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:c_(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:a_(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function c_(t){return t.startsWith("//")?t.substring(2):t}function u_(t,e="-"){const r="relay",n={};return Object.keys(t).forEach(i=>{const s=i,o=r+e+s;t[s]&&(n[o]=t[s])}),n}function Ph(t){const e=new URLSearchParams,r=Ho(Ho(o_(Ho({},u_(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(r).sort(([n],[i])=>n.localeCompare(i)).forEach(([n,i])=>{i!==void 0&&e.append(n,String(i))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}const l_={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},f_={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ee(t,e){const{message:r,code:n}=f_[t];return{message:e?`${r} ${e}`:r,code:n}}function Tn(t,e){const{message:r,code:n}=l_[t];return{message:e?`${r} ${e}`:r,code:n}}function Hr(t){return typeof t>"u"}function Lh(t,e){return e&&Hr(t)?!0:typeof t=="string"&&!!t.trim().length}function h_(t){function e(r){try{return typeof new URL(r)<"u"}catch{return!1}}try{if(Lh(t,!1)){if(e(t))return!0;const r=gf(t);return e(r)}}catch{}return!1}function d_(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function g_(t){return t?.topic}function qo(t){return typeof t<"u"&&typeof t!==null}function Uh(){const t=_i();return new Promise(e=>{switch(t){case nt.browser:e(p_());break;case nt.reactNative:e(y_());break;case nt.node:e(b_());break;default:e(!0)}})}function p_(){return bn()&&navigator?.onLine}async function y_(){if(lr()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t?.isConnected}return!0}function b_(){return!0}function w_(t){switch(_i()){case nt.browser:m_(t);break;case nt.reactNative:E_(t);break}}function m_(t){!lr()&&bn()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function E_(t){lr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function v_(){var t;return bn()&&Or()?((t=Or())==null?void 0:t.visibilityState)==="visible":!0}var __=Object.defineProperty,x_=(t,e,r)=>e in t?__(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yt=(t,e,r)=>x_(t,typeof e!="symbol"?e+"":e,r);class Fh{constructor(e,r){this.core=e,this.logger=r,yt(this,"keychain",new Map),yt(this,"name",Za),yt(this,"version",Xa),yt(this,"initialized",!1),yt(this,"storagePrefix",et),yt(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),yt(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),yt(this,"set",async(n,i)=>{this.isInitialized(),this.keychain.set(n,i),await this.persist()}),yt(this,"get",n=>{this.isInitialized();const i=this.keychain.get(n);if(typeof i>"u"){const{message:s}=ee("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(s)}return i}),yt(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=Te(r,this.name)}get context(){return Fe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,fo(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ho(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=ee("NOT_INITIALIZED",this.name);throw new Error(e)}}}var D_=Object.defineProperty,I_=(t,e,r)=>e in t?D_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,be=(t,e,r)=>I_(t,typeof e!="symbol"?e+"":e,r);class jh{constructor(e,r,n){this.core=e,this.logger=r,be(this,"name",Wa),be(this,"keychain"),be(this,"randomSessionIdentifier",Ko()),be(this,"initialized",!1),be(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),be(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),be(this,"getClientId",async()=>{this.isInitialized();const i=await this.getClientSeed(),s=Eu(i);return mu(s.publicKey)}),be(this,"generateKeyPair",()=>{this.isInitialized();const i=K2();return this.setPrivateKey(i.publicKey,i.privateKey)}),be(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=Eu(s),a=this.randomSessionIdentifier;return await zb(a,i,Ya,o)}),be(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=H2(a,s);return this.setSymKey(c,o)}),be(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||q2(i);return await this.keychain.set(o,i),o}),be(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),be(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),be(this,"encode",async(i,s,o)=>{this.isInitialized();const a=Th(o),c=nr(s);if(Rh(a))return Y2(c,o?.encoding);if(Bh(a)){const f=a.senderPublicKey,d=a.receiverPublicKey;i=await this.generateSharedKey(f,d)}const u=this.getSymKey(i),{type:l,senderPublicKey:h}=a;return G2({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o?.encoding})}),be(this,"decode",async(i,s,o)=>{this.isInitialized();const a=X2(s,o);if(Rh(a)){const c=Z2(s,o?.encoding);return mr(c)}if(Bh(a)){const c=a.receiverPublicKey,u=a.senderPublicKey;i=await this.generateSharedKey(c,u)}try{const c=this.getSymKey(i),u=W2({symKey:c,encoded:s,encoding:o?.encoding});return mr(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),be(this,"getPayloadType",(i,s=pr)=>{const o=An({encoded:i,encoding:s});return yr(o.type)}),be(this,"getPayloadSenderPublicKey",(i,s=pr)=>{const o=An({encoded:i,encoding:s});return o.senderPublicKey?$e(o.senderPublicKey,Oe):void 0}),this.core=e,this.logger=Te(r,this.name),this.keychain=n||new Fh(this.core,this.logger)}get context(){return Fe(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(as)}catch{e=Ko(),await this.keychain.set(as,e)}return ke(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=ee("NOT_INITIALIZED",this.name);throw new Error(e)}}}var S_=Object.defineProperty,O_=Object.defineProperties,A_=Object.getOwnPropertyDescriptors,kh=Object.getOwnPropertySymbols,T_=Object.prototype.hasOwnProperty,B_=Object.prototype.propertyIsEnumerable,Go=(t,e,r)=>e in t?S_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,R_=(t,e)=>{for(var r in e||(e={}))T_.call(e,r)&&Go(t,r,e[r]);if(kh)for(var r of kh(e))B_.call(e,r)&&Go(t,r,e[r]);return t},C_=(t,e)=>O_(t,A_(e)),He=(t,e,r)=>Go(t,typeof e!="symbol"?e+"":e,r);class Mh extends Np{constructor(e,r){super(e,r),this.logger=e,this.core=r,He(this,"messages",new Map),He(this,"messagesWithoutClientAck",new Map),He(this,"name",Ja),He(this,"version",Qa),He(this,"initialized",!1),He(this,"storagePrefix",et),He(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),He(this,"set",async(n,i,s)=>{this.isInitialized();const o=ki(i);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(n,a),s===rn.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,C_(R_({},c),{[o]:i}))}return await this.persist(),o}),He(this,"get",n=>{this.isInitialized();let i=this.messages.get(n);return typeof i>"u"&&(i={}),i}),He(this,"getWithoutAck",n=>{this.isInitialized();const i={};for(const s of n){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),He(this,"has",(n,i)=>{this.isInitialized();const s=this.get(n),o=ki(i);return typeof s[o]<"u"}),He(this,"ack",async(n,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(n);if(typeof s>"u")return;const o=ki(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,s),await this.persist()}),He(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=Te(e,this.name),this.core=r}get context(){return Fe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,fo(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,fo(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ho(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?ho(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=ee("NOT_INITIALIZED",this.name);throw new Error(e)}}}const N_="PARSE_ERROR",$_="INVALID_REQUEST",P_="METHOD_NOT_FOUND",L_="INVALID_PARAMS",zh="INTERNAL_ERROR",Wo="SERVER_ERROR",U_=[-32700,-32600,-32601,-32602,-32603],Bn={[N_]:{code:-32700,message:"Parse error"},[$_]:{code:-32600,message:"Invalid Request"},[P_]:{code:-32601,message:"Method not found"},[L_]:{code:-32602,message:"Invalid params"},[zh]:{code:-32603,message:"Internal error"},[Wo]:{code:-32e3,message:"Server error"}},Vh=Wo;function F_(t){return U_.includes(t)}function Kh(t){return Object.keys(Bn).includes(t)?Bn[t]:Bn[Vh]}function j_(t){const e=Object.values(Bn).find(r=>r.code===t);return e||Bn[Vh]}function k_(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Hh={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Yo=function(t,e){return Yo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},Yo(t,e)};function M_(t,e){Yo(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Zo=function(){return Zo=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Zo.apply(this,arguments)};function z_(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function V_(t,e,r,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,n);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,r,s):o(e,r))||s);return i>3&&s&&Object.defineProperty(e,r,s),s}function K_(t,e){return function(r,n){e(r,n,t)}}function H_(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function q_(t,e,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(l){try{u(n.next(l))}catch(h){o(h)}}function c(l){try{u(n.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):i(l.value).then(a,c)}u((n=n.apply(t,e||[])).next())})}function G_(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){r.label=u[1];break}if(u[0]===6&&r.label<s[1]){r.label=s[1],s=u;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(u);break}s[2]&&r.ops.pop(),r.trys.pop();continue}u=e.call(t,r)}catch(l){u=[6,l],i=0}finally{n=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function W_(t,e,r,n){n===void 0&&(n=r),t[n]=e[r]}function Y_(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Xo(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function qh(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}function Z_(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(qh(arguments[e]));return t}function X_(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),i=0,e=0;e<r;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n}function Rn(t){return this instanceof Rn?(this.v=t,this):new Rn(t)}function J_(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){n[f]&&(i[f]=function(d){return new Promise(function(g,y){s.push([f,d,g,y])>1||a(f,d)})})}function a(f,d){try{c(n[f](d))}catch(g){h(s[0][3],g)}}function c(f){f.value instanceof Rn?Promise.resolve(f.value.v).then(u,l):h(s[0][2],f)}function u(f){a("next",f)}function l(f){a("throw",f)}function h(f,d){f(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Q_(t){var e,r;return e={},n("next"),n("throw",function(i){throw i}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(i,s){e[i]=t[i]?function(o){return(r=!r)?{value:Rn(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function e3(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Xo=="function"?Xo(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(s){r[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function t3(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function r3(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function n3(t){return t&&t.__esModule?t:{default:t}}function i3(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function s3(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var o3=Object.freeze({__proto__:null,__extends:M_,get __assign(){return Zo},__rest:z_,__decorate:V_,__param:K_,__metadata:H_,__awaiter:q_,__generator:G_,__createBinding:W_,__exportStar:Y_,__values:Xo,__read:qh,__spread:Z_,__spreadArrays:X_,__await:Rn,__asyncGenerator:J_,__asyncDelegator:Q_,__asyncValues:e3,__makeTemplateObject:t3,__importStar:r3,__importDefault:n3,__classPrivateFieldGet:i3,__classPrivateFieldSet:s3}),a3=ua(o3),Bt={},Gh;function c3(){if(Gh)return Bt;Gh=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.isBrowserCryptoAvailable=Bt.getSubtleCrypto=Bt.getBrowerCrypto=void 0;function t(){return ut?.crypto||ut?.msCrypto||{}}Bt.getBrowerCrypto=t;function e(){const n=t();return n.subtle||n.webkitSubtle}Bt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Bt.isBrowserCryptoAvailable=r,Bt}var Rt={},Wh;function u3(){if(Wh)return Rt;Wh=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.isBrowser=Rt.isNode=Rt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Rt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Rt.isNode=e;function r(){return!t()&&!e()}return Rt.isBrowser=r,Rt}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=a3;e.__exportStar(c3(),t),e.__exportStar(u3(),t)})(Hh);function Yh(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function zi(t=6){return BigInt(Yh(t))}function Jo(t,e,r){return{id:r||Yh(),jsonrpc:"2.0",method:t,params:e}}function Zh(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Xh(t,e,r){return{id:t,jsonrpc:"2.0",error:l3(e,r)}}function l3(t,e){return typeof t>"u"?Kh(zh):(typeof t=="string"&&(t=Object.assign(Object.assign({},Kh(Wo)),{message:t})),typeof e<"u"&&(t.data=e),F_(t.code)&&(t=j_(t.code)),t)}class f3{}class h3 extends f3{constructor(){super()}}class d3 extends h3{constructor(e){super()}}const g3="^wss?:";function p3(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function y3(t,e){const r=p3(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function Jh(t){return y3(t,g3)}function b3(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Qh(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function ed(t){return Qh(t)&&"method"in t}function Qo(t){return Qh(t)&&(td(t)||Vi(t))}function td(t){return"result"in t}function Vi(t){return"error"in t}class w3 extends d3{constructor(e){super(e),this.events=new Ge.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Jo(e.method,e.params||[],e.id||zi().toString()),r)}async requestStrict(e,r){return new Promise(async(n,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{Vi(s)?i(s.error):n(s.result)});try{await this.connection.send(e,r)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Qo(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const m3=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),E3=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",rd=t=>t.split("?")[0],nd=10,v3=m3();class _3{constructor(e){if(this.url=e,this.events=new Ge.exports.EventEmitter,this.registering=!1,!Jh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(nr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!Jh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((n,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,n)=>{const i=Hh.isReactNative()?void 0:{rejectUnauthorized:!b3(e)},s=new v3(e,[],i);E3()?s.onerror=o=>{const a=o;n(this.emitError(a.error))}:s.on("error",o=>{n(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),r(s)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?mr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const n=this.parseError(r),i=n.message||n.toString(),s=Xh(e,i);this.events.emit("payload",s)}parseError(e,r=this.url){return k_(e,rd(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>nd&&this.events.setMaxListeners(nd)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${rd(this.url)}`));return this.events.emit("register_error",r),r}}var x3=Object.defineProperty,D3=Object.defineProperties,I3=Object.getOwnPropertyDescriptors,id=Object.getOwnPropertySymbols,S3=Object.prototype.hasOwnProperty,O3=Object.prototype.propertyIsEnumerable,ea=(t,e,r)=>e in t?x3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,qr=(t,e)=>{for(var r in e||(e={}))S3.call(e,r)&&ea(t,r,e[r]);if(id)for(var r of id(e))O3.call(e,r)&&ea(t,r,e[r]);return t},sd=(t,e)=>D3(t,I3(e)),Qe=(t,e,r)=>ea(t,typeof e!="symbol"?e+"":e,r);class A3 extends $p{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,Qe(this,"events",new Ge.exports.EventEmitter),Qe(this,"name",tc),Qe(this,"queue",new Map),Qe(this,"publishTimeout",G.toMiliseconds(G.ONE_MINUTE)),Qe(this,"initialPublishTimeout",G.toMiliseconds(G.ONE_SECOND*15)),Qe(this,"needsTransportRestart",!1),Qe(this,"publish",async(n,i,s)=>{var o,a,c,u,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:s}});const h=s?.ttl||ec,f=s?.prompt||!1,d=s?.tag||0,g=s?.id||zi().toString(),y=Kr(Mi().protocol),E={id:g,method:s?.publishMethod||y.publish,params:qr({topic:n,message:i,ttl:h,prompt:f,tag:d,attestation:s?.attestation},s?.tvf)},T=`Failed to publish payload, please try again. id:${g} tag:${d}`;try{Hr((o=E.params)==null?void 0:o.prompt)&&((a=E.params)==null||delete a.prompt),Hr((c=E.params)==null?void 0:c.tag)&&((u=E.params)==null||delete u.tag);const C=new Promise(async x=>{const R=({id:j})=>{var M;((M=E.id)==null?void 0:M.toString())===j.toString()&&(this.removeRequestFromQueue(j),this.relayer.events.removeListener(oe.publish,R),x())};this.relayer.events.on(oe.publish,R);const F=gt(new Promise((j,M)=>{this.rpcPublish(E,s).then(j).catch(P=>{this.logger.warn(P,P?.message),M(P)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${g} tag:${d}`);try{await F,this.events.removeListener(oe.publish,R)}catch(j){this.queue.set(g,{request:E,opts:s,attempt:1}),this.logger.warn(j,j?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:g,topic:n,message:i,opts:s}}),await gt(C,this.publishTimeout,T)}catch(C){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(C),(l=s?.internal)!=null&&l.throwOnFailedPublish)throw C}finally{this.queue.delete(g)}}),Qe(this,"publishCustom",async n=>{var i,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});const{payload:u,opts:l={}}=n,{attestation:h,tvf:f,publishMethod:d,prompt:g,tag:y,ttl:E=G.FIVE_MINUTES}=l,T=l.id||zi().toString(),C=Kr(Mi().protocol),x=d||C.publish,R={id:T,method:x,params:qr(sd(qr({},u),{ttl:E,prompt:g,tag:y,attestation:h}),f)},F=`Failed to publish custom payload, please try again. id:${T} tag:${y}`;try{Hr((i=R.params)==null?void 0:i.prompt)&&((s=R.params)==null||delete s.prompt),Hr((o=R.params)==null?void 0:o.tag)&&((a=R.params)==null||delete a.tag);const j=new Promise(async M=>{const P=({id:H})=>{var q;((q=R.id)==null?void 0:q.toString())===H.toString()&&(this.removeRequestFromQueue(H),this.relayer.events.removeListener(oe.publish,P),M())};this.relayer.events.on(oe.publish,P);const O=gt(new Promise((H,q)=>{this.rpcPublish(R,l).then(H).catch(B=>{this.logger.warn(B,B?.message),q(B)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${x} id:${T} tag:${y}`);try{await O,this.events.removeListener(oe.publish,P)}catch(H){this.queue.set(T,{request:R,opts:l,attempt:1}),this.logger.warn(H,H?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:T,payload:u,opts:l}}),await gt(j,this.publishTimeout,F)}catch(j){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(j),(c=l?.internal)!=null&&c.throwOnFailedPublish)throw j}finally{this.queue.delete(T)}}),Qe(this,"on",(n,i)=>{this.events.on(n,i)}),Qe(this,"once",(n,i)=>{this.events.once(n,i)}),Qe(this,"off",(n,i)=>{this.events.off(n,i)}),Qe(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.relayer=e,this.logger=Te(r,this.name),this.registerEventListeners()}get context(){return Fe(this.logger)}async rpcPublish(e,r){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const n=await this.relayer.request(e);return this.relayer.events.emit(oe.publish,qr(qr({},e),r)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,r)=>{var n;const i=e.attempt+1;this.queue.set(r,sd(qr({},e),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(tr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(oe.connection_stalled);return}this.checkQueue()}),this.relayer.on(oe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var T3=Object.defineProperty,B3=(t,e,r)=>e in t?T3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gr=(t,e,r)=>B3(t,typeof e!="symbol"?e+"":e,r);class R3{constructor(){Gr(this,"map",new Map),Gr(this,"set",(e,r)=>{const n=this.get(e);this.exists(e,r)||this.map.set(e,[...n,r])}),Gr(this,"get",e=>this.map.get(e)||[]),Gr(this,"exists",(e,r)=>this.get(e).includes(r)),Gr(this,"delete",(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,r))return;const i=n.filter(s=>s!==r);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),Gr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var C3=Object.defineProperty,N3=Object.defineProperties,$3=Object.getOwnPropertyDescriptors,od=Object.getOwnPropertySymbols,P3=Object.prototype.hasOwnProperty,L3=Object.prototype.propertyIsEnumerable,ta=(t,e,r)=>e in t?C3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cn=(t,e)=>{for(var r in e||(e={}))P3.call(e,r)&&ta(t,r,e[r]);if(od)for(var r of od(e))L3.call(e,r)&&ta(t,r,e[r]);return t},ra=(t,e)=>N3(t,$3(e)),re=(t,e,r)=>ta(t,typeof e!="symbol"?e+"":e,r);class ad extends Up{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,re(this,"subscriptions",new Map),re(this,"topicMap",new R3),re(this,"events",new Ge.exports.EventEmitter),re(this,"name",uc),re(this,"version",lc),re(this,"pending",new Map),re(this,"cached",[]),re(this,"initialized",!1),re(this,"storagePrefix",et),re(this,"subscribeTimeout",G.toMiliseconds(G.ONE_MINUTE)),re(this,"initialSubscribeTimeout",G.toMiliseconds(G.ONE_SECOND*15)),re(this,"clientId"),re(this,"batchSubscribeTopicsLimit",500),re(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),re(this,"subscribe",async(n,i)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}});try{const o=Mi(i),a={topic:n,relay:o,transportType:i?.transportType};(s=i?.internal)!=null&&s.skipSubscribe||this.pending.set(n,a);const c=await this.rpcSubscribe(n,o,i);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),re(this,"unsubscribe",async(n,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(n,i.id,i):await this.unsubscribeByTopic(n,i)}),re(this,"isSubscribed",n=>new Promise(i=>{i(this.topicMap.topics.includes(n))})),re(this,"isKnownTopic",n=>new Promise(i=>{i(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(s=>s.topic===n))})),re(this,"on",(n,i)=>{this.events.on(n,i)}),re(this,"once",(n,i)=>{this.events.once(n,i)}),re(this,"off",(n,i)=>{this.events.off(n,i)}),re(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),re(this,"start",async()=>{await this.onConnect()}),re(this,"stop",async()=>{await this.onDisconnect()}),re(this,"restart",async()=>{await this.restore(),await this.onRestart()}),re(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(i=>{n.push(i)}),await this.batchSubscribe(n)}),re(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(tr.pulse,async()=>{await this.checkPending()}),this.events.on(Be.created,async n=>{const i=Be.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()}),this.events.on(Be.deleted,async n=>{const i=Be.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()})}),this.relayer=e,this.logger=Te(r,this.name),this.clientId=""}get context(){return Fe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,r){let n=!1;try{n=this.getSubscription(e).topic===r}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const n=this.topicMap.get(e);await Promise.all(n.map(async i=>await this.unsubscribeById(e,i,r)))}async unsubscribeById(e,r,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}});try{const i=Mi(n);await this.restartToComplete({topic:e,id:r,relay:i}),await this.rpcUnsubscribe(e,r,i);const s=Tn("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,r,n){var i,s;const o=await this.getSubscriptionId(e);if((i=n?.internal)!=null&&i.skipSubscribe)return o;(!n||n?.transportType===ir.relay)&&await this.restartToComplete({topic:e,id:e,relay:r});const a={method:Kr(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(s=n?.internal)==null?void 0:s.throwOnFailedPublish;try{if(n?.transportType===ir.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},G.toMiliseconds(G.ONE_SECOND)),o;const u=new Promise(async h=>{const f=d=>{d.topic===e&&(this.events.removeListener(Be.created,f),h(d.id))};this.events.on(Be.created,f);try{const d=await gt(new Promise((g,y)=>{this.relayer.request(a).catch(E=>{this.logger.warn(E,E?.message),y(E)}).then(g)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Be.created,f),h(d)}catch{}}),l=await gt(u,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(u){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(oe.connection_stalled),c)throw u}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,n={method:Kr(r.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await gt(new Promise(i=>{this.relayer.request(n).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(oe.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const r=e[0].relay,n={method:Kr(r.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let i;try{i=await await gt(new Promise((s,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(oe.connection_stalled)}return i}rpcUnsubscribe(e,r,n){const i={method:Kr(n.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,r){this.setSubscription(e,ra(Cn({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Cn({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,n){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Cn({},r)),this.topicMap.set(r.topic,e),this.events.emit(Be.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:n}=ee("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(Be.deleted,ra(Cn({},n),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Be.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<r;n++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Be.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(r=>{var n;return r.topic===((n=this.subscriptions.get(r.id))==null?void 0:n.topic)})){const{message:r}=ee("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async r=>ra(Cn({},r),{id:await this.getSubscriptionId(r.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const r=await this.rpcBatchFetchMessages(e);r&&r.messages&&(await HE(G.toMiliseconds(G.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(r.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=ee("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return ki(e+await this.getClientId())}}var U3=Object.defineProperty,cd=Object.getOwnPropertySymbols,F3=Object.prototype.hasOwnProperty,j3=Object.prototype.propertyIsEnumerable,na=(t,e,r)=>e in t?U3(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ud=(t,e)=>{for(var r in e||(e={}))F3.call(e,r)&&na(t,r,e[r]);if(cd)for(var r of cd(e))j3.call(e,r)&&na(t,r,e[r]);return t},Q=(t,e,r)=>na(t,typeof e!="symbol"?e+"":e,r);class ld extends Pp{constructor(e){super(e),Q(this,"protocol","wc"),Q(this,"version",2),Q(this,"core"),Q(this,"logger"),Q(this,"events",new Ge.exports.EventEmitter),Q(this,"provider"),Q(this,"messages"),Q(this,"subscriber"),Q(this,"publisher"),Q(this,"name",ic),Q(this,"transportExplicitlyClosed",!1),Q(this,"initialized",!1),Q(this,"connectionAttemptInProgress",!1),Q(this,"relayUrl"),Q(this,"projectId"),Q(this,"packageName"),Q(this,"bundleId"),Q(this,"hasExperiencedNetworkDisruption",!1),Q(this,"pingTimeout"),Q(this,"heartBeatTimeout",G.toMiliseconds(G.THIRTY_SECONDS+G.FIVE_SECONDS)),Q(this,"reconnectTimeout"),Q(this,"connectPromise"),Q(this,"reconnectInProgress",!1),Q(this,"requestsInFlight",[]),Q(this,"connectTimeout",G.toMiliseconds(G.ONE_SECOND*15)),Q(this,"request",async r=>{var n,i;this.logger.debug("Publishing Request Payload");const s=r.id||zi().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:r.method,topic:(n=r.params)==null?void 0:n.topic},"relayer.request - publishing...");const o=`${s}:${((i=r.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),Q(this,"resetPingTimeout",()=>{vi()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,n,i,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(i=(n=(r=this.provider)==null?void 0:r.connection)==null?void 0:n.socket)==null?void 0:i.terminate)==null||s.call(i)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),Q(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),Q(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(oe.connect)}),Q(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),Q(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(oe.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Q(this,"registerProviderListeners",()=>{this.provider.on(je.payload,this.onPayloadHandler),this.provider.on(je.connect,this.onConnectHandler),this.provider.on(je.disconnect,this.onDisconnectHandler),this.provider.on(je.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Te(e.logger,this.name):Ct(Ka({level:e.logger||nc})),this.messages=new Mh(this.logger,e.core),this.subscriber=new ad(this,this.logger),this.publisher=new A3(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||cs,$E()?this.packageName=cf():PE()&&(this.bundleId=cf()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return Fe(this.logger)}get connected(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,r,n;return((n=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,r,n){this.isInitialized(),await this.publisher.publish(e,r,n),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now(),transportType:ir.relay},rn.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,r){var n,i,s;this.isInitialized(),(!(r!=null&&r.transportType)||r?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((n=r?.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(i=r?.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const u=l=>{l.topic===e&&(this.subscriber.off(Be.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(Be.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,ud({internal:{throwOnFailedPublish:o}},r)).catch(f=>{o&&h(f)})||a,l()})]),a}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await gt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(r,n)=>{await this.connect(e).then(r).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Uh())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const r=e.sort((n,i)=>n.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${r.length} message events sorted`);for(const n of r)try{await this.onMessageEvent(n)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${r.length} message events processed`)}async onLinkMessageEvent(e,r){const{topic:n}=e;if(!r.sessionExists){const i=wn(G.FIVE_MINUTES),s={topic:n,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,s)}this.events.emit(oe.message,e),await this.recordMessageEvent(e,rn.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let r=1;for(;r<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${r}...`),await this.createProvider(),await new Promise(async(n,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(je.disconnect,s),await gt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(je.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(je.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(je.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const i=n;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${r}`);break}await new Promise(n=>setTimeout(n,G.toMiliseconds(r*1))),r++}}startPingTimeout(){var e,r,n,i,s;if(vi())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new w3(new _3(kE({sdkVersion:Wn,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,r){const{topic:n,message:i}=e;await this.messages.set(n,i,r)}async shouldIgnoreMessageEvent(e){const{topic:r,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(r))return this.logger.warn(`Ignoring message for unknown topic ${r}`),!0;const i=this.messages.has(r,n);return i&&this.logger.warn(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),ed(e)){if(!e.method.endsWith(sc))return;const r=e.params,{topic:n,message:i,publishedAt:s,attestation:o}=r.data,a={topic:n,message:i,publishedAt:s,transportType:ir.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(ud({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Qo(e)&&this.events.emit(oe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,rn.inbound),this.events.emit(oe.message,e))}async acknowledgePayload(e){const r=Zh(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(je.payload,this.onPayloadHandler),this.provider.off(je.connect,this.onConnectHandler),this.provider.off(je.disconnect,this.onDisconnectHandler),this.provider.off(je.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Uh();w_(async r=>{e!==r&&(e=r,r?await this.transportOpen().catch(n=>this.logger.error(n,n?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(tr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&v_())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(r){this.logger.warn(r,r?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(oe.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},G.toMiliseconds(oc)))))}isInitialized(){if(!this.initialized){const{message:e}=ee("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function k3(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function fd(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function hd(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const M3="[object RegExp]",z3="[object String]",V3="[object Number]",K3="[object Boolean]",dd="[object Arguments]",H3="[object Symbol]",q3="[object Date]",G3="[object Map]",W3="[object Set]",Y3="[object Array]",Z3="[object Function]",X3="[object ArrayBuffer]",ia="[object Object]",J3="[object Error]",Q3="[object DataView]",e8="[object Uint8Array]",t8="[object Uint8ClampedArray]",r8="[object Uint16Array]",n8="[object Uint32Array]",i8="[object BigUint64Array]",s8="[object Int8Array]",o8="[object Int16Array]",a8="[object Int32Array]",c8="[object BigInt64Array]",u8="[object Float32Array]",l8="[object Float64Array]";function f8(){}function gd(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function h8(t,e,r){return Nn(t,e,void 0,void 0,void 0,void 0,r)}function Nn(t,e,r,n,i,s,o){const a=o(t,e,r,n,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return $n(t,e,s,o)}return $n(t,e,s,o)}function $n(t,e,r,n){if(Object.is(t,e))return!0;let i=hd(t),s=hd(e);if(i===dd&&(i=ia),s===dd&&(s=ia),i!==s)return!1;switch(i){case z3:return t.toString()===e.toString();case V3:{const c=t.valueOf(),u=e.valueOf();return k3(c,u)}case K3:case q3:case H3:return Object.is(t.valueOf(),e.valueOf());case M3:return t.source===e.source&&t.flags===e.flags;case Z3:return t===e}r=r??new Map;const o=r.get(t),a=r.get(e);if(o!=null&&a!=null)return o===e;r.set(t,e),r.set(e,t);try{switch(i){case G3:{if(t.size!==e.size)return!1;for(const[c,u]of t.entries())if(!e.has(c)||!Nn(u,e.get(c),c,t,e,r,n))return!1;return!0}case W3:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){const h=c[l],f=u.findIndex(d=>Nn(h,d,void 0,t,e,r,n));if(f===-1)return!1;u.splice(f,1)}return!0}case Y3:case e8:case t8:case r8:case n8:case i8:case s8:case o8:case a8:case c8:case u8:case l8:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Nn(t[c],e[c],c,t,e,r,n))return!1;return!0}case X3:return t.byteLength!==e.byteLength?!1:$n(new Uint8Array(t),new Uint8Array(e),r,n);case Q3:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:$n(new Uint8Array(t),new Uint8Array(e),r,n);case J3:return t.name===e.name&&t.message===e.message;case ia:{if(!($n(t.constructor,e.constructor,r,n)||gd(t)&&gd(e)))return!1;const u=[...Object.keys(t),...fd(t)],l=[...Object.keys(e),...fd(e)];if(u.length!==l.length)return!1;for(let h=0;h<u.length;h++){const f=u[h],d=t[f];if(!Object.hasOwn(e,f))return!1;const g=e[f];if(!Nn(d,g,f,t,e,r,n))return!1}return!0}default:return!1}}finally{r.delete(t),r.delete(e)}}function d8(t,e){return h8(t,e,f8)}var g8=Object.defineProperty,pd=Object.getOwnPropertySymbols,p8=Object.prototype.hasOwnProperty,y8=Object.prototype.propertyIsEnumerable,sa=(t,e,r)=>e in t?g8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yd=(t,e)=>{for(var r in e||(e={}))p8.call(e,r)&&sa(t,r,e[r]);if(pd)for(var r of pd(e))y8.call(e,r)&&sa(t,r,e[r]);return t},Ue=(t,e,r)=>sa(t,typeof e!="symbol"?e+"":e,r);class bd extends Lp{constructor(e,r,n,i=et,s=void 0){super(e,r,n,i),this.core=e,this.logger=r,this.name=n,Ue(this,"map",new Map),Ue(this,"version",ac),Ue(this,"cached",[]),Ue(this,"initialized",!1),Ue(this,"getKey"),Ue(this,"storagePrefix",et),Ue(this,"recentlyDeleted",[]),Ue(this,"recentlyDeletedLimit",200),Ue(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Hr(o)?this.map.set(this.getKey(o),o):d_(o)?this.map.set(o.id,o):g_(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ue(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ue(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ue(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>d8(a[c],o[c]))):this.values)),Ue(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=yd(yd({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ue(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Te(r,this.name),this.storagePrefix=i,this.getKey=s}get context(){return Fe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:i}=ee("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:n}=ee("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=ee("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=ee("NOT_INITIALIZED",this.name);throw new Error(e)}}}var b8=Object.defineProperty,w8=(t,e,r)=>e in t?b8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,X=(t,e,r)=>w8(t,typeof e!="symbol"?e+"":e,r);class wd{constructor(e,r){this.core=e,this.logger=r,X(this,"name",fc),X(this,"version",hc),X(this,"events",new Ge.exports),X(this,"pairings"),X(this,"initialized",!1),X(this,"storagePrefix",et),X(this,"ignoredPayloadTypes",[Vr]),X(this,"registeredMethods",[]),X(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),X(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),X(this,"create",async n=>{this.isInitialized();const i=Ko(),s=await this.core.crypto.setSymKey(i),o=wn(G.FIVE_MINUTES),a={protocol:rc},c={topic:s,expiry:o,relay:a,active:!1,methods:n?.methods},u=Ph({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:n?.methods});return this.events.emit(xr.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:n?.transportType,internal:n?.internal}),{topic:s,uri:u}}),X(this,"pair",async n=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:n?.uri,trace:[ft.pairing_started]}});this.isValidPair(n,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=$h(n.uri);i.props.properties.topic=s,i.addTrace(ft.pairing_uri_validation_success),i.addTrace(ft.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),i.addTrace(ft.existing_pairing),l.active)throw i.setError(bt.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(ft.pairing_not_expired)}const h=c||wn(G.FIVE_MINUTES),f={topic:s,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(s,h),await this.pairings.set(s,f),i.addTrace(ft.store_new_pairing),n.activatePairing&&await this.activate({topic:s}),this.events.emit(xr.create,f),i.addTrace(ft.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(ft.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(bt.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(d){throw i.setError(bt.subscribe_pairing_topic_failure),d}return i.addTrace(ft.subscribe_pairing_topic_success),f}),X(this,"activate",async({topic:n})=>{this.isInitialized();const i=wn(G.FIVE_MINUTES);this.core.expirer.set(n,i),await this.pairings.update(n,{active:!0,expiry:i})}),X(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=n;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=ME();this.events.once(go("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),X(this,"updateExpiry",async({topic:n,expiry:i})=>{this.isInitialized(),await this.pairings.update(n,{expiry:i})}),X(this,"updateMetadata",async({topic:n,metadata:i})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:i})}),X(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),X(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:i}=n;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",Tn("USER_DISCONNECTED")),await this.deletePairing(i))}),X(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(i);return Ph({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),X(this,"sendRequest",async(n,i,s)=>{const o=Jo(i,s),a=await this.core.crypto.encode(n,o),c=_r[i].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),X(this,"sendResult",async(n,i,s)=>{const o=Zh(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=_r[c].res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),X(this,"sendError",async(n,i,s)=>{const o=Xh(n,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,u=_r[c]?_r[c].res:_r.unregistered_method.res;await this.core.relayer.publish(i,a,u),await this.core.history.resolve(o)}),X(this,"deletePairing",async(n,i)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Tn("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),i?Promise.resolve():this.core.expirer.del(n)])}),X(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(i=>ff(i.expiry));await Promise.all(n.map(i=>this.deletePairing(i.topic)))}),X(this,"onRelayEventRequest",async n=>{const{topic:i,payload:s}=n;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),X(this,"onRelayEventResponse",async n=>{const{topic:i,payload:s}=n,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),X(this,"onPairingPingRequest",async(n,i)=>{const{id:s}=i;try{this.isValidPing({topic:n}),await this.sendResult(s,n,!0),this.events.emit(xr.ping,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),X(this,"onPairingPingResponse",(n,i)=>{const{id:s}=i;setTimeout(()=>{td(i)?this.events.emit(go("pairing_ping",s),{}):Vi(i)&&this.events.emit(go("pairing_ping",s),{error:i.error})},500)}),X(this,"onPairingDeleteRequest",async(n,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(xr.delete,{id:s,topic:n})}catch(o){await this.sendError(s,n,o),this.logger.error(o)}}),X(this,"onUnknownRpcMethodRequest",async(n,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=Tn("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,n,a),this.logger.error(a)}catch(a){await this.sendError(s,n,a),this.logger.error(a)}}),X(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(Tn("WC_METHOD_UNSUPPORTED",n))}),X(this,"isValidPair",(n,i)=>{var s;if(!qo(n)){const{message:a}=ee("MISSING_OR_INVALID",`pair() params: ${n}`);throw i.setError(bt.malformed_pairing_uri),new Error(a)}if(!h_(n.uri)){const{message:a}=ee("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw i.setError(bt.malformed_pairing_uri),new Error(a)}const o=$h(n?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=ee("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(bt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=ee("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(bt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&G.toMiliseconds(o?.expiryTimestamp)<Date.now()){i.setError(bt.pairing_expired);const{message:a}=ee("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),X(this,"isValidPing",async n=>{if(!qo(n)){const{message:s}=ee("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),X(this,"isValidDisconnect",async n=>{if(!qo(n)){const{message:s}=ee("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(s)}const{topic:i}=n;await this.isValidPairingTopic(i)}),X(this,"isValidPairingTopic",async n=>{if(!Lh(n,!1)){const{message:i}=ee("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(i)}if(!this.pairings.keys.includes(n)){const{message:i}=ee("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(i)}if(ff(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:i}=ee("EXPIRED",`pairing topic: ${n}`);throw new Error(i)}}),this.core=e,this.logger=Te(r,this.name),this.pairings=new bd(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Fe(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=ee("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(oe.message,async e=>{const{topic:r,message:n,transportType:i}=e;if(this.pairings.keys.includes(r)&&i!==ir.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const s=await this.core.crypto.decode(r,n);ed(s)?(this.core.history.set(r,s),await this.onRelayEventRequest({topic:r,payload:s})):Qo(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id)),await this.core.relayer.messages.ack(r,n)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Ye.expired,async e=>{const{topic:r}=KE(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(xr.expire,{topic:r}))})}}var m8=Object.defineProperty,E8=(t,e,r)=>e in t?m8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,we=(t,e,r)=>E8(t,typeof e!="symbol"?e+"":e,r);class md extends Cp{constructor(e,r){super(e,r),this.core=e,this.logger=r,we(this,"records",new Map),we(this,"events",new Ge.exports.EventEmitter),we(this,"name",dc),we(this,"version",gc),we(this,"cached",[]),we(this,"initialized",!1),we(this,"storagePrefix",et),we(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),we(this,"set",(n,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:n,request:{method:i.method,params:i.params||null},chainId:s,expiry:wn(G.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(We.created,o)}),we(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const i=await this.getRecord(n.id);typeof i.response>"u"&&(i.response=Vi(n)?{error:n.error}:{result:n.result},this.records.set(i.id,i),this.persist(),this.events.emit(We.updated,i))}),we(this,"get",async(n,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:i}),await this.getRecord(i))),we(this,"delete",(n,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===n){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(We.deleted,s)}}),this.persist()}),we(this,"exists",async(n,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===n:!1)),we(this,"on",(n,i)=>{this.events.on(n,i)}),we(this,"once",(n,i)=>{this.events.once(n,i)}),we(this,"off",(n,i)=>{this.events.off(n,i)}),we(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Te(r,this.name)}get context(){return Fe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const n={topic:r.topic,request:Jo(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:n}=ee("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(We.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=ee("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(We.created,e=>{const r=We.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(We.updated,e=>{const r=We.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.events.on(We.deleted,e=>{const r=We.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e})}),this.core.heartbeat.on(tr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(r=>{G.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.records.delete(r.id),this.events.emit(We.deleted,r,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=ee("NOT_INITIALIZED",this.name);throw new Error(e)}}}var v8=Object.defineProperty,_8=(t,e,r)=>e in t?v8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xe=(t,e,r)=>_8(t,typeof e!="symbol"?e+"":e,r);class Ed extends Fp{constructor(e,r){super(e,r),this.core=e,this.logger=r,xe(this,"expirations",new Map),xe(this,"events",new Ge.exports.EventEmitter),xe(this,"name",pc),xe(this,"version",yc),xe(this,"cached",[]),xe(this,"initialized",!1),xe(this,"storagePrefix",et),xe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),xe(this,"has",n=>{try{const i=this.formatTarget(n);return typeof this.getExpiration(i)<"u"}catch{return!1}}),xe(this,"set",(n,i)=>{this.isInitialized();const s=this.formatTarget(n),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Ye.created,{target:s,expiration:o})}),xe(this,"get",n=>{this.isInitialized();const i=this.formatTarget(n);return this.getExpiration(i)}),xe(this,"del",n=>{if(this.isInitialized(),this.has(n)){const i=this.formatTarget(n),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(Ye.deleted,{target:i,expiration:s})}}),xe(this,"on",(n,i)=>{this.events.on(n,i)}),xe(this,"once",(n,i)=>{this.events.once(n,i)}),xe(this,"off",(n,i)=>{this.events.off(n,i)}),xe(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Te(r,this.name)}get context(){return Fe(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return zE(e);if(typeof e=="number")return VE(e);const{message:r}=ee("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ye.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=ee("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:n}=ee("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return r}checkExpiry(e,r){const{expiry:n}=r;G.toMiliseconds(n)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(Ye.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(tr.pulse,()=>this.checkExpirations()),this.events.on(Ye.created,e=>{const r=Ye.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Ye.expired,e=>{const r=Ye.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Ye.deleted,e=>{const r=Ye.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=ee("NOT_INITIALIZED",this.name);throw new Error(e)}}}var x8=Object.defineProperty,D8=(t,e,r)=>e in t?x8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ae=(t,e,r)=>D8(t,typeof e!="symbol"?e+"":e,r);class vd extends jp{constructor(e,r,n){super(e,r,n),this.core=e,this.logger=r,this.store=n,ae(this,"name",bc),ae(this,"abortController"),ae(this,"isDevEnv"),ae(this,"verifyUrlV3",mc),ae(this,"storagePrefix",et),ae(this,"version",os),ae(this,"publicKey"),ae(this,"fetchPromise"),ae(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&G.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),ae(this,"register",async i=>{if(!bn()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const u=Or(),l=this.startAbortTimer(G.ONE_SECOND*5),h=await new Promise((f,d)=>{const g=()=>{window.removeEventListener("message",E),u.body.removeChild(y),d("attestation aborted")};this.abortController.signal.addEventListener("abort",g);const y=u.createElement("iframe");y.src=c,y.style.display="none",y.addEventListener("error",g,{signal:this.abortController.signal});const E=T=>{if(T.data&&typeof T.data=="string")try{const C=JSON.parse(T.data);if(C.type==="verify_attestation"){if(Bs(C.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(y),this.abortController.signal.removeEventListener("abort",g),window.removeEventListener("message",E),f(C.attestation===null?"":C.attestation)}}catch(C){this.logger.warn(C)}};u.body.appendChild(y),window.addEventListener("message",E,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(u){this.logger.warn(u)}return""}),ae(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(Bs(s).payload.id!==a)return;const u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;const c=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,c)}),ae(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(G.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),ae(this,"getVerifyUrl",i=>{let s=i||nn;return Ec.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${nn}`),s=nn),s}),ae(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(G.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),ae(this,"persistPublicKey",async i=>{this.logger.debug("persisting public key to local storage",i),await this.store.setItem(this.storeKey,i),this.publicKey=i}),ae(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),ae(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),ae(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),ae(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),ae(this,"validateAttestation",(i,s)=>{const o=Q2(i,s.publicKey),a={hasExpired:G.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Te(r,this.name),this.abortController=new AbortController,this.isDevEnv=df(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Fe(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),G.toMiliseconds(e))}}var I8=Object.defineProperty,S8=(t,e,r)=>e in t?I8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_d=(t,e,r)=>S8(t,typeof e!="symbol"?e+"":e,r);class xd extends kp{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,_d(this,"context",vc),_d(this,"registerDeviceToken",async n=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=n,c=`${_c}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=Te(r,this.context)}}var O8=Object.defineProperty,Dd=Object.getOwnPropertySymbols,A8=Object.prototype.hasOwnProperty,T8=Object.prototype.propertyIsEnumerable,oa=(t,e,r)=>e in t?O8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pn=(t,e)=>{for(var r in e||(e={}))A8.call(e,r)&&oa(t,r,e[r]);if(Dd)for(var r of Dd(e))T8.call(e,r)&&oa(t,r,e[r]);return t},de=(t,e,r)=>oa(t,typeof e!="symbol"?e+"":e,r);class Id extends Mp{constructor(e,r,n=!0){super(e,r,n),this.core=e,this.logger=r,de(this,"context",Dc),de(this,"storagePrefix",et),de(this,"storageVersion",xc),de(this,"events",new Map),de(this,"shouldPersist",!1),de(this,"init",async()=>{if(!df())try{const i={eventId:hf(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:uf(this.core.relayer.protocol,this.core.relayer.version,Wn)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),de(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,u=hf(),l=this.core.projectId||"",h=Date.now(),f=Pn({eventId:u,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,f),this.shouldPersist=!0),f}),de(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Pn(Pn({},a),this.setMethods(a.eventId))}),de(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),de(this,"setEventListeners",()=>{this.core.heartbeat.on(tr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{G.fromMiliseconds(Date.now())-G.fromMiliseconds(i.timestamp)>Ic&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),de(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),de(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),de(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),de(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),de(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,Pn(Pn({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),de(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),de(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${Sc}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${Wn}${s}`,{method:"POST",body:JSON.stringify(i)})}),de(this,"getAppDomain",()=>UE().url),this.logger=Te(r,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var B8=Object.defineProperty,Sd=Object.getOwnPropertySymbols,R8=Object.prototype.hasOwnProperty,C8=Object.prototype.propertyIsEnumerable,aa=(t,e,r)=>e in t?B8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Od=(t,e)=>{for(var r in e||(e={}))R8.call(e,r)&&aa(t,r,e[r]);if(Sd)for(var r of Sd(e))C8.call(e,r)&&aa(t,r,e[r]);return t},ie=(t,e,r)=>aa(t,typeof e!="symbol"?e+"":e,r);class Ki extends Ap{constructor(e){var r;super(e),ie(this,"protocol",ss),ie(this,"version",os),ie(this,"name",tn),ie(this,"relayUrl"),ie(this,"projectId"),ie(this,"customStoragePrefix"),ie(this,"events",new Ge.exports.EventEmitter),ie(this,"logger"),ie(this,"heartbeat"),ie(this,"relayer"),ie(this,"crypto"),ie(this,"storage"),ie(this,"history"),ie(this,"expirer"),ie(this,"pairing"),ie(this,"verify"),ie(this,"echoClient"),ie(this,"linkModeSupportedApps"),ie(this,"eventClient"),ie(this,"initialized",!1),ie(this,"logChunkController"),ie(this,"on",(a,c)=>this.events.on(a,c)),ie(this,"once",(a,c)=>this.events.once(a,c)),ie(this,"off",(a,c)=>this.events.off(a,c)),ie(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),ie(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:ir.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});const n=this.getGlobalCore(e?.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||cs,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=Ka({level:typeof e?.logger=="string"&&e.logger?e.logger:qa.logger,name:tn}),{logger:s,chunkLoggerController:o}=Ip({opts:i,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(r=this.logChunkController)!=null&&r.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Te(s,this.name),this.heartbeat=new Ji,this.crypto=new jh(this,this.logger,e?.keychain),this.history=new md(this,this.logger),this.expirer=new Ed(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Xg(Od(Od({},Ga),e?.storageOptions)),this.relayer=new ld({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new wd(this,this.logger),this.verify=new vd(this,this.logger,this.storage),this.echoClient=new xd(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Id(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const r=new Ki(e);await r.initialize();const n=await r.crypto.getClientId();return await r.storage.setItem(cc,n),r}get context(){return Fe(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(us,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(us)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${e}`,n=`${r}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[r]}catch(r){console.warn("Failed to get global WalletConnect core",r);return}}setGlobalCore(e){var r;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((r=e.opts)==null?void 0:r.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const N8=Ki;$.CORE_CONTEXT=tn,$.CORE_DEFAULT=qa,$.CORE_PROTOCOL=ss,$.CORE_STORAGE_OPTIONS=Ga,$.CORE_STORAGE_PREFIX=et,$.CORE_VERSION=os,$.CRYPTO_CLIENT_SEED=as,$.CRYPTO_CONTEXT=Wa,$.CRYPTO_JWT_TTL=Ya,$.Core=N8,$.Crypto=jh,$.ECHO_CONTEXT=vc,$.ECHO_URL=_c,$.EVENTS_CLIENT_API_URL=Sc,$.EVENTS_STORAGE_CLEANUP_INTERVAL=Ic,$.EVENTS_STORAGE_CONTEXT=Dc,$.EVENTS_STORAGE_VERSION=xc,$.EVENT_CLIENT_AUTHENTICATE_ERRORS=Qp,$.EVENT_CLIENT_AUTHENTICATE_TRACES=Jp,$.EVENT_CLIENT_CONTEXT=Yp,$.EVENT_CLIENT_PAIRING_ERRORS=bt,$.EVENT_CLIENT_PAIRING_TRACES=ft,$.EVENT_CLIENT_SESSION_ERRORS=Xp,$.EVENT_CLIENT_SESSION_TRACES=Zp,$.EXPIRER_CONTEXT=pc,$.EXPIRER_DEFAULT_TTL=Gp,$.EXPIRER_EVENTS=Ye,$.EXPIRER_STORAGE_VERSION=yc,$.EchoClient=xd,$.EventClient=Id,$.Expirer=Ed,$.HISTORY_CONTEXT=dc,$.HISTORY_EVENTS=We,$.HISTORY_STORAGE_VERSION=gc,$.JsonRpcHistory=md,$.KEYCHAIN_CONTEXT=Za,$.KEYCHAIN_STORAGE_VERSION=Xa,$.KeyChain=Fh,$.MESSAGES_CONTEXT=Ja,$.MESSAGES_STORAGE_VERSION=Qa,$.MESSAGE_DIRECTION=rn,$.MessageTracker=Mh,$.PAIRING_CONTEXT=fc,$.PAIRING_DEFAULT_TTL=qp,$.PAIRING_EVENTS=xr,$.PAIRING_RPC_OPTS=_r,$.PAIRING_STORAGE_VERSION=hc,$.PENDING_SUB_RESOLUTION_TIMEOUT=Hp,$.PUBLISHER_CONTEXT=tc,$.PUBLISHER_DEFAULT_TTL=ec,$.Pairing=wd,$.RELAYER_CONTEXT=ic,$.RELAYER_DEFAULT_LOGGER=nc,$.RELAYER_DEFAULT_PROTOCOL=rc,$.RELAYER_DEFAULT_RELAY_URL=cs,$.RELAYER_EVENTS=oe,$.RELAYER_PROVIDER_EVENTS=je,$.RELAYER_RECONNECT_TIMEOUT=oc,$.RELAYER_SDK_VERSION=Wn,$.RELAYER_STORAGE_OPTIONS=zp,$.RELAYER_SUBSCRIBER_SUFFIX=sc,$.RELAYER_TRANSPORT_CUTOFF=Vp,$.Relayer=ld,$.STORE_STORAGE_VERSION=ac,$.SUBSCRIBER_CONTEXT=uc,$.SUBSCRIBER_DEFAULT_TTL=Kp,$.SUBSCRIBER_EVENTS=Be,$.SUBSCRIBER_STORAGE_VERSION=lc,$.Store=bd,$.Subscriber=ad,$.TRANSPORT_TYPES=ir,$.TRUSTED_VERIFY_URLS=Ec,$.VERIFY_CONTEXT=bc,$.VERIFY_SERVER=nn,$.VERIFY_SERVER_V3=mc,$.Verify=vd,$.WALLETCONNECT_CLIENT_ID=cc,$.WALLETCONNECT_LINK_MODE_APPS=us,$.default=Ki,Object.defineProperty($,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
